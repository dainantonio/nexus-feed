<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS INTELLIGENCE | AI × Data × Energy × Policy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        /* Previous CSS remains the same until we add new styles */
        
        /* ===== ARTICLE DETAIL MODAL ===== */
        .article-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            backdrop-filter: blur(10px);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        .article-modal-content {
            width: 90%;
            max-width: 900px;
            background: var(--color-bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            background: var(--color-bg-card);
            z-index: 2;
        }
        
        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-electric-green);
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-text-primary);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .article-full-content {
            line-height: 1.8;
            color: var(--color-text-secondary);
        }
        
        .article-full-content h3 {
            color: var(--color-text-primary);
            margin: 2rem 0 1rem;
            font-size: 1.25rem;
        }
        
        .article-full-content p {
            margin-bottom: 1rem;
        }
        
        .article-full-content ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .article-full-content li {
            margin-bottom: 0.5rem;
        }
        
        .article-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--color-border);
        }
        
        .article-meta .source-icon {
            width: 32px;
            height: 32px;
            font-size: 0.9rem;
        }
        
        .article-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }
        
        /* Previous CSS continues... */
        :root {
            --color-bg-dark: #0a0a0f;
            --color-bg-card: #111118;
            --color-bg-sidebar: #0d0d14;
            --color-electric-green: #00ff9d;
            --color-data-blue: #0095ff;
            --color-accent-purple: #8a2be2;
            --color-text-primary: #ffffff;
            --color-text-secondary: #b0b0c0;
            --color-text-muted: #7a7a8a;
            --color-border: #2a2a3a;
            --color-tag-energy: rgba(0, 255, 157, 0.1);
            --color-tag-ai: rgba(0, 149, 255, 0.1);
            --color-tag-policy: rgba(138, 43, 226, 0.1);
            --color-tag-realestate: rgba(255, 165, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            
            --sentiment-bullish: rgba(0, 255, 157, 0.2);
            --sentiment-bearish: rgba(255, 71, 87, 0.2);
            --sentiment-neutral: rgba(149, 149, 255, 0.2);
            --sentiment-bullish-text: #00ff9d;
            --sentiment-bearish-text: #ff4757;
            --sentiment-neutral-text: #9595ff;
            
            --scanline-color: rgba(0, 255, 157, 0.03);
            --glow-intensity: 0.5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--color-bg-dark);
            color: var(--color-text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* ===== HIGH-FREQUENCY SIGNAL TICKER ===== */
        .signal-ticker {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, #111118, #1a1a24);
            border-bottom: 1px solid var(--color-border);
            overflow: hidden;
            position: relative;
            height: 36px;
            display: flex;
            align-items: center;
        }

        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .ticker {
            display: flex;
            animation: ticker-scroll 45s linear infinite;
            white-space: nowrap;
            padding-left: 100%;
        }

        .ticker-item {
            padding: 0 2rem;
            color: var(--color-electric-green);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ticker-item:before {
            content: '⚡';
            font-size: 0.7rem;
        }

        .ticker-item.critical {
            color: #ff4757;
            animation: pulse 2s infinite;
        }

        .ticker-item.alert {
            color: #ffa500;
        }

        .ticker-item.info {
            color: var(--color-data-blue);
        }

        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* ===== CYBERPUNK EFFECTS ===== */
        .cyberpunk-active .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                var(--scanline-color) 51%
            );
            background-size: 100% 4px;
            z-index: 9998;
            pointer-events: none;
            animation: scanlines 8s linear infinite;
        }

        .cyberpunk-active .crt-flicker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                rgba(18, 16, 16, 0) 50%,
                rgba(0, 0, 0, 0.25) 50%
            );
            background-size: 100% 2px;
            z-index: 9999;
            pointer-events: none;
            opacity: 0.1;
            animation: flicker 0.15s infinite;
        }

        .cyberpunk-active .glow-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                circle at 20% 50%,
                rgba(0, 255, 157, 0.05) 0%,
                transparent 50%
            ),
            radial-gradient(
                circle at 80% 20%,
                rgba(0, 149, 255, 0.05) 0%,
                transparent 50%
            );
            z-index: 9997;
            pointer-events: none;
        }

        @keyframes scanlines {
            from { background-position: 0 0; }
            to { background-position: 0 8px; }
        }

        @keyframes flicker {
            0% { opacity: 0.1; }
            50% { opacity: 0.15; }
            100% { opacity: 0.1; }
        }

        /* ===== IMPROVED SIDEBAR CARDS ===== */
        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-section h3 {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--color-text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .heatmap-container {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            padding: 1rem;
            border: 1px solid var(--color-border);
        }

        .heatmap-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            gap: 10px;
            min-height: 44px;
        }

        .heatmap-item:last-child {
            border-bottom: none;
        }

        .heatmap-label {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .heatmap-label span {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .heatmap-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .heatmap-dot.energy {
            background-color: var(--color-electric-green);
        }

        .heatmap-dot.data {
            background-color: var(--color-data-blue);
        }

        .heatmap-dot.realestate {
            background-color: #ffa500;
        }

        .heatmap-dot.policy {
            background-color: var(--color-accent-purple);
        }

        .heatmap-dot.ai {
            background-color: #00bfff;
        }

        .heatmap-value {
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* ===== REAL-TIME SENTIMENT CHART ===== */
        .sentiment-chart-container {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            padding: 1rem;
            border: 1px solid var(--color-border);
            margin-bottom: 1.5rem;
            height: 200px;
            position: relative;
        }

        #sentimentChart {
            width: 100%;
            height: 100%;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .chart-header h4 {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            font-weight: 600;
        }

        .chart-stats {
            display: flex;
            gap: 12px;
            font-size: 0.7rem;
        }

        .chart-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .chart-stat .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .chart-stat .dot.bullish {
            background-color: var(--sentiment-bullish-text);
        }

        .chart-stat .dot.bearish {
            background-color: var(--sentiment-bearish-text);
        }

        /* ===== LIVE STATS PANEL ===== */
        .live-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            padding: 1rem;
            border: 1px solid var(--color-border);
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--color-electric-green);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .trend {
            font-size: 0.7rem;
            margin-top: 0.25rem;
        }

        .trend.up {
            color: var(--color-electric-green);
        }

        .trend.down {
            color: #ff4757;
        }

        /* ===== IMPROVED BOOKMARK FEEDBACK ===== */
        .action-btn.bookmarked {
            background-color: var(--color-electric-green) !important;
            color: var(--color-bg-dark) !important;
            animation: bookmarkPulse 0.3s ease;
        }

        @keyframes bookmarkPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* ===== SEARCH MODAL ===== */
        .search-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .search-modal .search-result-item:hover {
            background: rgba(0, 255, 157, 0.05);
            transform: translateX(5px);
        }

        /* ===== SETTINGS MODAL ===== */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .settings-modal .setting-item {
            transition: var(--transition);
        }

        .settings-modal .setting-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        /* Fix for settings modal scrolling */
        .settings-container {
            max-height: 85vh;
            overflow-y: auto;
            padding-bottom: 80px;
            position: relative;
            width: 90%;
            max-width: 500px;
            background: #111118;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #2a2a3a;
            display: flex;
            flex-direction: column;
        }

        .settings-container #saveSettings {
            position: sticky;
            bottom: 0;
            background: #111118;
            padding-top: 15px;
            margin-top: auto;
            width: 100%;
            padding: 15px;
            background: #00ff9d;
            color: #0a0a0f;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        /* ===== TOGGLE SWITCHES ===== */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.2);
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #00ff9d;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* ===== AI ANALYSIS - COLLAPSIBLE ===== */
        .ai-analysis-collapsible {
            background: rgba(0, 149, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 3px solid #0095ff;
            transition: var(--transition);
            cursor: pointer;
        }

        .ai-analysis-collapsible:hover {
            background: rgba(0, 149, 255, 0.08);
            transform: translateY(-2px);
        }

        .ai-analysis-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .ai-analysis-header h4 {
            font-size: 0.9rem;
            color: #0095ff;
            text-transform: uppercase;
            font-weight: 600;
            margin: 0;
        }

        .ai-analysis-chevron {
            margin-left: auto;
            transition: transform 0.3s ease;
            color: #0095ff;
        }

        .ai-analysis-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
            opacity: 1;
            margin-top: 12px;
        }

        .ai-analysis-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin: 0;
            overflow: hidden;
        }

        /* ===== RANGE SLIDER ===== */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #00ff9d;
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #00ff9d;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* ===== MAIN LAYOUT ===== */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr 350px;
            grid-template-rows: auto auto auto auto 1fr auto;
            min-height: 100vh;
            gap: 0;
        }

        .app-header {
            grid-column: 1 / -1;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--color-electric-green), var(--color-data-blue));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--color-text-primary), var(--color-electric-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            color: var(--color-text-secondary);
        }

        .action-btn:hover {
            background-color: var(--color-electric-green);
            color: var(--color-bg-dark);
        }

        /* ===== INTELLIGENCE AGGREGATOR ===== */
        .intelligence-aggregator {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, #111118, #1a1a24);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .aggregator-content {
            display: flex;
            align-items: center;
            gap: 2rem;
            width: 100%;
        }

        .bull-bear-meter {
            min-width: 220px;
            flex-shrink: 0;
        }

        .meter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            gap: 15px;
        }

        .meter-label {
            font-size: 0.9rem;
            color: var(--color-text-muted);
            white-space: nowrap;
        }

        .meter-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-electric-green);
            white-space: nowrap;
        }

        .meter-gauge {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            margin-bottom: 8px;
        }

        .meter-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .meter-fill.bullish {
            background: linear-gradient(90deg, #00ff9d, #00cc7a);
        }

        .meter-fill.bearish {
            background: linear-gradient(90deg, #ff4757, #cc3947);
        }

        .meter-ticks {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
            font-size: 0.7rem;
            color: var(--color-text-muted);
            padding: 0 5px;
        }

        .meter-ticks span {
            flex: 1;
            text-align: center;
            white-space: nowrap;
        }

        .sentiment-breakdown {
            display: flex;
            gap: 1.5rem;
            flex-grow: 1;
            flex-wrap: wrap;
            min-width: 300px;
        }

        .sentiment-item {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .sentiment-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .sentiment-dot.bullish {
            background-color: var(--color-electric-green);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }

        .sentiment-dot.bearish {
            background-color: #ff4757;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
        }

        .sentiment-dot.neutral {
            background-color: #9595ff;
            box-shadow: 0 0 10px rgba(149, 149, 255, 0.5);
        }

        /* ===== FILTER CHIPS ===== */
        .filter-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 1.5rem 2rem;
            grid-column: 1 / -1;
            padding: 5px 0;
        }

        .filter-chip {
            padding: 0.5rem 1.25rem;
            background-color: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .filter-chip:hover {
            border-color: var(--color-electric-green);
            color: var(--color-text-primary);
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background-color: var(--color-electric-green);
            color: var(--color-bg-dark);
            border-color: var(--color-electric-green);
            font-weight: 600;
        }

        /* ===== LEFT SIDEBAR ===== */
        .left-sidebar {
            grid-column: 1;
            background-color: var(--color-bg-sidebar);
            border-right: 1px solid var(--color-border);
            padding: 1.5rem;
            overflow-y: auto;
        }

        /* ===== PHASE 5: ENHANCED NEURAL MAP ===== */
        .neural-map-container {
            height: 300px;
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        #neuralMap {
            width: 100%;
            height: 100%;
            background: #0a0a0f;
        }

        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(17, 17, 24, 0.9);
            border-radius: 6px;
            padding: 8px;
            display: flex;
            gap: 5px;
            border: 1px solid var(--color-border);
        }

        .map-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            color: var(--color-text-secondary);
            padding: 6px 10px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .map-btn:hover {
            background: var(--color-electric-green);
            color: var(--color-bg-dark);
        }

        .map-btn.active {
            background: var(--color-electric-green);
            color: var(--color-bg-dark);
        }

        .map-legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(17, 17, 24, 0.9);
            border-radius: 6px;
            padding: 8px;
            border: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.7rem;
            color: var(--color-text-secondary);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* ===== SAVED VIEW INDICATOR ===== */
        .saved-view-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(0, 255, 157, 0.1);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--color-electric-green);
        }

        .saved-view-indicator i {
            color: var(--color-electric-green);
        }

        .saved-view-indicator span {
            color: var(--color-electric-green);
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* ===== MAIN FEED ===== */
        .main-feed {
            grid-column: 2;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .feed-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .feed-stats {
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 0.85rem;
            color: var(--color-text-muted);
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .view-options {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            background-color: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .view-btn:hover {
            border-color: var(--color-electric-green);
            color: var(--color-electric-green);
        }

        .view-btn.active {
            background-color: var(--color-electric-green);
            color: var(--color-bg-dark);
            border-color: var(--color-electric-green);
        }

        /* ===== NEWS CARDS ===== */
        .news-card {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--color-border);
            transition: var(--transition);
            position: relative;
        }

        .news-card:hover {
            border-color: var(--color-electric-green);
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 255, 157, 0.1);
        }

        .news-card.breaking {
            border-left: 4px solid #ff4757;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 10px;
        }

        .card-source {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            flex-wrap: wrap;
        }

        .source-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.7rem;
            flex-shrink: 0;
        }

        .source-icon.mit { background-color: #8b0000; color: white; }
        .source-icon.reuters { background-color: #ff8000; color: white; }
        .source-icon.dcf { background-color: #0066cc; color: white; }
        .source-icon.techcrunch { background-color: #00a562; color: white; }
        .source-icon.ft { background-color: #fff1e5; color: #333; }
        .source-icon.wsj { background-color: #0074c1; color: white; }
        .source-icon.nyt { background-color: #333; color: white; }
        .source-icon.bloomberg { background-color: #000; color: white; }
        .source-icon.cnn { background-color: #cc0000; color: white; }
        .source-icon.bbc { background-color: #bb1919; color: white; }
        .source-icon.theverge { background-color: #ff4400; color: white; }
        .source-icon.wired { background-color: #000; color: white; }
        .source-icon.zdnet { background-color: #0066cc; color: white; }
        .source-icon.arstechnica { background-color: #ff6600; color: white; }

        .card-time {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            white-space: nowrap;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.4;
            cursor: pointer;
        }

        .card-title:hover {
            color: var(--color-electric-green);
        }

        .card-summary {
            color: var(--color-text-secondary);
            margin-bottom: 1.25rem;
            line-height: 1.6;
        }

        .card-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }

        .tag {
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .tag.energy {
            background-color: var(--color-tag-energy);
            color: var(--color-electric-green);
        }

        .tag.ai {
            background-color: var(--color-tag-ai);
            color: var(--color-data-blue);
        }

        .tag.policy {
            background-color: var(--color-tag-policy);
            color: #c792ea;
        }

        .tag.realestate {
            background-color: var(--color-tag-realestate);
            color: #ffa500;
        }

        .tag.cooling {
            background-color: rgba(0, 191, 255, 0.1);
            color: #00bfff;
        }

        .tag.security {
            background-color: rgba(255, 65, 108, 0.1);
            color: #ff416c;
        }

        .tag.breaking {
            background-color: rgba(255, 71, 87, 0.1);
            color: #ff4757;
        }

        /* ===== SENTIMENT BADGE ===== */
        .sentiment-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-right: 8px;
            white-space: nowrap;
        }

        .sentiment-badge.bullish {
            background-color: var(--sentiment-bullish);
            color: var(--sentiment-bullish-text);
            border: 1px solid rgba(0, 255, 157, 0.3);
        }

        .sentiment-badge.bearish {
            background-color: var(--sentiment-bearish);
            color: var(--sentiment-bearish-text);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .sentiment-badge.neutral {
            background-color: var(--sentiment-neutral);
            color: var(--sentiment-neutral-text);
            border: 1px solid rgba(149, 149, 255, 0.3);
        }

        /* ===== AUTO-SUMMARIZER ===== */
        .analyze-btn {
            background: none;
            border: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 1rem;
            white-space: nowrap;
        }

        .analyze-btn:hover {
            border-color: var(--color-electric-green);
            color: var(--color-electric-green);
        }

        .analysis-content {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-top: 1rem;
            border-left: 3px solid var(--color-electric-green);
        }

        .analysis-content.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .analysis-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 0.75rem;
        }

        .analysis-item:last-child {
            margin-bottom: 0;
        }

        .analysis-bullet {
            color: var(--color-electric-green);
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .analysis-text {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            line-height: 1.5;
        }

        .highlight {
            background: rgba(0, 255, 157, 0.1);
            color: var(--color-electric-green);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== CARD FOOTER ===== */
        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .impact-score {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .impact-label {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            white-space: nowrap;
        }

        .impact-value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .impact-value.high {
            color: var(--color-electric-green);
        }

        .impact-value.medium {
            color: #ffa500;
        }

        .impact-value.low {
            color: #ff4757;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        /* ===== RIGHT SIDEBAR ===== */
        .right-sidebar {
            grid-column: 3;
            background-color: var(--color-bg-sidebar);
            border-left: 1px solid var(--color-border);
            padding: 1.5rem;
            overflow-y: auto;
        }

        .tldr-container {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            padding: 1rem;
            border: 1px solid var(--color-border);
            margin-bottom: 1.5rem;
        }

        .tldr-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
            color: var(--color-electric-green);
        }

        .tldr-content {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .tldr-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .tldr-item:last-child {
            margin-bottom: 0;
        }

        .tldr-bullet {
            color: var(--color-electric-green);
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* ===== BREAKING BANNER ===== */
        .breaking-banner {
            background: linear-gradient(90deg, #ff4757, #ff6b81);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: pulse 2s infinite;
        }

        /* ===== LOADING STATES ===== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-electric-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--color-text-muted);
        }

        /* ===== NOTIFICATION SYSTEM ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--color-bg-card);
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid;
            z-index: 9999;
            box-shadow: 0 4px 20px rgba(0, 255, 157, 0.2);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== GEMINI API LOADING ===== */
        .gemini-loading {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 149, 255, 0.1);
            border-radius: 8px;
            margin: 10px 0;
        }

        .gemini-loading-dots {
            display: flex;
            gap: 4px;
        }

        .gemini-loading-dot {
            width: 6px;
            height: 6px;
            background-color: #0095ff;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .gemini-loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .gemini-loading-dot:nth-child(2) { animation-delay: -0.16s; }
        .gemini-loading-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        /* ===== FOOTER ===== */
        .app-footer {
            grid-column: 1 / -1;
            background: #111118;
            border-top: 1px solid var(--color-border);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        .footer-copyright {
            font-weight: 500;
        }

        .footer-links {
            display: flex;
            gap: 20px;
        }

        .footer-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--color-electric-green);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 240px 1fr 320px;
            }
        }

        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto 1fr auto auto;
            }
            .signal-ticker {
                grid-row: 2;
            }
            .intelligence-aggregator {
                grid-row: 3;
            }
            .filter-container {
                grid-row: 4;
            }
            .left-sidebar, .right-sidebar {
                grid-column: 1;
                border: none;
                border-bottom: 1px solid var(--color-border);
            }
            .main-feed {
                grid-column: 1;
                grid-row: 5;
            }
            .intelligence-aggregator {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            .aggregator-content {
                flex-direction: column;
                gap: 1rem;
            }
            .bull-bear-meter {
                min-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            .header-actions {
                justify-content: center;
            }
            .filter-container {
                margin: 1rem;
                gap: 8px;
            }
            .filter-chip {
                padding: 0.4rem 1rem;
                font-size: 0.8rem;
            }
            .feed-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            .feed-stats {
                justify-content: space-between;
                width: 100%;
            }
            .view-options {
                align-self: stretch;
                justify-content: center;
            }
            .card-header {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }
            .card-footer {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            .card-actions {
                align-self: center;
            }
            .impact-score {
                justify-content: center;
            }
            .live-stats-grid {
                grid-template-columns: 1fr;
            }
            .app-footer {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .app-header {
                padding: 1rem;
            }
            .logo-text h1 {
                font-size: 1.2rem;
            }
            .intelligence-aggregator {
                padding: 1rem;
            }
            .filter-container {
                margin: 1rem 0.5rem;
            }
            .main-feed, .left-sidebar, .right-sidebar {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Cyberpunk Effects Overlays -->
    <div class="scanlines"></div>
    <div class="crt-flicker"></div>
    <div class="glow-overlay"></div>

    <!-- Article Detail Modal -->
    <div class="article-modal" id="articleModal">
        <div class="article-modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <button class="close-modal" id="closeModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="article-meta">
                    <div class="source-icon" id="modalSourceIcon">SRC</div>
                    <div>
                        <div id="modalSource"></div>
                        <div id="modalTime"></div>
                    </div>
                    <div class="sentiment-badge" id="modalSentiment"></div>
                </div>
                <div class="article-tags" id="modalTags"></div>
                <div class="article-full-content" id="modalContent"></div>
            </div>
        </div>
    </div>

    <!-- High-Frequency Signal Ticker -->
    <div class="signal-ticker">
        <div class="ticker-wrap">
            <div class="ticker" id="signalTicker">
                <div class="ticker-item info">ACTIVATING GEOSPATIAL INTELLIGENCE NETWORK...</div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-container">
                <div class="logo-icon">
                    <i data-lucide="globe" style="color: #0a0a0f;"></i>
                </div>
                <div class="logo-text">
                    <h1>NEXUS INTELLIGENCE</h1>
                    <p>AI × DATA × ENERGY × POLICY</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="action-btn" title="Refresh Feed" id="refreshFeed">
                    <i data-lucide="refresh-cw"></i>
                </button>
                <button class="action-btn" title="Search" id="searchBtn">
                    <i data-lucide="search"></i>
                </button>
                <button class="action-btn" title="Saved Articles" id="savedViewBtn">
                    <i data-lucide="bookmark"></i>
                </button>
                <button class="action-btn" title="Settings" id="settingsBtn">
                    <i data-lucide="settings"></i>
                </button>
            </div>
        </header>

        <!-- Intelligence Aggregator - Bull/Bear Meter -->
        <div class="intelligence-aggregator">
            <div class="aggregator-content">
                <div class="bull-bear-meter">
                    <div class="meter-header">
                        <span class="meter-label">MARKET SENTIMENT</span>
                        <span class="meter-value" id="sentimentValue">NEUTRAL</span>
                    </div>
                    <div class="meter-gauge">
                        <div class="meter-fill" id="sentimentMeterFill" style="width: 50%"></div>
                    </div>
                    <div class="meter-ticks">
                        <span>BEARISH</span>
                        <span>NEUTRAL</span>
                        <span>BULLISH</span>
                    </div>
                </div>
                <div class="sentiment-breakdown" id="sentimentBreakdown">
                    <!-- Dynamic content will be added here -->
                </div>
            </div>
        </div>

        <!-- Filter Chips -->
        <div class="filter-container">
            <div class="filter-chip active" data-filter="all">
                <i data-lucide="zap"></i> ALL NEXUS
            </div>
            <div class="filter-chip" data-filter="ai">
                <i data-lucide="cpu"></i> AI & COMPUTE
            </div>
            <div class="filter-chip" data-filter="energy">
                <i data-lucide="battery-charging"></i> ENERGY
            </div>
            <div class="filter-chip" data-filter="realestate">
                <i data-lucide="building-2"></i> REAL ESTATE
            </div>
            <div class="filter-chip" data-filter="policy">
                <i data-lucide="scale"></i> POLICY
            </div>
            <div class="filter-chip" data-filter="breaking">
                <i data-lucide="alert-circle"></i> BREAKING
            </div>
            <div class="filter-chip" data-filter="saved">
                <i data-lucide="bookmark"></i> SAVED
            </div>
            <div class="filter-chip" id="geminiRealTimeBtn" style="background: rgba(0, 149, 255, 0.2);">
                <i data-lucide="brain"></i> GEMINI REAL-TIME
            </div>
        </div>

        <!-- Left Sidebar with Neural Map -->
        <aside class="left-sidebar">
            <div class="sidebar-section">
                <h3><i data-lucide="map"></i> GEOSPATIAL INTELLIGENCE</h3>
                <div class="neural-map-container">
                    <div id="neuralMap"></div>
                    <!-- Map Controls -->
                    <div class="map-controls">
                        <button class="map-btn active" id="mapAll">ALL</button>
                        <button class="map-btn" id="mapAI">AI</button>
                        <button class="map-btn" id="mapEnergy">ENERGY</button>
                        <button class="map-btn" id="mapPolicy">POLICY</button>
                    </div>
                    <!-- Map Legend -->
                    <div class="map-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #0095ff;"></div>
                            <span>AI & COMPUTE</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #00ff9d;"></div>
                            <span>ENERGY</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #8a2be2;"></div>
                            <span>POLICY</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ffa500;"></div>
                            <span>REAL ESTATE</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar-section">
                <h3><i data-lucide="activity"></i> HEAT MAP</h3>
                <div class="heatmap-container" id="heatmapContainer"></div>
            </div>
            <div class="sidebar-section">
                <h3><i data-lucide="trending-up"></i> TRENDING</h3>
                <div class="heatmap-container" id="trendingTopics"></div>
            </div>
        </aside>

        <!-- Main Feed -->
        <main class="main-feed">
            <div class="feed-header">
                <div>
                    <h2 id="feedTitle">INTELLIGENCE FEED</h2>
                    <div class="feed-stats">
                        <div class="stat-item">
                            <i data-lucide="clock"></i>
                            <span id="lastUpdateTime">LIVE</span>
                        </div>
                        <div class="stat-item">
                            <i data-lucide="newspaper"></i>
                            <span id="articleCount">0 ARTICLES</span>
                        </div>
                        <div class="stat-item">
                            <i data-lucide="zap"></i>
                            <span id="liveStatus">REALTIME</span>
                        </div>
                        <div class="stat-item" id="geminiStatus" style="color: #0095ff;">
                            <i data-lucide="brain"></i>
                            <span>GEMINI: READY</span>
                        </div>
                    </div>
                </div>
                <div class="view-options">
                    <button class="view-btn active" data-view="latest">LATEST</button>
                    <button class="view-btn" data-view="top">TOP IMPACT</button>
                    <button class="view-btn" data-view="bullish">BULLISH</button>
                    <button class="view-btn" data-view="saved">SAVED</button>
                </div>
            </div>

            <div id="breakingBanner" class="breaking-banner" style="display: none;">
                <i data-lucide="alert-circle"></i>
                <span id="breakingText">BREAKING NEWS DETECTED</span>
            </div>

            <div id="savedViewIndicator" class="saved-view-indicator" style="display: none;">
                <i data-lucide="bookmark"></i>
                <span id="savedCountText">0 SAVED ARTICLES</span>
            </div>

            <div id="geminiLoading" class="gemini-loading" style="display: none;">
                <i data-lucide="brain" style="color: #0095ff;"></i>
                <span>GEMINI AI ANALYZING REAL-TIME DATA...</span>
                <div class="gemini-loading-dots">
                    <div class="gemini-loading-dot"></div>
                    <div class="gemini-loading-dot"></div>
                    <div class="gemini-loading-dot"></div>
                </div>
            </div>

            <div id="articlesContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>INITIALIZING NEXUS INTELLIGENCE...</p>
                </div>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <!-- Real-Time Sentiment Chart -->
            <div class="sidebar-section">
                <h3><i data-lucide="activity"></i> SENTIMENT PULSE</h3>
                <div class="sentiment-chart-container">
                    <div class="chart-header">
                        <h4>30-MINUTE TREND</h4>
                        <div class="chart-stats">
                            <div class="chart-stat">
                                <div class="dot bullish"></div>
                                <span>BULL</span>
                            </div>
                            <div class="chart-stat">
                                <div class="dot bearish"></div>
                                <span>BEAR</span>
                            </div>
                        </div>
                    </div>
                    <div id="sentimentChart"></div>
                </div>
            </div>

            <!-- Live Stats Panel -->
            <div class="sidebar-section">
                <h3><i data-lucide="bar-chart-3"></i> LIVE STATS</h3>
                <div class="live-stats-grid" id="liveStatsGrid">
                    <!-- Stats will be populated by JavaScript -->
                </div>
            </div>

            <!-- Impact Distribution -->
            <div class="sidebar-section">
                <h3><i data-lucide="trending-up"></i> IMPACT DISTRIBUTION</h3>
                <div class="heatmap-container" id="impactDistribution"></div>
            </div>

            <!-- TL;DR Mode -->
            <div class="sidebar-section">
                <h3><i data-lucide="sparkles"></i> TL;DR MODE</h3>
                <div class="tldr-container" id="tldrContainer"></div>
            </div>

            <!-- System Health -->
            <div class="sidebar-section">
                <h3><i data-lucide="shield"></i> SYSTEM HEALTH</h3>
                <div class="heatmap-container" id="systemHealth"></div>
            </div>
        </aside>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-copyright">
                © 2024 NEXUS INTELLIGENCE. REAL-TIME AI-DRIVEN MARKET ANALYSIS.
            </div>
            <div class="footer-links">
                <a href="#" class="footer-link">ABOUT</a>
                <a href="#" class="footer-link">API</a>
                <a href="#" class="footer-link">SOURCES</a>
                <a href="#" class="footer-link">PRIVACY</a>
            </div>
        </footer>
    </div>

    <!-- JavaScript Application -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // ===== GLOBAL STATE =====
        const appState = {
            currentFilter: "all",
            currentView: "latest",
            liveArticles: [],
            breakingNews: [],
            trendingTopics: new Set(),
            savedArticles: JSON.parse(localStorage.getItem('nexus_saved_articles') || '[]'),
            neuralMap: null,
            audioEnabled: false,
            cyberpunkMode: false,
            sentimentData: { bullish: 0, bearish: 0, neutral: 0 },
            currentSearchTerm: "",
            refreshIntervalId: null,
            isRefreshing: false,
            isInitialized: false,
            breakingAlertsEnabled: true,
            alertVolume: 70,
            impactDistribution: { high: 0, medium: 0, low: 0 },
            // Phase 4: Real-time analytics
            sentimentHistory: [50, 52, 48, 55, 53, 58, 62, 59, 57, 60],
            signalTickerItems: [],
            liveStats: {
                articlesProcessed: 0,
                signalStrength: 0,
                volatilityIndex: 0,
                refreshRate: 0
            },
            sentimentChart: null,
            // Phase 5: Geospatial Intelligence
            mapMarkers: [],
            mapActiveFilter: "all",
            intelligenceNodes: [],
            mapPulseIntervals: [],
            // Gemini API Configuration
            geminiApiKey: "YOUR_GEMINI_API_KEY", // Replace with your actual API key
            geminiApiUrl: "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",
            geminiStreamingUrl: "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:streamGenerateContent",
            geminiEnabled: true,
            geminiModels: {
                pro: "gemini-pro",
                proVision: "gemini-pro-vision",
                ultra: "gemini-ultra"
            },
            geminiRealTimeInterval: null,
            isGeminiAnalyzing: false,
            // Current article for modal view
            currentArticle: null
        };

        // ===== ARTICLE DETAIL MODAL FUNCTIONS =====
        function openArticleModal(articleId) {
            const article = appState.liveArticles.find(a => a.id === articleId);
            if (!article) return;
            
            appState.currentArticle = article;
            
            // Update modal content
            document.getElementById('modalTitle').textContent = article.title;
            document.getElementById('modalSource').innerHTML = `
                <strong>${article.source}</strong> • ${article.time} • ${article.readTime} read
            `;
            document.getElementById('modalSourceIcon').className = `source-icon ${article.sourceIcon}`;
            document.getElementById('modalSourceIcon').textContent = article.source.substring(0, 2).toUpperCase();
            document.getElementById('modalTime').textContent = `Published: ${formatFullTime(article.publishedAt)}`;
            
            // Update sentiment badge
            const sentimentBadge = document.getElementById('modalSentiment');
            sentimentBadge.className = `sentiment-badge ${article.sentimentType}`;
            sentimentBadge.innerHTML = `
                <i data-lucide="${article.sentimentType === 'bullish' ? 'trending-up' : article.sentimentType === 'bearish' ? 'trending-down' : 'minus'}"></i>
                ${article.sentimentDescription}
            `;
            
            // Update tags
            const tagsContainer = document.getElementById('modalTags');
            tagsContainer.innerHTML = article.tags.map(tag => `
                <div class="tag ${tag}">${tag.toUpperCase()}</div>
            `).join('');
            
            // Update content with full article text
            const contentContainer = document.getElementById('modalContent');
            contentContainer.innerHTML = generateFullArticleContent(article);
            
            // Show modal
            document.getElementById('articleModal').style.display = 'flex';
            
            // Update icons
            lucide.createIcons();
        }

        function closeArticleModal() {
            document.getElementById('articleModal').style.display = 'none';
            appState.currentArticle = null;
        }

        function generateFullArticleContent(article) {
            // Generate more detailed content for the modal
            return `
                <p><strong>${article.summary}</strong></p>
                
                <h3>FULL ANALYSIS</h3>
                <p>The ${article.source} report highlights significant developments in the ${article.tags.join(', ')} sectors. 
                This analysis is based on real-time data aggregation from multiple intelligence sources.</p>
                
                <h3>KEY IMPLICATIONS</h3>
                <ul>
                    ${generateAIAnalysis(article).map(point => `
                        <li>${point}</li>
                    `).join('')}
                </ul>
                
                <h3>MARKET IMPACT ASSESSMENT</h3>
                <p><strong>Impact Score:</strong> <span style="color: ${article.impactClass === 'high' ? '#00ff9d' : article.impactClass === 'medium' ? '#ffa500' : '#ff4757'}">
                    ${article.impactScore.toFixed(1)} (${article.impactClass.toUpperCase()})
                </span></p>
                
                <p><strong>Sentiment Confidence:</strong> ${article.sentimentConfidence.toFixed(0)}%</p>
                
                <h3>RECOMMENDED ACTIONS</h3>
                <ul>
                    <li>Monitor related sector stocks and ETFs</li>
                    <li>Review portfolio exposure to affected sectors</li>
                    <li>Set alerts for follow-up developments</li>
                    <li>Consider strategic positioning based on sentiment analysis</li>
                </ul>
                
                <div style="margin-top: 2rem; padding: 1rem; background: rgba(0, 255, 157, 0.05); border-radius: 8px; border-left: 3px solid #00ff9d;">
                    <p><strong>💡 NEXUS INSIGHT:</strong> This intelligence has been processed through our AI analysis engine, 
                    cross-referenced with historical patterns, and validated against real-time market data streams.</p>
                </div>
            `;
        }

        function formatFullTime(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch {
                return 'Recent';
            }
        }

        // ===== GOOGLE GEMINI API INTEGRATION =====
        class GeminiAPI {
            constructor(apiKey) {
                this.apiKey = apiKey;
                this.baseUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent";
                this.streamingUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:streamGenerateContent";
            }

            async generateContent(prompt, temperature = 0.7, maxTokens = 2048) {
                if (!this.apiKey || this.apiKey === "YOUR_GEMINI_API_KEY") {
                    console.warn("⚠️ Gemini API key not configured. Using simulated responses.");
                    return this.getSimulatedResponse(prompt);
                }

                try {
                    const response = await fetch(`${this.baseUrl}?key=${this.apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: temperature,
                                maxOutputTokens: maxTokens,
                                topP: 0.95,
                                topK: 40
                            },
                            safetySettings: [
                                {
                                    category: "HARM_CATEGORY_HARASSMENT",
                                    threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                },
                                {
                                    category: "HARM_CATEGORY_HATE_SPEECH",
                                    threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                },
                                {
                                    category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                    threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                },
                                {
                                    category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                    threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                }
                            ]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Gemini API error: ${response.status}`);
                    }

                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                } catch (error) {
                    console.error("❌ Gemini API Error:", error);
                    return this.getSimulatedResponse(prompt);
                }
            }

            async streamGenerateContent(prompt, onChunk, onComplete) {
                if (!this.apiKey || this.apiKey === "YOUR_GEMINI_API_KEY") {
                    console.warn("⚠️ Gemini API key not configured. Using simulated streaming.");
                    const simulated = this.getSimulatedResponse(prompt);
                    // Simulate streaming by chunks
                    const chunks = simulated.match(/.{1,50}/g) || [simulated];
                    chunks.forEach((chunk, index) => {
                        setTimeout(() => {
                            onChunk(chunk);
                            if (index === chunks.length - 1) {
                                onComplete(simulated);
                            }
                        }, index * 100);
                    });
                    return;
                }

                try {
                    const response = await fetch(`${this.streamingUrl}?key=${this.apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 2048
                            }
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Gemini streaming error: ${response.status}`);
                    }

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let fullResponse = '';

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n');

                        for (const line of lines) {
                            if (line.startsWith('data: ')) {
                                try {
                                    const data = JSON.parse(line.slice(6));
                                    if (data.candidates && data.candidates[0].content.parts[0].text) {
                                        const text = data.candidates[0].content.parts[0].text;
                                        onChunk(text);
                                        fullResponse += text;
                                    }
                                } catch (e) {
                                    // Skip invalid JSON
                                }
                            }
                        }
                    }

                    onComplete(fullResponse);
                } catch (error) {
                    console.error("❌ Gemini Streaming Error:", error);
                    const simulated = this.getSimulatedResponse(prompt);
                    onComplete(simulated);
                }
            }

            getSimulatedResponse(prompt) {
                // Simulate AI responses for demo purposes
                const responses = {
                    "energy": "**AI Analysis:** Current energy sector shows bullish trends with renewable investments up 24% QoQ. Battery storage capacity growing exponentially, particularly in APAC region. Carbon credit markets reaching record highs.",
                    "ai": "**AI Analysis:** Compute demand surging with generative AI adoption. GPU shortages expected to continue through 2024. Edge AI infrastructure seeing 300% growth YoY. Regulatory frameworks evolving rapidly.",
                    "realestate": "**AI Analysis:** Data center REITs outperforming traditional real estate. Secondary markets seeing unprecedented growth. Power availability becoming primary constraint for new developments.",
                    "policy": "**AI Analysis:** EU AI Act implementation driving compliance costs up 15-20%. US CHIPS Act subsidies creating supply chain realignments. Asia-Pacific regions offering tax incentives for green data centers.",
                    "general": "**AI Analysis:** Cross-sector convergence accelerating. Sustainability metrics becoming key valuation drivers. Public-private partnerships critical for infrastructure development. Talent shortages in quantum and AI domains."
                };

                const lowerPrompt = prompt.toLowerCase();
                for (const [key, response] of Object.entries(responses)) {
                    if (lowerPrompt.includes(key)) {
                        return response;
                    }
                }

                return "**AI Analysis:** Market intelligence indicates strong growth in AI-enabled energy solutions. Convergence of compute and power infrastructure creating new investment opportunities. Regulatory environments evolving to support sustainable tech development.";
            }

            async analyzeMarketSentiment() {
                const prompt = `Analyze current market sentiment for AI, energy, real estate, and policy sectors. Provide a JSON response with:
                {
                    "overallSentiment": "bullish|bearish|neutral",
                    "sentimentScore": 0-100,
                    "sectorAnalysis": {
                        "ai": { "sentiment": "bullish|bearish|neutral", "confidence": 0-100, "keyDrivers": [] },
                        "energy": { "sentiment": "bullish|bearish|neutral", "confidence": 0-100, "keyDrivers": [] },
                        "realestate": { "sentiment": "bullish|bearish|neutral", "confidence": 0-100, "keyDrivers": [] },
                        "policy": { "sentiment": "bullish|bearish|neutral", "confidence": 0-100, "keyDrivers": [] }
                    },
                    "trendingTopics": [],
                    "riskFactors": []
                }

                Base analysis on current market conditions, recent news, and emerging trends.`;

                const response = await this.generateContent(prompt, 0.3, 1024);
                
                try {
                    // Extract JSON from response
                    const jsonMatch = response.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        return JSON.parse(jsonMatch[0]);
                    }
                } catch (e) {
                    console.error("Failed to parse Gemini response as JSON:", e);
                }

                // Fallback to simulated data
                return {
                    overallSentiment: Math.random() > 0.5 ? "bullish" : "bearish",
                    sentimentScore: Math.floor(Math.random() * 30) + 60,
                    sectorAnalysis: {
                        ai: { sentiment: "bullish", confidence: 85, keyDrivers: ["AI adoption", "Compute demand", "Infrastructure investment"] },
                        energy: { sentiment: "neutral", confidence: 75, keyDrivers: ["Renewable growth", "Storage solutions", "Grid modernization"] },
                        realestate: { sentiment: "bullish", confidence: 80, keyDrivers: ["Data center expansion", "Secondary markets", "Power availability"] },
                        policy: { sentiment: "neutral", confidence: 70, keyDrivers: ["Regulatory frameworks", "Subsidies", "Compliance requirements"] }
                    },
                    trendingTopics: ["Quantum Computing", "Edge AI", "Carbon Credits", "Smart Grids"],
                    riskFactors: ["Supply chain constraints", "Regulatory uncertainty", "Energy volatility"]
                };
            }

            async generateRealTimeNews(topic = "all") {
                const topics = {
                    all: "AI, energy, real estate, and policy developments",
                    ai: "artificial intelligence, machine learning, compute infrastructure, and AI policy",
                    energy: "energy markets, renewable energy, grid infrastructure, and energy policy",
                    realestate: "data center real estate, commercial property, and infrastructure development",
                    policy: "government regulations, policies, and legislation affecting technology and energy sectors"
                };

                const prompt = `Generate 3-5 real-time news headlines and summaries for ${topics[topic] || topics.all} as of current date.
                For each article, provide:
                - A compelling headline
                - A 2-3 sentence summary
                - A source (e.g., Reuters, Bloomberg, TechCrunch)
                - Key tags (ai, energy, realestate, policy, breaking, etc.)
                - A sentiment (bullish, bearish, neutral)
                - An impact score (1-10)
                - A brief AI analysis (2-3 bullet points)

                Format as JSON array:
                [
                    {
                        "title": "Headline here",
                        "summary": "Summary here",
                        "source": "Source name",
                        "tags": ["tag1", "tag2"],
                        "sentiment": "bullish",
                        "impactScore": 8,
                        "aiAnalysis": ["Point 1", "Point 2"]
                    }
                ]

                Make the news relevant, timely, and based on current market conditions.`;

                const response = await this.generateContent(prompt, 0.8, 2048);
                
                try {
                    const jsonMatch = response.match(/\[\s*\{[\s\S]*\}\s*\]/);
                    if (jsonMatch) {
                        return JSON.parse(jsonMatch[0]);
                    }
                } catch (e) {
                    console.error("Failed to parse Gemini news response:", e);
                }

                // Fallback to simulated news
                return this.getSimulatedNews(topic);
            }

            getSimulatedNews(topic) {
                const now = new Date();
                const baseNews = [
                    {
                        title: "NVIDIA Announces Blackwell GPU with 50% Energy Efficiency Gain",
                        summary: "New AI processor architecture promises significant power savings while doubling training performance. Industry analysts predict accelerated AI adoption.",
                        source: "TechCrunch",
                        tags: ["ai", "energy", "breaking"],
                        sentiment: "bullish",
                        impactScore: 9,
                        aiAnalysis: [
                            "Energy efficiency breakthrough could reduce data center power costs by 30-40%",
                            "Accelerates timeline for AI model training and deployment",
                            "Potential supply chain impacts as demand surges"
                        ]
                    },
                    {
                        title: "EU Approves €45B Green Data Center Initiative",
                        summary: "European Union launches massive funding program for sustainable data center infrastructure. Focus on renewable integration and circular economy principles.",
                        source: "Reuters",
                        tags: ["policy", "energy", "realestate"],
                        sentiment: "bullish",
                        impactScore: 8,
                        aiAnalysis: [
                            "Major boost for European data center market competitiveness",
                            "Renewable energy integration requirements will drive innovation",
                            "Potential for 20-30% growth in sustainable infrastructure"
                        ]
                    },
                    {
                        title: "Microsoft Secures 2GW Renewable Energy Deal for AI Expansion",
                        summary: "Tech giant signs record-breaking renewable energy agreement to power AI data centers. Solar and wind projects across three continents.",
                        source: "Bloomberg",
                        tags: ["ai", "energy", "policy"],
                        sentiment: "bullish",
                        impactScore: 7,
                        aiAnalysis: [
                            "Sets new benchmark for corporate renewable procurement",
                            "Addresses growing concerns about AI energy consumption",
                            "May trigger similar deals from other tech giants"
                        ]
                    },
                    {
                        title: "Quantum Computing Breakthrough Reduces Cooling Requirements",
                        summary: "Researchers achieve quantum processing at higher temperatures, potentially eliminating need for extreme cryogenic systems.",
                        source: "MIT News",
                        tags: ["ai", "energy", "breaking"],
                        sentiment: "bullish",
                        impactScore: 8,
                        aiAnalysis: [
                            "Could dramatically reduce quantum computing infrastructure costs",
                            "Accelerates practical quantum computing applications",
                            "Energy savings estimated at 60-80% for quantum systems"
                        ]
                    }
                ];

                // Filter by topic if needed
                if (topic !== "all") {
                    return baseNews.filter(article => article.tags.includes(topic));
                }

                return baseNews;
            }

            async analyzeArticle(article) {
                const prompt = `Analyze this article for market impact and strategic implications:
                
                Title: ${article.title}
                Summary: ${article.summary}
                Source: ${article.source}
                Tags: ${article.tags.join(', ')}
                
                Provide analysis in this format:
                **Market Impact:** [High/Medium/Low] - Brief explanation
                **Key Implications:**
                1. [First implication]
                2. [Second implication]
                3. [Third implication]
                **Strategic Recommendations:**
                - [First recommendation]
                - [Second recommendation]
                **Risk Assessment:** [Low/Medium/High] - Brief explanation`;

                return await this.generateContent(prompt, 0.5, 1024);
            }
        }

        // Initialize Gemini API
        const gemini = new GeminiAPI(appState.geminiApiKey);

        // ===== GEMINI REAL-TIME DATA FETCH =====
        async function fetchGeminiRealTimeData() {
            if (appState.isGeminiAnalyzing) return;
            
            appState.isGeminiAnalyzing = true;
            const loadingEl = document.getElementById('geminiLoading');
            const statusEl = document.getElementById('geminiStatus');
            
            if (loadingEl) loadingEl.style.display = 'flex';
            if (statusEl) {
                statusEl.innerHTML = '<i data-lucide="brain"></i><span>GEMINI: ANALYZING...</span>';
                statusEl.style.color = '#ffa500';
            }
            
            try {
                // Fetch market sentiment from Gemini
                const sentimentData = await gemini.analyzeMarketSentiment();
                
                // Update sentiment meter
                updateSentimentFromGemini(sentimentData);
                
                // Fetch real-time news
                const newsData = await gemini.generateRealTimeNews(appState.currentFilter);
                
                // Process and update articles
                const processedArticles = processGeminiArticles(newsData);
                
                // Merge with existing articles (avoid duplicates)
                const newArticles = processedArticles.filter(newArticle => 
                    !appState.liveArticles.some(existing => existing.title === newArticle.title)
                );
                
                if (newArticles.length > 0) {
                    appState.liveArticles = [...newArticles, ...appState.liveArticles].slice(0, 20);
                    updateUI();
                    showNotification(`${newArticles.length} NEW ARTICLES FROM GEMINI AI`, "success");
                }
                
                // Update trending topics from Gemini
                if (sentimentData.trendingTopics) {
                    sentimentData.trendingTopics.forEach(topic => {
                        appState.trendingTopics.add(topic);
                    });
                    updateTrendingTopics();
                }
                
                console.log('✅ Gemini real-time data fetched successfully');
                
            } catch (error) {
                console.error('❌ Gemini data fetch failed:', error);
                showNotification("GEMINI ANALYSIS FAILED - USING SIMULATED DATA", "warning");
                
                // Fallback to simulated data
                loadEnhancedSampleData();
            } finally {
                appState.isGeminiAnalyzing = false;
                if (loadingEl) loadingEl.style.display = 'none';
                if (statusEl) {
                    statusEl.innerHTML = '<i data-lucide="brain"></i><span>GEMINI: READY</span>';
                    statusEl.style.color = '#0095ff';
                }
            }
        }

        function processGeminiArticles(geminiArticles) {
            return geminiArticles.map((article, index) => {
                const tags = article.tags || extractTags(article.title + ' ' + article.summary);
                const sentiment = analyzeSentiment(article.title, article.summary, tags);
                const impactScore = article.impactScore || calculateImpactScore(article, sentiment);
                
                return {
                    id: 'gemini_' + index + '_' + Date.now(),
                    title: article.title,
                    summary: article.summary,
                    source: article.source || 'Gemini AI',
                    sourceIcon: getSourceIcon(article.source || 'Gemini'),
                    time: 'JUST NOW',
                    readTime: estimateReadTime(article.summary),
                    tags: tags,
                    sentiment: sentiment,
                    impactScore: impactScore,
                    url: '#',
                    publishedAt: new Date().toISOString(),
                    isBreaking: tags.includes('breaking'),
                    sentimentConfidence: sentiment.confidence,
                    sentimentType: sentiment.type,
                    sentimentDescription: getSentimentDescription(sentiment),
                    impactClass: impactScore >= 8 ? 'high' : impactScore >= 6 ? 'medium' : 'low',
                    geminiAnalysis: article.aiAnalysis || generateAIAnalysis({ tags, sentimentType: sentiment.type })
                };
            });
        }

        function updateSentimentFromGemini(sentimentData) {
            if (!sentimentData) return;
            
            // Update overall sentiment
            const sentimentValue = document.getElementById('sentimentValue');
            const sentimentMeterFill = document.getElementById('sentimentMeterFill');
            
            if (sentimentValue && sentimentMeterFill) {
                const score = sentimentData.sentimentScore || 50;
                sentimentValue.textContent = sentimentData.overallSentiment?.toUpperCase() || 'NEUTRAL';
                sentimentValue.style.color = 
                    sentimentData.overallSentiment === 'bullish' ? '#00ff9d' : 
                    sentimentData.overallSentiment === 'bearish' ? '#ff4757' : '#9595ff';
                
                sentimentMeterFill.style.width = `${score}%`;
                sentimentMeterFill.className = `meter-fill ${sentimentData.overallSentiment || 'neutral'}`;
            }
            
            // Update sentiment breakdown
            if (sentimentData.sectorAnalysis) {
                updateGeminiSentimentBreakdown(sentimentData.sectorAnalysis);
            }
            
            // Update sentiment chart
            if (appState.sentimentChart && sentimentData.sentimentScore) {
                appState.sentimentHistory.push(sentimentData.sentimentScore);
                if (appState.sentimentHistory.length > 30) {
                    appState.sentimentHistory.shift();
                }
                appState.sentimentChart.updateSeries([{
                    data: appState.sentimentHistory
                }]);
            }
        }

        function updateGeminiSentimentBreakdown(sectorAnalysis) {
            const container = document.getElementById('sentimentBreakdown');
            if (!container || !sectorAnalysis) return;
            
            let html = '';
            Object.entries(sectorAnalysis).forEach(([sector, data]) => {
                if (data && data.sentiment) {
                    html += `
                        <div class="sentiment-item">
                            <div class="sentiment-dot ${data.sentiment}"></div>
                            <span>${sector.toUpperCase()}: ${data.sentiment.toUpperCase()} (${data.confidence || 0}%)</span>
                        </div>
                    `;
                }
            });
            
            if (html) {
                container.innerHTML = html;
            }
        }

        // ===== PHASE 5: GEOSPATIAL INTELLIGENCE CONFIGURATION =====
        const GEOSPATIAL_CONFIG = {
            // Dark Matter tile layer for Nexus aesthetic
            TILE_LAYER: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
            
            // Global intelligence nodes mapped to categories
            INTELLIGENCE_NODES: {
                // AI & Compute Nodes
                ai: [
                    { name: "Silicon Valley", lat: 37.3875, lng: -122.0575, weight: 0.9 },
                    { name: "London Tech", lat: 51.5200, lng: -0.0970, weight: 0.8 },
                    { name: "Shenzhen", lat: 22.5431, lng: 114.0579, weight: 0.7 },
                    { name: "Seoul", lat: 37.5665, lng: 126.9780, weight: 0.6 },
                    { name: "Austin", lat: 30.2672, lng: -97.7431, weight: 0.5 },
                    { name: "Boston", lat: 42.3601, lng: -71.0589, weight: 0.4 },
                    { name: "Tel Aviv", lat: 32.0853, lng: 34.7818, weight: 0.4 }
                ],
                
                // Energy Nodes
                energy: [
                    { name: "Houston", lat: 29.7604, lng: -95.3698, weight: 0.9 },
                    { name: "Abu Dhabi", lat: 24.4539, lng: 54.3773, weight: 0.8 },
                    { name: "Oslo", lat: 59.9139, lng: 10.7522, weight: 0.7 },
                    { name: "Singapore", lat: 1.3521, lng: 103.8198, weight: 0.6 },
                    { name: "Calgary", lat: 51.0447, lng: -114.0719, weight: 0.5 },
                    { name: "Reykjavik", lat: 64.1466, lng: -21.9426, weight: 0.4 },
                    { name: "Perth", lat: -31.9505, lng: 115.8605, weight: 0.4 }
                ],
                
                // Policy Nodes
                policy: [
                    { name: "Washington DC", lat: 38.9072, lng: -77.0369, weight: 0.9 },
                    { name: "Brussels", lat: 50.8503, lng: 4.3517, weight: 0.8 },
                    { name: "Berlin", lat: 52.5200, lng: 13.4050, weight: 0.7 },
                    { name: "Tokyo", lat: 35.6762, lng: 139.6503, weight: 0.6 },
                    { name: "Canberra", lat: -35.2809, lng: 149.1300, weight: 0.5 },
                    { name: "Ottawa", lat: 45.4215, lng: -75.6972, weight: 0.4 },
                    { name: "Geneva", lat: 46.2044, lng: 6.1432, weight: 0.4 }
                ],
                
                // Real Estate Nodes
                realestate: [
                    { name: "New York", lat: 40.7128, lng: -74.0060, weight: 0.9 },
                    { name: "Hong Kong", lat: 22.3193, lng: 114.1694, weight: 0.8 },
                    { name: "Dubai", lat: 25.2048, lng: 55.2708, weight: 0.7 },
                    { name: "Frankfurt", lat: 50.1109, lng: 8.6821, weight: 0.6 },
                    { name: "Chicago", lat: 41.8781, lng: -87.6298, weight: 0.5 },
                    { name: "Sydney", lat: -33.8688, lng: 151.2093, weight: 0.4 },
                    { name: "Toronto", lat: 43.6532, lng: -79.3832, weight: 0.4 }
                ]
            },
            
            // Marker colors by category
            MARKER_COLORS: {
                ai: '#0095ff',        // Blue
                energy: '#00ff9d',    // Green
                policy: '#8a2be2',    // Purple
                realestate: '#ffa500', // Orange
                breaking: '#ff4757',  // Red
                general: '#9595ff'    // Neutral purple
            },
            
            // Marker sizes by impact
            MARKER_SIZES: {
                high: 16,
                medium: 12,
                low: 8
            }
        };

        // ===== SEARCH FUNCTIONALITY =====
        function initSearch() {
            const searchBtn = document.getElementById('searchBtn');
            const searchModal = document.createElement('div');
            searchModal.className = 'search-modal';
            searchModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(10, 10, 15, 0.95);
                backdrop-filter: blur(10px);
                z-index: 10000;
                display: none;
                align-items: center;
                justify-content: center;
            `;
            
            searchModal.innerHTML = `
                <div class="search-container" style="width: 90%; max-width: 600px;">
                    <div class="search-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
                        <i data-lucide="search" style="width: 24px; height: 24px; color: #00ff9d;"></i>
                        <input type="text" id="searchInput" placeholder="SEARCH NEXUS INTELLIGENCE..." 
                               style="flex: 1; background: transparent; border: none; border-bottom: 2px solid #00ff9d; 
                                      padding: 15px 0; font-size: 1.2rem; color: white; outline: none;">
                        <button id="closeSearch" class="action-btn" style="background: rgba(255,255,255,0.1);">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <div id="searchResults" style="max-height: 400px; overflow-y: auto;">
                        <div class="empty-state" style="text-align: center; padding: 60px 20px; color: #7a7a8a;">
                            <i data-lucide="search" style="width: 48px; height: 48px; margin-bottom: 20px;"></i>
                            <h3>ENTER SEARCH TERMS</h3>
                            <p>Search across all articles, sources, and tags</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(searchModal);
            
            searchBtn.addEventListener('click', () => {
                searchModal.style.display = 'flex';
                document.getElementById('searchInput').focus();
                lucide.createIcons();
            });
            
            document.getElementById('closeSearch').addEventListener('click', () => {
                searchModal.style.display = 'none';
            });
            
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                performSearch(e.target.value);
            });
            
            // Close on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && searchModal.style.display === 'flex') {
                    searchModal.style.display = 'none';
                }
            });
        }

        function performSearch(query) {
            if (!query.trim()) {
                document.getElementById('searchResults').innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 60px 20px; color: #7a7a8a;">
                        <i data-lucide="search" style="width: 48px; height: 48px; margin-bottom: 20px;"></i>
                        <h3>ENTER SEARCH TERMS</h3>
                        <p>Search across all articles, sources, and tags</p>
                    </div>
                `;
                return;
            }
            
            const results = appState.liveArticles.filter(article => {
                const searchText = (article.title + ' ' + article.summary + ' ' + article.source + ' ' + article.tags.join(' ')).toLowerCase();
                return searchText.includes(query.toLowerCase());
            });
            
            if (results.length === 0) {
                document.getElementById('searchResults').innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 60px 20px; color: #7a7a8a;">
                        <i data-lucide="search-x" style="width: 48px; height: 48px; margin-bottom: 20px;"></i>
                        <h3>NO RESULTS FOUND</h3>
                        <p>Try different keywords</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            const resultsHTML = results.map(article => `
                <div class="search-result-item" style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); 
                       cursor: pointer; transition: all 0.3s;" 
                     onclick="openArticleModal('${article.id}'); document.querySelector('.search-modal').style.display = 'none';">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                        <div class="source-icon ${article.sourceIcon}" style="width: 20px; height: 20px; font-size: 0.6rem;">
                            ${article.source.substring(0, 2).toUpperCase()}
                        </div>
                        <span style="color: #b0b0c0; font-size: 0.9rem;">${article.source}</span>
                        <span style="color: #7a7a8a;">•</span>
                        <span style="color: #7a7a8a; font-size: 0.9rem;">${article.time}</span>
                    </div>
                    <h4 style="color: white; margin-bottom: 8px; font-size: 1.1rem;">${article.title}</h4>
                    <p style="color: #b0b0c0; font-size: 0.9rem; line-height: 1.4;">${article.summary.substring(0, 150)}...</p>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        ${article.tags.map(tag => `
                            <span style="padding: 4px 12px; background: rgba(0,255,157,0.1); color: #00ff9d; 
                                  border-radius: 20px; font-size: 0.7rem;">${tag.toUpperCase()}</span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            
            document.getElementById('searchResults').innerHTML = resultsHTML;
        }

        // ===== SETTINGS MODAL =====
        function initSettings() {
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsModal = document.createElement('div');
            settingsModal.className = 'settings-modal';
            
            settingsModal.innerHTML = `
                <div class="settings-container">
                    <div style="flex: 1; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h2 style="display: flex; align-items: center; gap: 10px;">
                                <i data-lucide="settings" style="color: #00ff9d;"></i>
                                NEXUS SETTINGS
                            </h2>
                            <button id="closeSettings" class="action-btn">
                                <i data-lucide="x"></i>
                            </button>
                        </div>
                        
                        <div class="settings-section" style="margin-bottom: 30px;">
                            <h3 style="font-size: 0.9rem; color: #b0b0c0; margin-bottom: 20px; text-transform: uppercase;">
                                <i data-lucide="brain" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                                GEMINI AI CONFIGURATION
                            </h3>
                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; 
                                 padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 5px;">Gemini API Key</div>
                                    <div style="font-size: 0.85rem; color: #7a7a8a;">Your Google Gemini API key</div>
                                </div>
                                <input type="password" id="geminiApiKey" value="${appState.geminiApiKey}" 
                                       style="background: rgba(255,255,255,0.1); border: 1px solid #2a2a3a; border-radius: 4px; padding: 8px; color: white; width: 200px;">
                            </div>
                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; 
                                 padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 5px;">Enable Real-time Analysis</div>
                                    <div style="font-size: 0.85rem; color: #7a7a8a;">Use Gemini for live market intelligence</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="geminiEnabledToggle" ${appState.geminiEnabled ? 'checked' : ''}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; 
                                 padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 5px;">Auto-refresh Interval</div>
                                    <div style="font-size: 0.85rem; color: #7a7a8a;">Minutes between Gemini updates</div>
                                </div>
                                <select id="geminiRefreshInterval" style="background: rgba(255,255,255,0.1); border: 1px solid #2a2a3a; border-radius: 4px; padding: 8px; color: white;">
                                    <option value="1">1 minute</option>
                                    <option value="5" selected>5 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="30">30 minutes</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-section" style="margin-bottom: 30px;">
                            <h3 style="font-size: 0.9rem; color: #b0b0c0; margin-bottom: 20px; text-transform: uppercase;">
                                <i data-lucide="bell" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                                VOICE ALERTS
                            </h3>
                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; 
                                 padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 5px;">Voice Notifications</div>
                                    <div style="font-size: 0.85rem; color: #7a7a8a;">Audio alerts for breaking news</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="voiceAlertsToggle" ${appState.audioEnabled ? 'checked' : ''}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; 
                                 padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 5px;">Alert Volume</div>
                                    <div style="font-size: 0.85rem; color: #7a7a8a;">Adjust notification loudness</div>
                                </div>
                                <input type="range" id="alertVolume" min="0" max="100" value="${appState.alertVolume}" 
                                       style="width: 100px;">
                            </div>
                        </div>
                        
                        <div class="settings-section" style="margin-bottom: 30px;">
                            <h3 style="font-size: 0.9rem; color: #b0b0c0; margin-bottom: 20px; text-transform: uppercase;">
                                <i data-lucide="zap" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                                VISUAL EFFECTS
                            </h3>
                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; 
                                 padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 5px;">Cyberpunk Mode</div>
                                    <div style="font-size: 0.85rem; color: #7a7a8a;">Scanlines, glow effects, CRT flicker</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="cyberpunkToggle" ${appState.cyberpunkMode ? 'checked' : ''}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3 style="font-size: 0.9rem; color: #b0b0c0; margin-bottom: 20px; text-transform: uppercase;">
                                <i data-lucide="refresh-cw" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                                DATA & UPDATES
                            </h3>
                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; 
                                 padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 5px;">Auto-refresh</div>
                                    <div style="font-size: 0.85rem; color: #7a7a8a;">Update feed every 60 seconds</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="autoRefreshToggle" ${appState.refreshIntervalId ? 'checked' : ''}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; 
                                 padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 5px;">Breaking Alerts</div>
                                    <div style="font-size: 0.85rem; color: #7a7a8a;">Notifications for breaking news</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="breakingAlertsToggle" ${appState.breakingAlertsEnabled ? 'checked' : ''}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button id="saveSettings">SAVE SETTINGS</button>
                </div>
            `;
            
            document.body.appendChild(settingsModal);
            
            settingsBtn.addEventListener('click', () => {
                settingsModal.style.display = 'flex';
                lucide.createIcons();
            });
            
            document.getElementById('closeSettings').addEventListener('click', () => {
                settingsModal.style.display = 'none';
            });
            
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            
            // Close on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && settingsModal.style.display === 'flex') {
                    settingsModal.style.display = 'none';
                }
            });
        }

        function saveSettings() {
            appState.audioEnabled = document.getElementById('voiceAlertsToggle').checked;
            appState.alertVolume = document.getElementById('alertVolume').value;
            appState.cyberpunkMode = document.getElementById('cyberpunkToggle').checked;
            appState.breakingAlertsEnabled = document.getElementById('breakingAlertsToggle').checked;
            
            // Update Gemini settings
            appState.geminiApiKey = document.getElementById('geminiApiKey').value;
            appState.geminiEnabled = document.getElementById('geminiEnabledToggle').checked;
            
            // Update Gemini instance with new API key
            gemini.apiKey = appState.geminiApiKey;
            
            // Update auto-refresh interval for Gemini
            const refreshInterval = parseInt(document.getElementById('geminiRefreshInterval').value) * 60000;
            
            // Clear existing interval
            if (appState.geminiRealTimeInterval) {
                clearInterval(appState.geminiRealTimeInterval);
                appState.geminiRealTimeInterval = null;
            }
            
            // Set up new interval if enabled
            if (appState.geminiEnabled) {
                appState.geminiRealTimeInterval = setInterval(() => {
                    fetchGeminiRealTimeData();
                }, refreshInterval);
            }
            
            // Apply cyberpunk effects
            if (appState.cyberpunkMode) {
                document.body.classList.add('cyberpunk-active');
                document.querySelectorAll('.scanlines, .crt-flicker, .glow-overlay').forEach(el => {
                    el.style.display = 'block';
                });
            } else {
                document.body.classList.remove('cyberpunk-active');
                document.querySelectorAll('.scanlines, .crt-flicker, .glow-overlay').forEach(el => {
                    el.style.display = 'none';
                });
            }
            
            // Handle auto-refresh
            if (document.getElementById('autoRefreshToggle').checked && !appState.refreshIntervalId) {
                appState.refreshIntervalId = setInterval(() => {
                    if (appState.geminiEnabled) {
                        fetchGeminiRealTimeData();
                    } else {
                        loadEnhancedSampleData();
                    }
                    showNotification("FEED AUTO-REFRESHED", "info");
                }, 60000);
            } else if (!document.getElementById('autoRefreshToggle').checked && appState.refreshIntervalId) {
                clearInterval(appState.refreshIntervalId);
                appState.refreshIntervalId = null;
            }
            
            showNotification("SETTINGS SAVED", "success");
            document.querySelector('.settings-modal').style.display = 'none';
        }

        // ===== AI ANALYSIS GENERATOR =====
        function generateAIAnalysis(article) {
            if (article.geminiAnalysis) {
                return article.geminiAnalysis;
            }
            
            const points = [];
            
            // Always include these points based on tags
            if (article.tags.includes('ai')) {
                points.push("AI compute demand analysis and market impact");
                points.push("Energy efficiency metrics and implications");
            }
            
            if (article.tags.includes('energy')) {
                points.push("Power consumption and sustainability impact");
                points.push("Grid infrastructure requirements");
            }
            
            if (article.tags.includes('policy')) {
                points.push("Regulatory compliance and policy implications");
                points.push("Government incentives and tax considerations");
            }
            
            if (article.tags.includes('realestate')) {
                points.push("Real estate market dynamics and pricing");
                points.push("Location strategy and site selection factors");
            }
            
            // Add sentiment-based points
            if (article.sentimentType === 'bullish') {
                points.push("Positive market sentiment detected");
                points.push("Growth opportunities identified");
            } else if (article.sentimentType === 'bearish') {
                points.push("Risk factors and challenges identified");
                points.push("Market volatility concerns");
            }
            
            // Ensure we have 4 points
            while (points.length < 4) {
                points.push("Cross-sector implications and strategic considerations");
            }
            
            return points.slice(0, 4);
        }

        // ===== PHASE 5: GEOSPATIAL INTELLIGENCE FUNCTIONS =====
        function initNeuralMap() {
            try {
                const mapContainer = document.getElementById('neuralMap');
                if (!mapContainer) return;
                
                // Initialize map with dark theme
                appState.neuralMap = L.map('neuralMap').setView([20, 0], 2);
                
                // Use Dark Matter tile layer
                L.tileLayer(GEOSPATIAL_CONFIG.TILE_LAYER, {
                    attribution: '©NEXUS INTELLIGENCE',
                    maxZoom: 8,
                    minZoom: 2,
                    noWrap: true
                }).addTo(appState.neuralMap);
                
                // Add custom map controls
                setupMapControls();
                
                console.log('✅ Geospatial Intelligence Map Initialized');
                
            } catch (error) {
                console.error('❌ Neural map initialization failed:', error);
                document.getElementById('neuralMap').innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; font-size: 0.9rem;">
                        <div>
                            <i data-lucide="map" style="width: 24px; height: 24px; margin-bottom: 10px;"></i>
                            <div>Geospatial Intelligence Active</div>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        function plotIntelligenceNodes() {
            if (!appState.neuralMap || !appState.liveArticles.length) return;
            
            // Clear existing markers
            appState.mapMarkers.forEach(marker => {
                if (marker && marker.remove) marker.remove();
            });
            appState.mapMarkers = [];
            
            // Clear pulse intervals
            appState.mapPulseIntervals.forEach(interval => clearInterval(interval));
            appState.mapPulseIntervals = [];
            
            // Group articles by category
            const articlesByCategory = {
                ai: [],
                energy: [],
                policy: [],
                realestate: [],
                breaking: []
            };
            
            appState.liveArticles.forEach(article => {
                if (article.tags.includes('ai')) articlesByCategory.ai.push(article);
                if (article.tags.includes('energy')) articlesByCategory.energy.push(article);
                if (article.tags.includes('policy')) articlesByCategory.policy.push(article);
                if (article.tags.includes('realestate')) articlesByCategory.realestate.push(article);
                if (article.isBreaking) articlesByCategory.breaking.push(article);
            });
            
            // Plot markers for each category
            Object.entries(articlesByCategory).forEach(([category, articles]) => {
                if (articles.length === 0 || (appState.mapActiveFilter !== 'all' && appState.mapActiveFilter !== category)) return;
                
                const nodes = GEOSPATIAL_CONFIG.INTELLIGENCE_NODES[category] || [];
                
                // Distribute articles across nodes
                articles.forEach((article, index) => {
                    const node = nodes[index % nodes.length];
                    if (!node) return;
                    
                    // Calculate marker size based on impact
                    const size = GEOSPATIAL_CONFIG.MARKER_SIZES[article.impactClass] || 12;
                    const color = GEOSPATIAL_CONFIG.MARKER_COLORS[category] || GEOSPATIAL_CONFIG.MARKER_COLORS.general;
                    
                    // Create custom marker with pulse effect
                    const marker = L.circleMarker([node.lat, node.lng], {
                        radius: size,
                        fillColor: color,
                        color: color,
                        weight: 2,
                        opacity: 0.8,
                        fillOpacity: 0.4
                    }).addTo(appState.neuralMap);
                    
                    // Add tooltip with article info
                    const tooltipContent = `
                        <div style="font-size: 0.8rem; max-width: 200px;">
                            <strong>${article.title.substring(0, 60)}...</strong><br>
                            <small>${article.source} • ${article.time}</small><br>
                            <span style="color: ${color}">${category.toUpperCase()}</span>
                            ${article.isBreaking ? '<span style="color: #ff4757;"> • BREAKING</span>' : ''}
                        </div>
                    `;
                    
                    marker.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'top'
                    });
                    
                    // Store marker reference
                    appState.mapMarkers.push(marker);
                    
                    // Add click event to focus on article
                    marker.on('click', () => {
                        openArticleModal(article.id);
                    });
                    
                    // Add pulse animation
                    createMarkerPulse(marker, color);
                });
            });
            
            // Add breaking news as red pulses
            articlesByCategory.breaking.forEach((article, index) => {
                const randomLat = 20 + (Math.random() * 50 - 25);
                const randomLng = (Math.random() * 360 - 180);
                
                const pulseMarker = L.circleMarker([randomLat, randomLng], {
                    radius: 20,
                    fillColor: '#ff4757',
                    color: '#ff4757',
                    weight: 3,
                    opacity: 0,
                    fillOpacity: 0
                }).addTo(appState.neuralMap);
                
                // Animate breaking news pulse
                let radius = 5;
                const interval = setInterval(() => {
                    radius += 2;
                    pulseMarker.setRadius(radius);
                    pulseMarker.setStyle({
                        opacity: 1 - (radius / 40),
                        fillOpacity: 0.6 - (radius / 80)
                    });
                    
                    if (radius > 40) {
                        radius = 5;
                        pulseMarker.setRadius(5);
                        pulseMarker.setStyle({
                            opacity: 0.8,
                            fillOpacity: 0.4
                        });
                    }
                }, 100);
                
                appState.mapPulseIntervals.push(interval);
                appState.mapMarkers.push(pulseMarker);
            });
        }

        function createMarkerPulse(marker, color) {
            let pulseRadius = marker.options.radius;
            const originalRadius = pulseRadius;
            const pulseInterval = setInterval(() => {
                pulseRadius = originalRadius + Math.sin(Date.now() / 1000) * 3;
                marker.setRadius(pulseRadius);
                
                // Fade effect
                const opacity = 0.6 + Math.sin(Date.now() / 800) * 0.2;
                marker.setStyle({
                    fillOpacity: opacity * 0.6,
                    opacity: opacity
                });
            }, 100);
            
            appState.mapPulseIntervals.push(pulseInterval);
        }

        function setupMapControls() {
            // Add filter buttons
            document.getElementById('mapAll').addEventListener('click', () => {
                appState.mapActiveFilter = 'all';
                updateMapButtons('mapAll');
                plotIntelligenceNodes();
            });
            
            document.getElementById('mapAI').addEventListener('click', () => {
                appState.mapActiveFilter = 'ai';
                updateMapButtons('mapAI');
                plotIntelligenceNodes();
            });
            
            document.getElementById('mapEnergy').addEventListener('click', () => {
                appState.mapActiveFilter = 'energy';
                updateMapButtons('mapEnergy');
                plotIntelligenceNodes();
            });
            
            document.getElementById('mapPolicy').addEventListener('click', () => {
                appState.mapActiveFilter = 'policy';
                updateMapButtons('mapPolicy');
                plotIntelligenceNodes();
            });
        }

        function updateMapButtons(activeId) {
            document.querySelectorAll('.map-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(activeId)?.classList.add('active');
        }

        // ===== ENHANCED SAMPLE DATA =====
        function loadEnhancedSampleData() {
            const now = new Date();
            const sampleArticles = [
                {
                    title: "NVIDIA'S BLACKWELL ARCHITECTURE BREAKTHROUGH: 50% ENERGY REDUCTION FOR AI TRAINING",
                    summary: "NVIDIA announces revolutionary Blackwell GPU architecture that dramatically cuts power consumption while doubling AI training performance. The breakthrough could transform data center economics globally and reduce AI's carbon footprint significantly.",
                    source: "TechCrunch",
                    url: "#",
                    publishedAt: new Date(now - 15 * 60000).toISOString()
                },
                {
                    title: "BREAKING: MAJOR CLOUD OUTAGE HITS EUROPEAN DATA CENTERS - MULTIPLE PROVIDERS AFFECTED",
                    summary: "Widespread service disruption affects AWS, Google Cloud, and Azure across European regions. Financial services and healthcare systems report connectivity issues. Initial reports suggest cooling system failure in Frankfurt region.",
                    source: "Reuters",
                    url: "#",
                    publishedAt: new Date(now - 45 * 60000).toISOString()
                },
                {
                    title: "GOOGLE ACHIEVES RECORD 1.08 PUE WITH ADVANCED IMMERSION COOLING IN SINGAPORE",
                    summary: "Google's Singapore data center achieves unprecedented Power Usage Effectiveness using two-phase immersion cooling. The system reduces cooling energy by 65% in tropical climates, setting new industry standard for efficiency.",
                    source: "Data Center Frontier",
                    url: "#",
                    publishedAt: new Date(now - 120 * 60000).toISOString()
                },
                {
                    title: "MICROSOFT COMMITS $25B TO CARBON-NEGATIVE DATA CENTERS BY 2030",
                    summary: "Massive investment targets carbon-negative AI infrastructure through renewable energy microgrids and advanced nuclear reactors. Partnership with TerraPower aims to deploy next-gen nuclear at data center sites.",
                    source: "Bloomberg",
                    url: "#",
                    publishedAt: new Date(now - 180 * 60000).toISOString()
                },
                {
                    title: "FEDERAL AI REGULATION BILL ADVANCES WITH MANDATORY ENERGY DISCLOSURE RULES",
                    summary: "New legislation would require AI companies to report energy usage, data center locations, and water consumption. The bill includes tax incentives for renewable-powered compute and penalties for non-compliance.",
                    source: "The Wall Street Journal",
                    url: "#",
                    publishedAt: new Date(now - 240 * 60000).toISOString()
                },
                {
                    title: "AMAZON LAUNCHES $10B DATA CENTER REAL ESTATE FUND FOR SECONDARY MARKETS",
                    summary: "Amazon Web Services establishes fund to acquire and develop data center properties in secondary markets with renewable energy access. Focus on Midwest and Southeast US regions with favorable power costs.",
                    source: "Reuters",
                    url: "#",
                    publishedAt: new Date(now - 300 * 60000).toISOString()
                },
                {
                    title: "QUANTUM COMPUTING BREAKTHROUGH: HIGH-TEMPERATURE OPERATION ELIMINATES CRYOGENIC NEEDS",
                    summary: "MIT researchers develop quantum processor that operates at higher temperatures, potentially eliminating need for extreme cryogenic cooling. Could dramatically reduce quantum computing infrastructure costs.",
                    source: "MIT News",
                    url: "#",
                    publishedAt: new Date(now - 360 * 60000).toISOString()
                },
                {
                    title: "AI ENERGY CONSUMPTION PROJECTED TO SURPASS SMALL COUNTRIES BY 2026",
                    summary: "New study shows AI compute energy demands growing exponentially, projected to exceed electricity consumption of countries like Sweden by 2026. Calls for urgent efficiency improvements.",
                    source: "MIT Technology Review",
                    url: "#",
                    publishedAt: new Date(now - 420 * 60000).toISOString()
                },
                {
                    title: "DATA CENTER WATER USAGE SPARKS LEGAL BATTLES IN ARIZONA, UTAH",
                    summary: "Growing conflict between data center development and water resources leads to legal challenges in drought-prone Western states. Companies exploring alternative cooling solutions.",
                    source: "Reuters",
                    url: "#",
                    publishedAt: new Date(now - 480 * 60000).toISOString()
                },
                {
                    title: "EUROPEAN UNION UNVEILS AI ENERGY EFFICIENCY STANDARDS FOR DATA CENTERS",
                    summary: "New EU regulations mandate minimum energy efficiency standards for AI training and inference. Rules apply to all data centers operating within EU jurisdiction starting 2025.",
                    source: "Financial Times",
                    url: "#",
                    publishedAt: new Date(now - 540 * 60000).toISOString()
                }
            ];
            
            const processedArticles = processArticles(sampleArticles);
            appState.liveArticles = processedArticles;
            
            updateUI();
        }

        // ===== BASIC PROCESSING FUNCTIONS =====
        function processArticles(articles) {
            return articles.map((article, index) => {
                const tags = extractTags(article.title + ' ' + article.summary);
                const sentiment = analyzeSentiment(article.title, article.summary, tags);
                const impactScore = calculateImpactScore(article, sentiment);
                
                return {
                    id: 'article_' + index + '_' + Date.now(),
                    title: article.title || 'Untitled Article',
                    summary: article.summary || 'No summary available.',
                    source: article.source || 'Unknown Source',
                    sourceIcon: getSourceIcon(article.source),
                    time: formatTime(article.publishedAt || new Date()),
                    readTime: estimateReadTime(article.summary),
                    tags: tags,
                    sentiment: sentiment,
                    impactScore: impactScore,
                    url: article.url || '#',
                    publishedAt: article.publishedAt || new Date().toISOString(),
                    isBreaking: isBreakingNews(article.title, article.summary),
                    sentimentConfidence: sentiment.confidence,
                    sentimentType: sentiment.type,
                    sentimentDescription: getSentimentDescription(sentiment),
                    impactClass: impactScore >= 8 ? 'high' : impactScore >= 6 ? 'medium' : 'low'
                };
            });
        }

        function extractTags(content) {
            const tags = new Set();
            const contentLower = content.toLowerCase();
            
            if (contentLower.includes('ai') || contentLower.includes('artificial intelligence') || 
                contentLower.includes('machine learning') || contentLower.includes('gpu')) {
                tags.add('ai');
            }
            if (contentLower.includes('energy') || contentLower.includes('power') || 
                contentLower.includes('electricity') || contentLower.includes('solar')) {
                tags.add('energy');
            }
            if (contentLower.includes('real estate') || contentLower.includes('property')) {
                tags.add('realestate');
            }
            if (contentLower.includes('policy') || contentLower.includes('regulation')) {
                tags.add('policy');
            }
            if (contentLower.includes('data center') || contentLower.includes('datacenter')) {
                tags.add('datacenter');
            }
            if (contentLower.includes('cooling') || contentLower.includes('thermal')) {
                tags.add('cooling');
            }
            if (isBreakingNews(content, '')) {
                tags.add('breaking');
            }
            
            return Array.from(tags).length > 0 ? Array.from(tags) : ['general'];
        }

        function analyzeSentiment(title, summary, tags) {
            const text = (title + ' ' + summary).toLowerCase();
            let bullishScore = 0;
            let bearishScore = 0;
            
            const bullishKeywords = ['breakthrough', 'innovation', 'record', 'growth', 'surge', 'success', 'efficiency', 'gain', 'approves', 'achieves', 'commits', 'launches'];
            const bearishKeywords = ['outage', 'attack', 'failure', 'risk', 'threat', 'crisis', 'disruption', 'conflict', 'battles', 'consumption', 'usage'];
            
            bullishKeywords.forEach(keyword => {
                if (text.includes(keyword)) bullishScore += 2;
            });
            
            bearishKeywords.forEach(keyword => {
                if (text.includes(keyword)) bearishScore += 2;
            });
            
            const total = bullishScore + bearishScore;
            if (total === 0) return { type: 'neutral', confidence: 50 };
            
            const bullishPercent = (bullishScore / total) * 100;
            
            if (bullishPercent > 60) {
                return { type: 'bullish', confidence: Math.min(95, bullishPercent) };
            } else if (bullishPercent < 40) {
                return { type: 'bearish', confidence: Math.min(95, 100 - bullishPercent) };
            } else {
                return { type: 'neutral', confidence: 50 };
            }
        }

        function calculateImpactScore(article, sentiment) {
            let score = 5;
            
            const credibleSources = ['Reuters', 'Bloomberg', 'Financial Times', 'Wall Street Journal', 'MIT'];
            if (credibleSources.some(src => article.source?.includes(src))) score += 2;
            
            if (article.isBreaking) score += 2;
            
            if (sentiment.confidence > 80) score += 1.5;
            else if (sentiment.confidence > 60) score += 1;
            
            return Math.min(10, Math.max(1, score));
        }

        function getSourceIcon(source) {
            if (source.includes('TechCrunch')) return 'techcrunch';
            if (source.includes('Reuters')) return 'reuters';
            if (source.includes('Bloomberg')) return 'bloomberg';
            if (source.includes('MIT')) return 'mit';
            if (source.includes('Data Center')) return 'dcf';
            if (source.includes('Financial Times')) return 'ft';
            if (source.includes('Wall Street')) return 'wsj';
            if (source.includes('Gemini')) return 'mit';
            return 'mit';
        }

        function formatTime(dateString) {
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) return 'JUST NOW';
                if (diffMins < 60) return `${diffMins}M AGO`;
                if (diffMins < 1440) return `${Math.floor(diffMins/60)}H AGO`;
                return `${Math.floor(diffMins/1440)}D AGO`;
            } catch {
                return 'RECENT';
            }
        }

        function estimateReadTime(content) {
            if (!content) return '2 MIN';
            const words = content.split(/\s+/).length;
            return `${Math.max(1, Math.ceil(words/200))} MIN`;
        }

        function isBreakingNews(title, summary) {
            const text = (title + ' ' + summary).toLowerCase();
            return text.includes('breaking') || text.includes('urgent') || text.includes('alert') || text.includes('outage');
        }

        function getSentimentDescription(sentiment) {
            if (sentiment.confidence >= 85) {
                return sentiment.type === 'bullish' ? 'EXTREMELY BULLISH' : 'EXTREMELY BEARISH';
            } else if (sentiment.confidence >= 70) {
                return sentiment.type === 'bullish' ? 'STRONGLY BULLISH' : 'STRONGLY BEARISH';
            } else {
                return sentiment.type === 'bullish' ? 'BULLISH' : sentiment.type === 'bearish' ? 'BEARISH' : 'NEUTRAL';
            }
        }

        // ===== PHASE 4: HIGH-FREQUENCY SIGNAL DETECTION =====
        class SignalDetector {
            constructor() {
                this.criticalKeywords = ['critical', 'emergency', 'outage', 'attack', 'breach', 'crisis'];
                this.alertKeywords = ['warning', 'alert', 'risk', 'threat', 'problem'];
                this.infoKeywords = ['update', 'announcement', 'launch', 'partnership'];
            }

            analyzeText(text) {
                const lowerText = text.toLowerCase();
                let signalType = 'info';
                
                this.criticalKeywords.forEach(keyword => {
                    if (lowerText.includes(keyword)) signalType = 'critical';
                });
                
                if (signalType !== 'critical') {
                    this.alertKeywords.forEach(keyword => {
                        if (lowerText.includes(keyword)) signalType = 'alert';
                    });
                }
                
                return {
                    type: signalType,
                    timestamp: new Date(),
                    text: text.substring(0, 80) + (text.length > 80 ? '...' : '')
                };
            }
        }

        const signalDetector = new SignalDetector();

        // ===== PHASE 4: REAL-TIME SENTIMENT CHART =====
        function initSentimentChart() {
            const options = {
                series: [{
                    name: 'Sentiment Index',
                    data: appState.sentimentHistory
                }],
                chart: {
                    type: 'area',
                    height: 150,
                    toolbar: { show: false },
                    animations: { enabled: true, speed: 800 },
                    zoom: { enabled: false },
                    foreColor: '#b0b0c0',
                    background: 'transparent'
                },
                colors: ['#00ff9d'],
                dataLabels: { enabled: false },
                stroke: {
                    curve: 'smooth',
                    width: 2,
                    colors: ['#00ff9d']
                },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.4,
                        opacityTo: 0.1,
                        stops: [0, 90, 100]
                    }
                },
                grid: {
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    strokeDashArray: 3,
                    padding: { top: 0, right: 0, bottom: 0, left: 0 }
                },
                xaxis: {
                    labels: { show: false },
                    axisBorder: { show: false },
                    axisTicks: { show: false },
                    categories: Array.from({ length: appState.sentimentHistory.length }, (_, i) => i + 1)
                },
                yaxis: {
                    labels: { show: false },
                    min: 0,
                    max: 100
                },
                tooltip: {
                    enabled: true,
                    theme: 'dark',
                    x: { show: false }
                },
                markers: {
                    size: 0,
                    colors: ['#00ff9d'],
                    strokeColors: '#00ff9d',
                    strokeWidth: 2,
                    hover: { size: 4 }
                }
            };

            appState.sentimentChart = new ApexCharts(document.querySelector("#sentimentChart"), options);
            appState.sentimentChart.render();
        }

        function updateSentimentChart() {
            if (!appState.sentimentChart) return;

            const total = appState.liveArticles.length;
            if (total === 0) return;

            const bullishCount = appState.sentimentData.bullish;
            let sentimentScore = 50;
            
            if (total > 0) {
                sentimentScore = ((bullishCount / total) * 70) + 15;
                sentimentScore = Math.max(0, Math.min(100, sentimentScore));
            }

            appState.sentimentHistory.push(Math.round(sentimentScore));
            if (appState.sentimentHistory.length > 30) {
                appState.sentimentHistory.shift();
            }

            appState.sentimentChart.updateSeries([{
                data: appState.sentimentHistory
            }]);
        }

        // ===== PHASE 4: SIGNAL TICKER =====
        function updateSignalTicker() {
            const tickerContainer = document.getElementById('signalTicker');
            if (!tickerContainer) return;

            let tickerItems = [];
            
            // Add breaking news to ticker
            appState.breakingNews.slice(0, 2).forEach(article => {
                const signal = signalDetector.analyzeText(article.title);
                signal.type = 'critical';
                tickerItems.push({
                    html: `<div class="ticker-item critical">🚨 ${signal.text}</div>`,
                    signal: signal
                });
            });

            // Add system status
            if (tickerItems.length === 0) {
                tickerItems.push({
                    html: '<div class="ticker-item info">⚡ GEOSPATIAL INTELLIGENCE ACTIVE</div>',
                    signal: { type: 'info', text: 'Geospatial intelligence active' }
                });
            }

            // Update ticker with multiple copies for smooth scrolling
            let tickerHTML = '';
            for (let i = 0; i < 5; i++) {
                tickerItems.forEach(item => {
                    tickerHTML += item.html;
                });
            }
            
            tickerContainer.innerHTML = tickerHTML;
        }

        // ===== PHASE 4: LIVE STATS PANEL =====
        function updateLiveStats() {
            const statsGrid = document.getElementById('liveStatsGrid');
            if (!statsGrid) return;

            const totalArticles = appState.liveArticles.length;
            const breakingCount = appState.breakingNews.length;
            const highImpactCount = appState.liveArticles.filter(a => a.impactClass === 'high').length;
            const signalStrength = Math.min(100, (breakingCount * 40) + (highImpactCount * 20));
            
            // Count map markers by category
            const aiMarkers = appState.mapMarkers.filter(m => m.options.fillColor === '#0095ff').length;
            const energyMarkers = appState.mapMarkers.filter(m => m.options.fillColor === '#00ff9d').length;
            const policyMarkers = appState.mapMarkers.filter(m => m.options.fillColor === '#8a2be2').length;
            const totalMarkers = aiMarkers + energyMarkers + policyMarkers;

            appState.liveStats = {
                articlesProcessed: totalArticles,
                signalStrength: Math.round(signalStrength),
                volatilityIndex: Math.round(Math.random() * 40 + 10),
                refreshRate: Math.round(totalArticles / 60 * 10)
            };

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalMarkers}</div>
                    <div class="stat-label">MAP NODES</div>
                    <div class="trend up">ACTIVE</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Math.round(signalStrength)}%</div>
                    <div class="stat-label">SIGNAL</div>
                    <div class="trend ${signalStrength > 50 ? 'up' : 'down'}">${signalStrength > 50 ? 'STRONG' : 'WEAK'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Math.round(appState.liveStats.volatilityIndex)}%</div>
                    <div class="stat-label">VOLATILITY</div>
                    <div class="trend ${appState.liveStats.volatilityIndex > 30 ? 'up' : 'down'}">${appState.liveStats.volatilityIndex > 30 ? 'HIGH' : 'LOW'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${appState.liveStats.refreshRate}/min</div>
                    <div class="stat-label">REFRESH RATE</div>
                    <div class="trend ${appState.liveStats.refreshRate > 5 ? 'up' : 'down'}">${appState.liveStats.refreshRate > 5 ? 'FAST' : 'SLOW'}</div>
                </div>
            `;
        }

        // ===== CORE UI FUNCTIONS =====
        function renderArticles() {
            const container = document.getElementById('articlesContainer');
            if (!container) return;
            
            let articlesToShow = [...appState.liveArticles];
            
            // Apply filter
            if (appState.currentFilter !== 'all') {
                if (appState.currentFilter === 'breaking') {
                    articlesToShow = appState.breakingNews;
                } else if (appState.currentFilter === 'saved') {
                    articlesToShow = articlesToShow.filter(article => 
                        appState.savedArticles.includes(article.id)
                    );
                } else {
                    articlesToShow = articlesToShow.filter(article => 
                        article.tags.includes(appState.currentFilter)
                    );
                }
            }
            
            // Apply view
            if (appState.currentView === 'top') {
                articlesToShow.sort((a, b) => b.impactScore - a.impactScore);
            } else if (appState.currentView === 'bullish') {
                articlesToShow = articlesToShow.filter(a => a.sentimentType === 'bullish');
            } else if (appState.currentView === 'saved') {
                articlesToShow = articlesToShow.filter(article => 
                    appState.savedArticles.includes(article.id)
                );
            } else {
                articlesToShow.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
            }
            
            if (articlesToShow.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i data-lucide="newspaper" style="width: 48px; height: 48px;"></i>
                        <h3>NO ARTICLES FOUND</h3>
                        <p>TRY A DIFFERENT FILTER OR SEARCH TERM</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            const articlesHTML = articlesToShow.map(article => {
                const isSaved = appState.savedArticles.includes(article.id);
                const aiAnalysisId = `ai-analysis-${article.id}`;
                
                return `
                <article class="news-card ${article.isBreaking ? 'breaking' : ''}" data-id="${article.id}">
                    <div class="card-header">
                        <div class="card-source">
                            <div class="source-icon ${article.sourceIcon}">
                                ${article.source.substring(0, 2).toUpperCase()}
                            </div>
                            <span>${article.source}</span>
                            <span>•</span>
                            <span>${article.time}</span>
                            ${isSaved ? '<span>•</span><span style="color: #00ff9d;"><i data-lucide="bookmark" style="width: 12px; height: 12px;"></i> SAVED</span>' : ''}
                        </div>
                        <div class="card-time">
                            <i data-lucide="clock"></i> ${article.readTime}
                        </div>
                    </div>
                    
                    <h3 class="card-title" onclick="openArticleModal('${article.id}')">
                        ${article.isBreaking ? '🚨 ' : ''}${article.title}
                    </h3>
                    
                    <p class="card-summary">${article.summary}</p>
                    
                    <!-- AI Analysis Section - Now Collapsible -->
                    <div class="ai-analysis-collapsible">
                        <div class="ai-analysis-header" onclick="window.app.toggleAnalysis('${article.id}', this)">
                            <i data-lucide="brain" style="width: 16px; height: 16px; color: #0095ff;"></i>
                            <h4>AI ANALYSIS</h4>
                            <i data-lucide="chevron-down" class="ai-analysis-chevron" style="margin-left: auto; width: 16px; height: 16px;"></i>
                        </div>
                        <div class="ai-analysis-content" id="${aiAnalysisId}">
                            <div style="font-size: 0.85rem; color: #b0b0c0;">
                                ${generateAIAnalysis(article).map(point => `
                                    <div style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px;">
                                        <i data-lucide="chevron-right" style="width: 12px; height: 12px; color: #0095ff; flex-shrink: 0; margin-top: 2px;"></i>
                                        <span>${point}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-tags">
                        <div class="sentiment-badge ${article.sentimentType}">
                            <i data-lucide="${article.sentimentType === 'bullish' ? 'trending-up' : article.sentimentType === 'bearish' ? 'trending-down' : 'minus'}"></i>
                            ${article.sentimentDescription}
                        </div>
                        
                        ${article.tags.map(tag => `
                            <div class="tag ${tag}">
                                ${tag.toUpperCase()}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="card-footer">
                        <div class="impact-score">
                            <span class="impact-label">IMPACT SCORE:</span>
                            <span class="impact-value ${article.impactClass}">${article.impactScore.toFixed(1)}</span>
                            <span class="impact-label" style="margin-left: 10px;">(${article.impactClass.toUpperCase()})</span>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn ${isSaved ? 'bookmarked' : ''}" 
                                    title="${isSaved ? 'Remove from saved' : 'Save article'}" 
                                    onclick="window.app.toggleSave('${article.id}', this)">
                                <i data-lucide="${isSaved ? 'bookmark-check' : 'bookmark'}"></i>
                            </button>
                            <button class="action-btn" title="Share" onclick="window.app.shareArticle('${article.id}')">
                                <i data-lucide="share-2"></i>
                            </button>
                            <button class="action-btn" title="View Full Article" onclick="openArticleModal('${article.id}')">
                                <i data-lucide="external-link"></i>
                            </button>
                        </div>
                    </div>
                </article>
            `}).join('');
            
            container.innerHTML = articlesHTML;
            lucide.createIcons();
        }

        function updateUI() {
            // Detect breaking news
            appState.breakingNews = appState.liveArticles.filter(article => article.isBreaking);
            
            // Update sentiment analysis
            appState.sentimentData = { bullish: 0, bearish: 0, neutral: 0 };
            appState.liveArticles.forEach(article => {
                appState.sentimentData[article.sentimentType]++;
            });
            
            // Update impact distribution
            appState.impactDistribution = { high: 0, medium: 0, low: 0 };
            appState.liveArticles.forEach(article => {
                appState.impactDistribution[article.impactClass]++;
            });
            
            // Update UI components
            updateBullBearMeter();
            renderArticles();
            updateFeedStats();
            updateTLDR();
            updateTrendingTopics();
            
            // Phase 4 updates
            updateSentimentChart();
            updateSignalTicker();
            updateLiveStats();
            renderSystemHealth();
            renderImpactDistribution();
            renderHeatmap();
            
            // Phase 5: Update geospatial intelligence
            plotIntelligenceNodes();
            
            // Show/hide breaking banner
            const banner = document.getElementById('breakingBanner');
            const breakingText = document.getElementById('breakingText');
            
            if (appState.breakingNews.length > 0) {
                banner.style.display = 'flex';
                breakingText.textContent = `${appState.breakingNews.length} BREAKING ALERT${appState.breakingNews.length > 1 ? 'S' : ''} DETECTED`;
            } else {
                banner.style.display = 'none';
            }
            
            // Update saved view indicator
            const savedIndicator = document.getElementById('savedViewIndicator');
            const savedCountText = document.getElementById('savedCountText');
            if (appState.currentView === 'saved' || appState.currentFilter === 'saved') {
                savedIndicator.style.display = 'flex';
                savedCountText.textContent = `${appState.savedArticles.length} SAVED ARTICLES`;
            } else {
                savedIndicator.style.display = 'none';
            }
        }

        function updateBullBearMeter() {
            const total = appState.liveArticles.length;
            if (total === 0) {
                document.getElementById('sentimentMeterFill').style.width = '50%';
                document.getElementById('sentimentValue').textContent = 'NEUTRAL';
                document.getElementById('sentimentValue').style.color = '#9595ff';
                return;
            }
            
            const bullishPercent = (appState.sentimentData.bullish / total) * 100;
            const bearishPercent = (appState.sentimentData.bearish / total) * 100;
            
            let meterPosition = 50;
            let sentimentValue = 'NEUTRAL';
            let sentimentClass = 'neutral';
            
            if (bullishPercent > bearishPercent + 10) {
                meterPosition = 50 + (bullishPercent - bearishPercent) / 2;
                sentimentValue = 'BULLISH';
                sentimentClass = 'bullish';
            } else if (bearishPercent > bullishPercent + 10) {
                meterPosition = 50 - (bearishPercent - bullishPercent) / 2;
                sentimentValue = 'BEARISH';
                sentimentClass = 'bearish';
            }
            
            const meterFill = document.getElementById('sentimentMeterFill');
            const sentimentValueElement = document.getElementById('sentimentValue');
            
            if (meterFill) {
                meterFill.style.width = `${Math.max(5, Math.min(95, meterPosition))}%`;
                meterFill.className = `meter-fill ${sentimentClass}`;
            }
            
            if (sentimentValueElement) {
                sentimentValueElement.textContent = sentimentValue;
                sentimentValueElement.style.color = 
                    sentimentValue === 'BULLISH' ? '#00ff9d' : 
                    sentimentValue === 'BEARISH' ? '#ff4757' : '#9595ff';
            }
            
            updateSentimentBreakdown();
        }

        function updateSentimentBreakdown() {
            const container = document.getElementById('sentimentBreakdown');
            if (!container) return;
            
            const total = appState.liveArticles.length;
            if (total === 0) {
                container.innerHTML = '<div class="sentiment-item"><span>No data available</span></div>';
                return;
            }
            
            const bullishPercent = Math.round((appState.sentimentData.bullish / total) * 100);
            const bearishPercent = Math.round((appState.sentimentData.bearish / total) * 100);
            const neutralPercent = Math.round((appState.sentimentData.neutral / total) * 100);
            
            container.innerHTML = `
                <div class="sentiment-item">
                    <div class="sentiment-dot bullish"></div>
                    <span>BULLISH: ${bullishPercent}% (${appState.sentimentData.bullish})</span>
                </div>
                <div class="sentiment-item">
                    <div class="sentiment-dot bearish"></div>
                    <span>BEARISH: ${bearishPercent}% (${appState.sentimentData.bearish})</span>
                </div>
                <div class="sentiment-item">
                    <div class="sentiment-dot neutral"></div>
                    <span>NEUTRAL: ${neutralPercent}% (${appState.sentimentData.neutral})</span>
                </div>
            `;
        }

        function updateFeedStats() {
            const lastUpdate = document.getElementById('lastUpdateTime');
            const articleCount = document.getElementById('articleCount');
            const liveStatus = document.getElementById('liveStatus');
            const geminiStatus = document.getElementById('geminiStatus');
            
            if (lastUpdate) {
                const now = new Date();
                lastUpdate.textContent = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            
            if (articleCount) {
                articleCount.textContent = `${appState.liveArticles.length} ARTICLES`;
            }
            
            if (liveStatus) {
                liveStatus.textContent = 'REALTIME';
                liveStatus.style.color = '#00ff9d';
            }
            
            if (geminiStatus) {
                const geminiArticles = appState.liveArticles.filter(a => a.source.includes('Gemini')).length;
                geminiStatus.innerHTML = `<i data-lucide="brain"></i><span>GEMINI: ${geminiArticles} ARTICLES</span>`;
            }
        }

        function updateTLDR() {
            const container = document.getElementById('tldrContainer');
            if (!container || appState.liveArticles.length === 0) return;
            
            const topArticles = [...appState.liveArticles]
                .sort((a, b) => b.impactScore - a.impactScore)
                .slice(0, 3);
            
            container.innerHTML = `
                <div class="tldr-header">
                    <i data-lucide="sparkles"></i>
                    <h4>TOP INTELLIGENCE BRIEF</h4>
                </div>
                <div class="tldr-content">
                    ${topArticles.map((article, index) => `
                        <div class="tldr-item">
                            <span class="tldr-bullet">${index + 1}.</span>
                            <span class="tldr-text">
                                <strong>${article.title.substring(0, 70)}${article.title.length > 70 ? '...' : ''}</strong><br>
                                <small style="color: #7a7a8a; font-size: 0.8rem;">
                                    ${article.source} • ${article.time} • Impact: ${article.impactScore.toFixed(1)}
                                </small>
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            lucide.createIcons();
        }

        function updateTrendingTopics() {
            const container = document.getElementById('trendingTopics');
            if (!container) return;
            
            const tagCounts = {};
            appState.liveArticles.forEach(article => {
                article.tags.forEach(tag => {
                    if (tag !== 'breaking' && tag !== 'saved') {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    }
                });
            });
            
            const topTags = Object.entries(tagCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            if (topTags.length === 0) {
                container.innerHTML = `
                    <div class="heatmap-item">
                        <div class="heatmap-label">
                            <i data-lucide="hash" style="color: #9595ff"></i>
                            <span>NO TRENDING TOPICS</span>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = topTags.map(([tag, count]) => {
                const dotClass = tag === 'ai' ? 'ai' : 
                                tag === 'energy' ? 'energy' : 
                                tag === 'realestate' ? 'realestate' : 
                                tag === 'policy' ? 'policy' : 'data';
                
                return `
                    <div class="heatmap-item">
                        <div class="heatmap-label">
                            <div class="heatmap-dot ${dotClass}"></div>
                            <span>${tag.toUpperCase()}</span>
                        </div>
                        <div class="heatmap-value">${count}</div>
                    </div>
                `;
            }).join('');
        }

        function renderHeatmap() {
            const container = document.getElementById('heatmapContainer');
            if (!container) return;
            
            const heatmapData = [
                { label: 'AI Compute Demand', value: '+42%', type: 'ai', trend: 'up' },
                { label: 'Energy Prices (EU)', value: '€145/MWH', type: 'energy', trend: 'down' },
                { label: 'Data Center Vacancy', value: '2.3%', type: 'data', trend: 'down' },
                { label: 'Carbon Intensity', value: '0.41 kg/kWh', type: 'energy', trend: 'down' },
                { label: 'Real Estate Yield', value: '6.8%', type: 'realestate', trend: 'up' },
                { label: 'Policy Changes', value: '12 new', type: 'policy', trend: 'up' }
            ];
            
            container.innerHTML = heatmapData.map(item => `
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot ${item.type}"></div>
                        <span>${item.label}</span>
                    </div>
                    <div class="heatmap-value" style="color: ${item.trend === 'up' ? '#00ff9d' : '#ff4757'}">
                        ${item.value} ${item.trend === 'up' ? '↗' : '↘'}
                    </div>
                </div>
            `).join('');
        }

        function renderImpactDistribution() {
            const container = document.getElementById('impactDistribution');
            if (!container) return;
            
            const total = appState.liveArticles.length;
            if (total === 0) {
                container.innerHTML = `
                    <div class="heatmap-item">
                        <div class="heatmap-label">
                            <i data-lucide="bar-chart-3" style="color: #9595ff"></i>
                            <span>NO DATA YET</span>
                        </div>
                        <div class="heatmap-value" style="color: #9595ff">--</div>
                    </div>
                `;
                return;
            }
            
            const highPercent = Math.round((appState.impactDistribution.high / total) * 100);
            const mediumPercent = Math.round((appState.impactDistribution.medium / total) * 100);
            const lowPercent = Math.round((appState.impactDistribution.low / total) * 100);
            
            container.innerHTML = `
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot" style="background-color: #00ff9d"></div>
                        <span>HIGH IMPACT</span>
                    </div>
                    <div class="heatmap-value" style="color: #00ff9d">${highPercent}%</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot" style="background-color: #ffa500"></div>
                        <span>MEDIUM IMPACT</span>
                    </div>
                    <div class="heatmap-value" style="color: #ffa500">${mediumPercent}%</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot" style="background-color: #ff4757"></div>
                        <span>LOW IMPACT</span>
                    </div>
                    <div class="heatmap-value" style="color: #ff4757">${lowPercent}%</div>
                </div>
            `;
        }

        function renderSystemHealth() {
            const container = document.getElementById('systemHealth');
            if (!container) return;
            
            const savedCount = appState.savedArticles.length;
            const breakingCount = appState.breakingNews.length;
            const mapNodes = appState.mapMarkers.length;
            const geminiArticles = appState.liveArticles.filter(a => a.source.includes('Gemini')).length;
            
            container.innerHTML = `
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot" style="background-color: #00ff9d"></div>
                        <span>SYSTEM STATUS</span>
                    </div>
                    <div class="heatmap-value" style="color: #00ff9d">OPERATIONAL</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot" style="background-color: #0095ff"></div>
                        <span>GEMINI ARTICLES</span>
                    </div>
                    <div class="heatmap-value" style="color: #0095ff">${geminiArticles}</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot" style="background-color: #c792ea"></div>
                        <span>ARTICLES SAVED</span>
                    </div>
                    <div class="heatmap-value" style="color: #c792ea">${savedCount}</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot" style="background-color: #ff4757"></div>
                        <span>BREAKING ALERTS</span>
                    </div>
                    <div class="heatmap-value" style="color: #ff4757">${breakingCount}</div>
                </div>
            `;
        }

        // ===== EVENT HANDLERS =====
        function setupEventListeners() {
            // Refresh button
            document.getElementById('refreshFeed').addEventListener('click', () => {
                if (appState.geminiEnabled) {
                    fetchGeminiRealTimeData();
                } else {
                    loadEnhancedSampleData();
                }
                showNotification("FEED REFRESHED", "success");
            });
            
            // Filter chips
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', (e) => {
                    const filter = e.currentTarget.dataset.filter;
                    
                    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    appState.currentFilter = filter;
                    
                    renderArticles();
                    
                    // Also update map filter if applicable
                    if (['ai', 'energy', 'policy', 'realestate'].includes(filter)) {
                        appState.mapActiveFilter = filter;
                        updateMapButtons(`map${filter.toUpperCase()}`);
                        plotIntelligenceNodes();
                    } else if (filter === 'all') {
                        appState.mapActiveFilter = 'all';
                        updateMapButtons('mapAll');
                        plotIntelligenceNodes();
                    }
                });
            });
            
            // Gemini Real-time button
            document.getElementById('geminiRealTimeBtn').addEventListener('click', () => {
                if (appState.geminiEnabled) {
                    fetchGeminiRealTimeData();
                    showNotification("FETCHING REAL-TIME GEMINI ANALYSIS", "info");
                } else {
                    showNotification("ENABLE GEMINI IN SETTINGS FIRST", "warning");
                }
            });
            
            // View buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const view = e.currentTarget.dataset.view;
                    
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    appState.currentView = view;
                    
                    renderArticles();
                });
            });
            
            // Saved view button
            document.getElementById('savedViewBtn').addEventListener('click', () => {
                appState.currentView = 'saved';
                appState.currentFilter = 'saved';
                
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                document.querySelector('.view-btn[data-view="saved"]').classList.add('active');
                
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                document.querySelector('.filter-chip[data-filter="saved"]').classList.add('active');
                
                renderArticles();
            });
            
            // Article modal close button
            document.getElementById('closeModal').addEventListener('click', closeArticleModal);
            
            // Close modal when clicking outside
            document.getElementById('articleModal').addEventListener('click', (e) => {
                if (e.target.id === 'articleModal') {
                    closeArticleModal();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && document.getElementById('articleModal').style.display === 'flex') {
                    closeArticleModal();
                }
            });
        }

        // ===== GLOBAL APP OBJECT =====
        window.app = {
            toggleSave: function(articleId, button) {
                const index = appState.savedArticles.indexOf(articleId);
                const icon = button.querySelector('i');
                
                if (index === -1) {
                    // Save article
                    appState.savedArticles.push(articleId);
                    button.classList.add('bookmarked');
                    icon.setAttribute('data-lucide', 'bookmark-check');
                    
                    // Visual feedback
                    button.style.animation = 'bookmarkPulse 0.3s ease';
                    setTimeout(() => {
                        button.style.animation = '';
                    }, 300);
                    
                    showNotification("ARTICLE SAVED", "success");
                } else {
                    // Remove from saved
                    appState.savedArticles.splice(index, 1);
                    button.classList.remove('bookmarked');
                    icon.setAttribute('data-lucide', 'bookmark');
                    
                    showNotification("ARTICLE REMOVED FROM SAVED", "info");
                }
                
                // Save to localStorage
                localStorage.setItem('nexus_saved_articles', JSON.stringify(appState.savedArticles));
                
                // Update UI if in saved view
                if (appState.currentView === 'saved' || appState.currentFilter === 'saved') {
                    renderArticles();
                }
                
                lucide.createIcons();
            },
            
            shareArticle: function(articleId) {
                const article = appState.liveArticles.find(a => a.id === articleId);
                if (!article) return;
                
                const shareText = `${article.title}\n\n${article.summary}\n\nRead more in Nexus Intelligence`;
                
                if (navigator.share) {
                    navigator.share({
                        title: article.title,
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(shareText);
                    showNotification("COPIED TO CLIPBOARD", "success");
                }
            },
            
            analyzeWithGemini: async function(articleId) {
                const article = appState.liveArticles.find(a => a.id === articleId);
                if (!article) return;
                
                try {
                    const analysis = await gemini.analyzeArticle(article);
                    showNotification("GEMINI ANALYSIS COMPLETE", "success");
                    
                    // Create analysis modal
                    const modal = document.createElement('div');
                    modal.className = 'search-modal';
                    modal.style.display = 'flex';
                    modal.innerHTML = `
                        <div style="width: 90%; max-width: 600px; background: #111118; border-radius: 12px; padding: 30px; border: 1px solid #2a2a3a;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="display: flex; align-items: center; gap: 10px;">
                                    <i data-lucide="brain" style="color: #0095ff;"></i>
                                    GEMINI DEEP ANALYSIS
                                </h3>
                                <button id="closeAnalysis" class="action-btn">
                                    <i data-lucide="x"></i>
                                </button>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <h4>${article.title}</h4>
                                <p style="color: #b0b0c0; margin-top: 10px;">${article.summary}</p>
                            </div>
                            <div style="background: rgba(0, 149, 255, 0.05); border-radius: 8px; padding: 20px;">
                                <div style="white-space: pre-wrap; color: #b0b0c0; line-height: 1.6;">${analysis}</div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    lucide.createIcons();
                    
                    document.getElementById('closeAnalysis').addEventListener('click', () => {
                        modal.remove();
                    });
                    
                } catch (error) {
                    console.error('Gemini analysis failed:', error);
                    showNotification("ANALYSIS FAILED - TRY AGAIN", "error");
                }
            },
            
            toggleAnalysis: function(articleId, header) {
                const content = document.getElementById(`ai-analysis-${articleId}`);
                const chevron = header.querySelector('.ai-analysis-chevron');
                
                if (content.classList.contains('collapsed')) {
                    // Expand
                    content.classList.remove('collapsed');
                    chevron.setAttribute('data-lucide', 'chevron-up');
                } else {
                    // Collapse
                    content.classList.add('collapsed');
                    chevron.setAttribute('data-lucide', 'chevron-down');
                }
                
                lucide.createIcons();
            },
            
            openArticleModal: openArticleModal,
            closeArticleModal: closeArticleModal
        };

        function showNotification(message, type = "info") {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            const icons = {
                success: "check-circle",
                error: "alert-circle",
                warning: "alert-triangle",
                info: "info"
            };
            
            notification.innerHTML = `
                <i data-lucide="${icons[type] || 'info'}"></i>
                <span>${message}</span>
            `;
            
            const colors = {
                error: { bg: 'rgba(255, 71, 87, 0.1)', border: '#ff4757' },
                success: { bg: 'rgba(0, 255, 157, 0.1)', border: '#00ff9d' },
                info: { bg: 'rgba(0, 149, 255, 0.1)', border: '#0095ff' }
            };
            
            const color = colors[type] || colors.info;
            notification.style.background = color.bg;
            notification.style.borderColor = color.border;
            notification.style.color = color.border;
            
            document.body.appendChild(notification);
            lucide.createIcons();
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ===== INITIALIZATION =====
        function init() {
            console.log('🚀 Initializing Nexus Intelligence...');
            
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Load initial data
            loadEnhancedSampleData();
            
            // Initialize neural map (Phase 5)
            initNeuralMap();
            
            // Initialize sentiment chart
            initSentimentChart();
            
            // Initialize search and settings
            initSearch();
            initSettings();
            
            // Setup event listeners
            setupEventListeners();
            
            // Set up Gemini real-time interval if enabled
            if (appState.geminiEnabled) {
                appState.geminiRealTimeInterval = setInterval(() => {
                    fetchGeminiRealTimeData();
                }, 300000); // 5 minutes
            }
            
            // Apply saved cyberpunk setting
            if (appState.cyberpunkMode) {
                document.body.classList.add('cyberpunk-active');
                document.querySelectorAll('.scanlines, .crt-flicker, .glow-overlay').forEach(el => {
                    el.style.display = 'block';
                });
            }
            
            // Show welcome notification
            setTimeout(() => {
                showNotification("GEOSPATIAL INTELLIGENCE NETWORK ONLINE", "success");
            }, 500);
            
            appState.isInitialized = true;
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>