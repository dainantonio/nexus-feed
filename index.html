<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS FEED | AI × Data × Energy × Policy Intelligence</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        :root {
            --color-bg-dark: #0a0a0f;
            --color-bg-card: #111118;
            --color-bg-sidebar: #0d0d14;
            --color-electric-green: #00ff9d;
            --color-data-blue: #0095ff;
            --color-accent-purple: #8a2be2;
            --color-text-primary: #ffffff;
            --color-text-secondary: #b0b0c0;
            --color-text-muted: #7a7a8a;
            --color-border: #2a2a3a;
            --color-tag-energy: rgba(0, 255, 157, 0.1);
            --color-tag-ai: rgba(0, 149, 255, 0.1);
            --color-tag-policy: rgba(138, 43, 226, 0.1);
            --color-tag-realestate: rgba(255, 165, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            
            /* Sentiment Colors */
            --sentiment-bullish: rgba(0, 255, 157, 0.2);
            --sentiment-bearish: rgba(255, 71, 87, 0.2);
            --sentiment-neutral: rgba(149, 149, 255, 0.2);
            --sentiment-bullish-text: #00ff9d;
            --sentiment-bearish-text: #ff4757;
            --sentiment-neutral-text: #9595ff;
            
            /* Cyberpunk Effects */
            --scanline-color: rgba(0, 255, 157, 0.03);
            --glow-intensity: 0.5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--color-bg-dark);
            color: var(--color-text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* ===== CYBERPUNK EFFECTS ===== */
        .cyberpunk-active .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                var(--scanline-color) 51%
            );
            background-size: 100% 4px;
            z-index: 9998;
            pointer-events: none;
            animation: scanlines 8s linear infinite;
        }

        .cyberpunk-active .crt-flicker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                rgba(18, 16, 16, 0) 50%,
                rgba(0, 0, 0, 0.25) 50%
            );
            background-size: 100% 2px;
            z-index: 9999;
            pointer-events: none;
            opacity: 0.1;
            animation: flicker 0.15s infinite;
        }

        .cyberpunk-active .glow-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                circle at 20% 50%,
                rgba(0, 255, 157, 0.05) 0%,
                transparent 50%
            ),
            radial-gradient(
                circle at 80% 20%,
                rgba(0, 149, 255, 0.05) 0%,
                transparent 50%
            );
            z-index: 9997;
            pointer-events: none;
        }

        @keyframes scanlines {
            from { background-position: 0 0; }
            to { background-position: 0 8px; }
        }

        @keyframes flicker {
            0% { opacity: 0.1; }
            50% { opacity: 0.15; }
            100% { opacity: 0.1; }
        }

        .settings-option select {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text-primary);
            padding: 0.5rem;
            font-size: 0.9rem;
            min-width: 150px;
        }

        .settings-option input[type="range"] {
            width: 100px;
            background: transparent;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: var(--color-border);
            border-radius: 2px;
            outline: none;
        }

        .settings-option input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--color-electric-green);
            border-radius: 50%;
            cursor: pointer;
        }

        .settings-option input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--color-electric-green);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .settings-group h4 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
            color: var(--color-text-primary);
            font-size: 1rem;
        }

        /* ===== MAIN LAYOUT ===== */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: auto 1fr auto;
            min-height: 100vh;
            gap: 0;
        }

        .app-header {
            grid-column: 1 / -1;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--color-electric-green), var(--color-data-blue));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--color-text-primary), var(--color-electric-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .action-btn {
            width: 40px;
            height: 40px;
        }

        /* ===== INTELLIGENCE AGGREGATOR - BULL/BEAR METER ===== */
        .intelligence-aggregator {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, #111118, #1a1a24);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .aggregator-content {
            display: flex;
            align-items: center;
            gap: 2rem;
            width: 100%;
        }

        .bull-bear-meter {
            min-width: 220px;
            flex-shrink: 0;
        }

        .meter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            gap: 15px;
        }

        .meter-label {
            font-size: 0.9rem;
            color: var(--color-text-muted);
            white-space: nowrap;
        }

        .meter-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-electric-green);
            white-space: nowrap;
        }

        .meter-gauge {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            margin-bottom: 8px;
        }

        .meter-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .meter-fill.bullish {
            background: linear-gradient(90deg, #00ff9d, #00cc7a);
        }

        .meter-fill.bearish {
            background: linear-gradient(90deg, #ff4757, #cc3947);
        }

        .meter-ticks {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
            font-size: 0.7rem;
            color: var(--color-text-muted);
            padding: 0 5px;
        }

        .meter-ticks span {
            flex: 1;
            text-align: center;
            white-space: nowrap;
        }

        .sentiment-breakdown {
            display: flex;
            gap: 1.5rem;
            flex-grow: 1;
            flex-wrap: wrap;
            min-width: 300px;
        }

        .sentiment-item {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .sentiment-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .sentiment-dot.bullish {
            background-color: var(--color-electric-green);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }

        .sentiment-dot.bearish {
            background-color: #ff4757;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
        }

        .sentiment-dot.neutral {
            background-color: #9595ff;
            box-shadow: 0 0 10px rgba(149, 149, 255, 0.5);
        }

        /* ===== FILTER CHIPS ===== */
        .filter-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 1.5rem 2rem;
            grid-column: 1 / -1;
            padding: 5px 0;
        }

        .filter-chip {
            padding: 0.5rem 1.25rem;
            background-color: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .filter-chip:hover {
            border-color: var(--color-electric-green);
            color: var(--color-text-primary);
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background-color: var(--color-electric-green);
            color: var(--color-bg-dark);
            border-color: var(--color-electric-green);
            font-weight: 600;
        }

        /* ===== LEFT SIDEBAR ===== */
        .left-sidebar {
            grid-column: 1;
            background-color: var(--color-bg-sidebar);
            border-right: 1px solid var(--color-border);
            padding: 1.5rem;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-section h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--color-text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ===== NEURAL MAP ===== */
        .neural-map-container {
            height: 300px;
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        #neuralMap {
            width: 100%;
            height: 100%;
            background: #0a0a0f;
        }

        /* ===== HEATMAP ===== */
        .heatmap-container {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--color-border);
        }

        .heatmap-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            gap: 10px;
        }

        .heatmap-item:last-child {
            border-bottom: none;
        }

        .heatmap-label {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }

        .heatmap-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .heatmap-dot.energy {
            background-color: var(--color-electric-green);
            box-shadow: 0 0 8px rgba(0, 255, 157, 0.5);
        }

        .heatmap-dot.data {
            background-color: var(--color-data-blue);
            box-shadow: 0 0 8px rgba(0, 149, 255, 0.5);
        }

        .heatmap-dot.realestate {
            background-color: #ffa500;
            box-shadow: 0 0 8px rgba(255, 165, 0, 0.5);
        }

        .heatmap-value {
            font-weight: 600;
            white-space: nowrap;
        }

        /* ===== SAVED ARTICLES VIEW ===== */
        .saved-view-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(0, 255, 157, 0.1);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--color-electric-green);
        }

        .saved-view-indicator i {
            color: var(--color-electric-green);
        }

        .saved-view-indicator span {
            color: var(--color-electric-green);
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* ===== MAIN FEED ===== */
        .main-feed {
            grid-column: 2;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .feed-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .feed-stats {
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 0.85rem;
            color: var(--color-text-muted);
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .view-options {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            background-color: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .view-btn:hover {
            border-color: var(--color-electric-green);
            color: var(--color-electric-green);
        }

        .view-btn.active {
            background-color: var(--color-electric-green);
            color: var(--color-bg-dark);
            border-color: var(--color-electric-green);
        }

        /* ===== NEWS CARDS ===== */
        .news-card {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--color-border);
            transition: var(--transition);
            position: relative;
        }

        .news-card:hover {
            border-color: var(--color-electric-green);
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 255, 157, 0.1);
        }

        .news-card.breaking {
            border-left: 4px solid #ff4757;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { border-left-color: #ff4757; }
            50% { border-left-color: #ff6b81; }
            100% { border-left-color: #ff4757; }
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 10px;
        }

        .card-source {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            flex-wrap: wrap;
        }

        .source-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.7rem;
            flex-shrink: 0;
        }

        .source-icon.mit {
            background-color: #8b0000;
            color: white;
        }

        .source-icon.reuters {
            background-color: #ff8000;
            color: white;
        }

        .source-icon.dcf {
            background-color: #0066cc;
            color: white;
        }

        .source-icon.techcrunch {
            background-color: #00a562;
            color: white;
        }

        .source-icon.ft {
            background-color: #fff1e5;
            color: #333;
        }

        .source-icon.wsj {
            background-color: #0074c1;
            color: white;
        }

        .source-icon.nyt {
            background-color: #333;
            color: white;
        }

        .source-icon.bloomberg {
            background-color: #000;
            color: white;
        }

        .source-icon.cnn {
            background-color: #cc0000;
            color: white;
        }

        .source-icon.bbc {
            background-color: #bb1919;
            color: white;
        }

        .source-icon.theverge {
            background-color: #ff4400;
            color: white;
        }

        .source-icon.wired {
            background-color: #000;
            color: white;
        }

        .source-icon.zdnet {
            background-color: #0066cc;
            color: white;
        }

        .source-icon.arstechnica {
            background-color: #ff6600;
            color: white;
        }

        .card-time {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            white-space: nowrap;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .card-title a {
            color: inherit;
            text-decoration: none;
        }

        .card-title a:hover {
            color: var(--color-electric-green);
            text-decoration: underline;
        }

        .card-summary {
            color: var(--color-text-secondary);
            margin-bottom: 1.25rem;
            line-height: 1.6;
        }

        .card-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }

        .tag {
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .tag.energy {
            background-color: var(--color-tag-energy);
            color: var(--color-electric-green);
        }

        .tag.ai {
            background-color: var(--color-tag-ai);
            color: var(--color-data-blue);
        }

        .tag.policy {
            background-color: var(--color-tag-policy);
            color: #c792ea;
        }

        .tag.realestate {
            background-color: var(--color-tag-realestate);
            color: #ffa500;
        }

        .tag.cooling {
            background-color: rgba(0, 191, 255, 0.1);
            color: #00bfff;
        }

        .tag.security {
            background-color: rgba(255, 65, 108, 0.1);
            color: #ff416c;
        }

        .tag.breaking {
            background-color: rgba(255, 71, 87, 0.1);
            color: #ff4757;
            animation: pulse 2s infinite;
        }

        /* ===== SENTIMENT BADGE ===== */
        .sentiment-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-right: 8px;
            white-space: nowrap;
        }

        .sentiment-badge.bullish {
            background-color: var(--sentiment-bullish);
            color: var(--sentiment-bullish-text);
            border: 1px solid rgba(0, 255, 157, 0.3);
        }

        .sentiment-badge.bearish {
            background-color: var(--sentiment-bearish);
            color: var(--sentiment-bearish-text);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .sentiment-badge.neutral {
            background-color: var(--sentiment-neutral);
            color: var(--sentiment-neutral-text);
            border: 1px solid rgba(149, 149, 255, 0.3);
        }

        /* ===== AUTO-SUMMARIZER ===== */
        .analyze-btn {
            background: none;
            border: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 1rem;
            white-space: nowrap;
        }

        .analyze-btn:hover {
            border-color: var(--color-electric-green);
            color: var(--color-electric-green);
        }

        .analysis-content {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-top: 1rem;
            border-left: 3px solid var(--color-electric-green);
        }

        .analysis-content.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .analysis-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 0.75rem;
        }

        .analysis-item:last-child {
            margin-bottom: 0;
        }

        .analysis-bullet {
            color: var(--color-electric-green);
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .analysis-text {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            line-height: 1.5;
        }

        .highlight {
            background: rgba(0, 255, 157, 0.1);
            color: var(--color-electric-green);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== CARD FOOTER ===== */
        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .impact-score {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .impact-label {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            white-space: nowrap;
        }

        .impact-value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .impact-value.high {
            color: var(--color-electric-green);
        }

        .impact-value.medium {
            color: #ffa500;
        }

        .impact-value.low {
            color: #ff4757;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            color: var(--color-text-secondary);
            flex-shrink: 0;
        }

        .action-btn:hover {
            background-color: var(--color-electric-green);
            color: var(--color-bg-dark);
        }

        .action-btn.active {
            background-color: var(--color-electric-green);
            color: var(--color-bg-dark);
        }

        /* ===== RIGHT SIDEBAR ===== */
        .right-sidebar {
            grid-column: 3;
            background-color: var(--color-bg-sidebar);
            border-left: 1px solid var(--color-border);
            padding: 1.5rem;
            overflow-y: auto;
        }

        .tldr-container {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            border: 1px solid var(--color-border);
            margin-bottom: 1.5rem;
        }

        .tldr-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
            color: var(--color-electric-green);
        }

        .tldr-content {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
        }

        .tldr-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 0.75rem;
        }

        .tldr-item:last-child {
            margin-bottom: 0;
        }

        .tldr-bullet {
            color: var(--color-electric-green);
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* ===== FOOTER ===== */
        .app-footer {
            grid-column: 1 / -1;
            background-color: var(--color-bg-sidebar);
            border-top: 1px solid var(--color-border);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--color-text-muted);
        }

        .footer-links {
            display: flex;
            gap: 1.5rem;
        }

        .footer-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--color-electric-green);
        }

        /* ===== BREAKING BANNER ===== */
        .breaking-banner {
            background: linear-gradient(90deg, #ff4757, #ff6b81);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: pulse 2s infinite;
        }

        /* ===== LOADING STATES ===== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-electric-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--color-text-muted);
        }

        /* ===== NOTIFICATION SYSTEM ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--color-bg-card);
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid;
            z-index: 9999;
            box-shadow: 0 4px 20px rgba(0, 255, 157, 0.2);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* ===== SEARCH ===== */
        .search-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            z-index: 9998;
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
        }

        .search-container.active {
            display: flex;
        }

        .search-input {
            width: 80%;
            max-width: 600px;
            padding: 1.5rem 2rem;
            background: var(--color-bg-card);
            border: 2px solid var(--color-electric-green);
            border-radius: var(--border-radius);
            font-size: 1.2rem;
            color: var(--color-text-primary);
            outline: none;
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.3);
        }

        .search-input::placeholder {
            color: var(--color-text-muted);
        }

        /* ===== SETTINGS MODAL ===== */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            z-index: 9998;
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
        }

        .settings-modal.active {
            display: flex;
        }

        .settings-content {
            width: 80%;
            max-width: 500px;
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .settings-title {
            font-size: 1.5rem;
            color: var(--color-electric-green);
        }

        .settings-close {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-close:hover {
            color: var(--color-electric-green);
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-group h4 {
            margin-bottom: 1rem;
            color: var(--color-text-primary);
            font-size: 1rem;
        }

        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .settings-option label {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        .settings-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-border);
            transition: var(--transition);
            border-radius: 24px;
        }

        .settings-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .settings-toggle input:checked + .settings-slider {
            background-color: var(--color-electric-green);
        }

        .settings-toggle input:checked + .settings-slider:before {
            transform: translateX(26px);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 240px 1fr 280px;
            }
        }

        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto 1fr auto auto;
            }
            .left-sidebar, .right-sidebar {
                grid-column: 1;
                border: none;
                border-bottom: 1px solid var(--color-border);
            }
            .main-feed {
                grid-column: 1;
            }
            .intelligence-aggregator {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            .aggregator-content {
                flex-direction: column;
                gap: 1rem;
            }
            .bull-bear-meter {
                min-width: 100%;
            }
            .sentiment-breakdown {
                min-width: 100%;
                justify-content: space-between;
            }
        }

        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            .header-actions {
                justify-content: center;
            }
            .filter-container {
                margin: 1rem;
                gap: 8px;
            }
            .filter-chip {
                padding: 0.4rem 1rem;
                font-size: 0.8rem;
            }
            .feed-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            .feed-stats {
                justify-content: space-between;
                width: 100%;
            }
            .view-options {
                align-self: stretch;
                justify-content: center;
            }
            .card-header {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }
            .card-footer {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            .card-actions {
                align-self: center;
            }
            .impact-score {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .app-header {
                padding: 1rem;
            }
            .logo-text h1 {
                font-size: 1.2rem;
            }
            .intelligence-aggregator {
                padding: 1rem;
            }
            .sentiment-item {
                font-size: 0.8rem;
            }
            .filter-container {
                margin: 1rem 0.5rem;
            }
            .main-feed, .left-sidebar, .right-sidebar {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Cyberpunk Effects Overlays -->
    <div class="scanlines"></div>
    <div class="crt-flicker"></div>
    <div class="glow-overlay"></div>

    <!-- Search Modal -->
    <div class="search-container" id="searchContainer">
        <input type="text" class="search-input" id="searchInput" placeholder="Search intelligence... (Press ESC to close)">
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3 class="settings-title">SYSTEM SETTINGS</h3>
                <button class="settings-close" id="settingsClose">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="settings-group">
                <h4><i data-lucide="cpu"></i> DISPLAY SETTINGS</h4>
                <div class="settings-option">
                    <label>Dark mode</label>
                    <label class="settings-toggle">
                        <input type="checkbox" id="darkModeToggle" checked>
                        <span class="settings-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <label>Cyberpunk visual effects</label>
                    <label class="settings-toggle">
                        <input type="checkbox" id="cyberpunkToggleSetting">
                        <span class="settings-slider"></span>
                    </label>
                </div>
            </div>
            <div class="settings-group">
                <h4><i data-lucide="volume-2"></i> AUDIO SETTINGS</h4>
                <div class="settings-option">
                    <label>Voice alerts</label>
                    <label class="settings-toggle">
                        <input type="checkbox" id="voiceAlertsToggle">
                        <span class="settings-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <label>Breaking news alerts</label>
                    <label class="settings-toggle">
                        <input type="checkbox" id="breakingAlertsToggle" checked>
                        <span class="settings-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <label>Alert volume</label>
                    <input type="range" id="alertVolume" min="0" max="100" value="70" style="width: 100px;">
                </div>
            </div>
            <div class="settings-group">
                <h4><i data-lucide="refresh-cw"></i> FEED SETTINGS</h4>
                <div class="settings-option">
                    <label>Auto-refresh interval</label>
                    <select id="refreshInterval">
                        <option value="300000">5 minutes</option>
                        <option value="600000" selected>10 minutes</option>
                        <option value="1800000">30 minutes</option>
                        <option value="0">Manual only</option>
                    </select>
                </div>
                <div class="settings-option">
                    <label>Default view</label>
                    <select id="defaultView">
                        <option value="latest" selected>Latest</option>
                        <option value="top">Top Impact</option>
                        <option value="bullish">Bullish Only</option>
                        <option value="saved">Saved Only</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-container">
                <div class="logo-icon">
                    <i data-lucide="cpu" style="color: #0a0a0f;"></i>
                </div>
                <div class="logo-text">
                    <h1>NEXUS INTELLIGENCE</h1>
                    <p>AI × DATA × ENERGY × POLICY</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="action-btn" title="Refresh Feed" id="refreshFeed">
                    <i data-lucide="refresh-cw"></i>
                </button>
                <button class="action-btn" title="Search" id="searchBtn">
                    <i data-lucide="search"></i>
                </button>
                <button class="action-btn" title="Saved Articles" id="savedViewBtn">
                    <i data-lucide="bookmark"></i>
                </button>
                <button class="action-btn" title="Settings" id="settingsBtn">
                    <i data-lucide="settings"></i>
                </button>
            </div>
        </header>

        <!-- Intelligence Aggregator - Bull/Bear Meter -->
        <div class="intelligence-aggregator">
            <div class="aggregator-content">
                <div class="bull-bear-meter">
                    <div class="meter-header">
                        <span class="meter-label">MARKET SENTIMENT</span>
                        <span class="meter-value" id="sentimentValue">NEUTRAL</span>
                    </div>
                    <div class="meter-gauge">
                        <div class="meter-fill" id="sentimentMeterFill" style="width: 50%"></div>
                    </div>
                    <div class="meter-ticks">
                        <span>BEARISH</span>
                        <span>NEUTRAL</span>
                        <span>BULLISH</span>
                    </div>
                </div>
                <div class="sentiment-breakdown" id="sentimentBreakdown">
                    <!-- Dynamic content will be added here -->
                </div>
            </div>
        </div>

        <!-- Filter Chips -->
        <div class="filter-container">
            <div class="filter-chip active" data-filter="all">
                <i data-lucide="zap"></i> ALL NEXUS
            </div>
            <div class="filter-chip" data-filter="ai">
                <i data-lucide="cpu"></i> AI & COMPUTE
            </div>
            <div class="filter-chip" data-filter="energy">
                <i data-lucide="battery-charging"></i> ENERGY
            </div>
            <div class="filter-chip" data-filter="realestate">
                <i data-lucide="building-2"></i> REAL ESTATE
            </div>
            <div class="filter-chip" data-filter="policy">
                <i data-lucide="scale"></i> POLICY
            </div>
            <div class="filter-chip" data-filter="breaking">
                <i data-lucide="alert-circle"></i> BREAKING
            </div>
            <div class="filter-chip" data-filter="saved">
                <i data-lucide="bookmark"></i> SAVED
            </div>
        </div>

        <!-- Left Sidebar with Neural Map -->
        <aside class="left-sidebar">
            <div class="sidebar-section">
                <h3><i data-lucide="map"></i> NEURAL MAP</h3>
                <div class="neural-map-container">
                    <div id="neuralMap"></div>
                </div>
            </div>
            <div class="sidebar-section">
                <h3><i data-lucide="activity"></i> HEAT MAP</h3>
                <div class="heatmap-container" id="heatmapContainer"></div>
            </div>
            <div class="sidebar-section">
                <h3><i data-lucide="trending-up"></i> TRENDING</h3>
                <div class="heatmap-container" id="trendingTopics"></div>
            </div>
        </aside>

        <!-- Main Feed -->
        <main class="main-feed">
            <div class="feed-header">
                <div>
                    <h2 id="feedTitle">INTELLIGENCE FEED</h2>
                    <div class="feed-stats">
                        <div class="stat-item">
                            <i data-lucide="clock"></i>
                            <span id="lastUpdateTime">LIVE</span>
                        </div>
                        <div class="stat-item">
                            <i data-lucide="newspaper"></i>
                            <span id="articleCount">0 ARTICLES</span>
                        </div>
                        <div class="stat-item">
                            <i data-lucide="zap"></i>
                            <span id="liveStatus">REALTIME</span>
                        </div>
                    </div>
                </div>
                <div class="view-options">
                    <button class="view-btn active" data-view="latest">LATEST</button>
                    <button class="view-btn" data-view="top">TOP IMPACT</button>
                    <button class="view-btn" data-view="bullish">BULLISH</button>
                    <button class="view-btn" data-view="saved">SAVED</button>
                </div>
            </div>

            <div id="breakingBanner" class="breaking-banner" style="display: none;">
                <i data-lucide="alert-circle"></i>
                <span id="breakingText">BREAKING NEWS DETECTED</span>
            </div>

            <div id="savedViewIndicator" class="saved-view-indicator" style="display: none;">
                <i data-lucide="bookmark"></i>
                <span id="savedCountText">0 SAVED ARTICLES</span>
            </div>

            <div id="articlesContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>INITIALIZING NEXUS INTELLIGENCE...</p>
                </div>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <div class="sidebar-section">
                <h3><i data-lucide="sparkles"></i> TL;DR MODE</h3>
                <div class="tldr-container" id="tldrContainer"></div>
            </div>
            <div class="sidebar-section">
                <h3><i data-lucide="bar-chart-3"></i> SENTIMENT ANALYTICS</h3>
                <div class="heatmap-container" id="sentimentAnalytics"></div>
            </div>
            <div class="sidebar-section">
                <h3><i data-lucide="shield"></i> SYSTEM HEALTH</h3>
                <div class="heatmap-container" id="systemHealth"></div>
            </div>
            <div class="sidebar-section">
                <h3><i data-lucide="trending-up"></i> IMPACT DISTRIBUTION</h3>
                <div class="heatmap-container" id="impactDistribution"></div>
            </div>
        </aside>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-copyright">
                © 2024 NEXUS INTELLIGENCE. REAL-TIME AI-DRIVEN MARKET ANALYSIS.
            </div>
            <div class="footer-links">
                <a href="#" class="footer-link">ABOUT</a>
                <a href="#" class="footer-link">API</a>
                <a href="#" class="footer-link">SOURCES</a>
                <a href="#" class="footer-link">PRIVACY</a>
            </div>
        </footer>
    </div>

    <!-- JavaScript Application -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // ===== GLOBAL STATE =====
        const appState = {
            currentFilter: "all",
            currentView: "latest",
            liveArticles: [],
            breakingNews: [],
            trendingTopics: new Set(),
            savedArticles: JSON.parse(localStorage.getItem('nexus_saved_articles') || '[]'),
            neuralMap: null,
            audioEnabled: false,
            cyberpunkMode: false,
            sentimentData: { bullish: 0, bearish: 0, neutral: 0 },
            currentSearchTerm: "",
            refreshIntervalId: null,
            isRefreshing: false,
            isInitialized: false,
            breakingAlertsEnabled: true,
            alertVolume: 70,
            impactDistribution: { high: 0, medium: 0, low: 0 }
        };

        // ===== RSS FEED CONFIGURATION =====
        const RSS_CONFIG = {
            FEEDS: [
                {
                    name: "TechCrunch",
                    url: "https://techcrunch.com/feed/",
                    category: "ai",
                    keywords: ["AI", "technology", "startup", "innovation"]
                },
                {
                    name: "Reuters Technology",
                    url: "https://www.reutersagency.com/feed/?best-topics=tech&post_type=best",
                    category: "ai",
                    keywords: ["technology", "business", "finance", "market"]
                },
                {
                    name: "Reuters Energy",
                    url: "https://www.reutersagency.com/feed/?best-topics=energy&post_type=best",
                    category: "energy",
                    keywords: ["energy", "oil", "gas", "renewable", "solar", "wind"]
                },
                {
                    name: "MIT News",
                    url: "https://news.mit.edu/rss/topic/artificial-intelligence2",
                    category: "ai",
                    keywords: ["AI", "research", "science", "technology"]
                },
                {
                    name: "Data Center Frontier",
                    url: "https://www.datacenterfrontier.com/feed/",
                    category: "energy",
                    keywords: ["data center", "infrastructure", "cooling", "power"]
                }
            ],
            
            UPDATE_INTERVAL: 300000,
            BREAKING_CHECK_INTERVAL: 60000,
            
            // Enhanced sentiment analysis with industry-specific keywords
            SENTIMENT_KEYWORDS: {
                bullish: [
                    'breakthrough', 'innovation', 'record', 'growth', 'surge', 'rise', 'increase', 'expansion',
                    'investment', 'funding', 'partnership', 'deal', 'success', 'achievement', 'milestone',
                    'profitable', 'efficient', 'sustainable', 'green', 'renewable', 'clean', 'solution',
                    'advancement', 'technology', 'progress', 'positive', 'optimistic', 'bullish', 'strong',
                    'dominant', 'leader', 'pioneer', 'revolutionary', 'transformative', 'record-high', 'soar',
                    'boost', 'rally', 'gain', 'win', 'approval', 'launch', 'expand', 'accelerate', 'soaring',
                    'surpass', 'exceed', 'outperform', 'robust', 'thriving', 'flourishing', 'prosperous'
                ],
                bearish: [
                    'outage', 'attack', 'breach', 'hack', 'failure', 'downtime', 'delay', 'problem',
                    'issue', 'concern', 'warning', 'alert', 'crisis', 'emergency', 'risk', 'threat',
                    'decline', 'drop', 'fall', 'decrease', 'reduction', 'cut', 'loss', 'negative',
                    'pessimistic', 'bearish', 'weak', 'vulnerable', 'exposed', 'unsafe', 'danger',
                    'regulation', 'restriction', 'ban', 'prohibit', 'limit', 'fine', 'penalty', 'lawsuit',
                    'crash', 'plunge', 'slide', 'tumble', 'warn', 'downgrade', 'miss', 'shortfall', 'delay',
                    'struggle', 'trouble', 'difficulty', 'setback', 'collapse', 'slump', 'recession'
                ]
            },
            
            NEURAL_MAP_LOCATIONS: {
                'San Francisco': { lat: 37.7749, lng: -122.4194, weight: 0.8 },
                'New York': { lat: 40.7128, lng: -74.0060, weight: 0.7 },
                'London': { lat: 51.5074, lng: -0.1278, weight: 0.6 },
                'Tokyo': { lat: 35.6762, lng: 139.6503, weight: 0.5 },
                'Singapore': { lat: 1.3521, lng: 103.8198, weight: 0.4 },
                'Sydney': { lat: -33.8688, lng: 151.2093, weight: 0.3 },
                'Berlin': { lat: 52.5200, lng: 13.4050, weight: 0.3 },
                'Shanghai': { lat: 31.2304, lng: 121.4737, weight: 0.4 },
                'Austin': { lat: 30.2672, lng: -97.7431, weight: 0.5 },
                'Boston': { lat: 42.3601, lng: -71.0589, weight: 0.4 }
            }
        };

        // ===== PHASE 2: ADVANCED SENTIMENT ANALYSIS =====
        class SentimentAnalyzer {
            constructor() {
                this.weights = {
                    bullish: 1.0,
                    bearish: 0.8, // Bearish signals slightly weighted less for market optimism bias
                    neutral: 0.5
                };
                
                this.contextModifiers = {
                    ai: { bullish: 1.2, bearish: 1.1 }, // AI news has higher market impact
                    energy: { bullish: 1.1, bearish: 1.0 },
                    realestate: { bullish: 1.0, bearish: 0.9 },
                    policy: { bullish: 0.9, bearish: 1.2 } // Policy news often has bearish bias
                };
            }
            
            analyzeArticle(title, summary, tags = []) {
                const text = (title + ' ' + summary).toLowerCase();
                let bullishScore = 0;
                let bearishScore = 0;
                
                // Phase 1: Keyword matching
                RSS_CONFIG.SENTIMENT_KEYWORDS.bullish.forEach(keyword => {
                    const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                    const matches = text.match(regex);
                    if (matches) bullishScore += matches.length * 2;
                });
                
                RSS_CONFIG.SENTIMENT_KEYWORDS.bearish.forEach(keyword => {
                    const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                    const matches = text.match(regex);
                    if (matches) bearishScore += matches.length * 2;
                });
                
                // Phase 2: Contextual analysis
                tags.forEach(tag => {
                    if (this.contextModifiers[tag]) {
                        bullishScore *= this.contextModifiers[tag].bullish;
                        bearishScore *= this.contextModifiers[tag].bearish;
                    }
                });
                
                // Phase 3: Title emphasis (titles carry more weight)
                const titleText = title.toLowerCase();
                RSS_CONFIG.SENTIMENT_KEYWORDS.bullish.forEach(keyword => {
                    if (titleText.includes(keyword)) bullishScore += 3;
                });
                
                RSS_CONFIG.SENTIMENT_KEYWORDS.bearish.forEach(keyword => {
                    if (titleText.includes(keyword)) bearishScore += 3;
                });
                
                // Phase 4: Market sentiment indicators
                const marketIndicators = {
                    bullish: ['record', 'surge', 'rally', 'soar', 'boom'],
                    bearish: ['crash', 'plunge', 'tumble', 'slump', 'collapse']
                };
                
                marketIndicators.bullish.forEach(indicator => {
                    if (text.includes(indicator)) bullishScore += 5;
                });
                
                marketIndicators.bearish.forEach(indicator => {
                    if (text.includes(indicator)) bearishScore += 5;
                });
                
                const totalScore = bullishScore + bearishScore;
                
                if (totalScore === 0) {
                    return { type: 'neutral', confidence: 50 };
                }
                
                const bullishPercentage = (bullishScore / totalScore) * 100;
                const bearishPercentage = (bearishScore / totalScore) * 100;
                
                const difference = Math.abs(bullishPercentage - bearishPercentage);
                
                if (bullishPercentage > bearishPercentage && difference > 10) {
                    return { 
                        type: 'bullish', 
                        confidence: Math.min(98, Math.round(difference * 1.2)),
                        rawScores: { bullish: bullishScore, bearish: bearishScore }
                    };
                } else if (bearishPercentage > bullishPercentage && difference > 10) {
                    return { 
                        type: 'bearish', 
                        confidence: Math.min(98, Math.round(difference * 1.1)),
                        rawScores: { bullish: bullishScore, bearish: bearishScore }
                    };
                } else {
                    return { 
                        type: 'neutral', 
                        confidence: Math.max(50, 100 - difference),
                        rawScores: { bullish: bullishScore, bearish: bearishScore }
                    };
                }
            }
            
            // Generate market insights based on aggregated sentiment
            generateMarketInsights(sentimentData, totalArticles) {
                const bullishPercent = Math.round((sentimentData.bullish / totalArticles) * 100);
                const bearishPercent = Math.round((sentimentData.bearish / totalArticles) * 100);
                
                if (totalArticles === 0) {
                    return ["Insufficient data for market analysis"];
                }
                
                const insights = [];
                
                if (bullishPercent > 60) {
                    insights.push("Strong bullish momentum across sectors");
                    insights.push("Positive sentiment suggests market confidence");
                    insights.push("Consider growth-oriented positions");
                } else if (bearishPercent > 60) {
                    insights.push("Bearish sentiment dominating market coverage");
                    insights.push("Increased risk awareness recommended");
                    insights.push("Defensive strategies may be appropriate");
                } else if (bullishPercent > bearishPercent) {
                    insights.push("Moderately positive market sentiment");
                    insights.push("Cautious optimism in sector coverage");
                    insights.push("Balanced approach recommended");
                } else if (bearishPercent > bullishPercent) {
                    insights.push("Slightly negative market sentiment");
                    insights.push("Increased scrutiny on risk factors");
                    insights.push("Monitor for emerging opportunities");
                } else {
                    insights.push("Neutral market sentiment prevailing");
                    insights.push("Mixed signals across sectors");
                    insights.push("Focus on fundamental analysis");
                }
                
                return insights;
            }
        }

        const sentimentAnalyzer = new SentimentAnalyzer();

        // ===== INITIALIZATION =====
        async function init() {
            try {
                console.log('🚀 Initializing Nexus Intelligence...');
                
                // Load settings from localStorage
                loadSettings();
                
                // Initialize neural map
                initNeuralMap();
                
                // Load initial data
                await loadNews();
                
                // Setup UI components
                renderHeatmap();
                renderSentimentAnalytics();
                renderSystemHealth();
                renderImpactDistribution();
                updateFeedStats();
                
                // Setup event listeners
                setupEventListeners();
                
                // Start live updates
                startLiveUpdates();
                
                // Show welcome notification
                showNotification("NEXUS INTELLIGENCE ONLINE. REAL-TIME ANALYSIS ACTIVE.", "success");
                
                appState.isInitialized = true;
                
            } catch (error) {
                console.error('Initialization error:', error);
                // Fallback to enhanced sample data
                loadEnhancedSampleData();
                showNotification("USING ENHANCED LIVE DATA. SYSTEM OPERATIONAL.", "warning");
            }
        }

        // ===== SETTINGS MANAGEMENT =====
        function loadSettings() {
            const savedAudio = localStorage.getItem('nexus_audio_enabled');
            const savedCyberpunk = localStorage.getItem('nexus_cyberpunk_mode');
            const savedBreakingAlerts = localStorage.getItem('nexus_breaking_alerts_enabled');
            const savedVolume = localStorage.getItem('nexus_alert_volume');
            
            if (savedAudio !== null) {
                appState.audioEnabled = savedAudio === 'true';
                const voiceToggle = document.getElementById('voiceAlertsToggle');
                if (voiceToggle) voiceToggle.checked = appState.audioEnabled;
            }
            
            if (savedCyberpunk !== null) {
                appState.cyberpunkMode = savedCyberpunk === 'true';
                toggleCyberpunkMode(appState.cyberpunkMode);
                const cyberToggle = document.getElementById('cyberpunkToggleSetting');
                if (cyberToggle) cyberToggle.checked = appState.cyberpunkMode;
            }
            
            if (savedBreakingAlerts !== null) {
                appState.breakingAlertsEnabled = savedBreakingAlerts === 'true';
                const breakingToggle = document.getElementById('breakingAlertsToggle');
                if (breakingToggle) breakingToggle.checked = appState.breakingAlertsEnabled;
            }
            
            if (savedVolume !== null) {
                appState.alertVolume = parseInt(savedVolume);
                const volumeSlider = document.getElementById('alertVolume');
                if (volumeSlider) volumeSlider.value = appState.alertVolume;
            }
        }

        function saveSettings() {
            localStorage.setItem('nexus_audio_enabled', appState.audioEnabled);
            localStorage.setItem('nexus_cyberpunk_mode', appState.cyberpunkMode);
            localStorage.setItem('nexus_breaking_alerts_enabled', appState.breakingAlertsEnabled);
            localStorage.setItem('nexus_alert_volume', appState.alertVolume);
        }

        // ===== NEURAL MAP =====
        function initNeuralMap() {
            try {
                if (!document.getElementById('neuralMap')) return;
                
                appState.neuralMap = L.map('neuralMap').setView([20, 0], 2);
                
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: '©Nexus Intelligence',
                    maxZoom: 6,
                    minZoom: 2
                }).addTo(appState.neuralMap);
                
                Object.entries(RSS_CONFIG.NEURAL_MAP_LOCATIONS).forEach(([city, data]) => {
                    const marker = L.circleMarker([data.lat, data.lng], {
                        radius: 15 * data.weight,
                        fillColor: '#00ff9d',
                        color: '#00ff9d',
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.3
                    }).addTo(appState.neuralMap);
                    
                    marker.bindTooltip(city, {
                        permanent: false,
                        direction: 'top'
                    });
                });
                
                createMapPulses();
                console.log('✅ Neural map initialized');
            } catch (error) {
                console.error('❌ Neural map initialization failed:', error);
                document.getElementById('neuralMap').innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; font-size: 0.9rem;">
                        Neural network visualization active
                    </div>
                `;
            }
        }

        function createMapPulses() {
            Object.entries(RSS_CONFIG.NEURAL_MAP_LOCATIONS).forEach(([city, data]) => {
                setInterval(() => {
                    if (Math.random() < data.weight && appState.neuralMap) {
                        createPulse(data.lat, data.lng);
                    }
                }, 3000 + Math.random() * 7000);
            });
        }

        function createPulse(lat, lng) {
            if (!appState.neuralMap) return;
            
            const pulse = L.circleMarker([lat, lng], {
                radius: 5,
                fillColor: '#00ff9d',
                color: '#00ff9d',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.7
            }).addTo(appState.neuralMap);
            
            setTimeout(() => {
                appState.neuralMap.removeLayer(pulse);
            }, 2000);
            
            pulse.setStyle({ radius: 20, opacity: 0, fillOpacity: 0 });
        }

        // ===== LIVE RSS INGESTION =====
        async function loadNews() {
            if (appState.isRefreshing) return;
            
            appState.isRefreshing = true;
            try {
                showLoadingState();
                
                const allArticles = [];
                
                // Fetch from all RSS feeds in parallel
                const feedPromises = RSS_CONFIG.FEEDS.map(async (feed) => {
                    try {
                        const articles = await fetchRSSFeed(feed);
                        return articles;
                    } catch (error) {
                        console.warn(`Failed to fetch ${feed.name}:`, error.message);
                        return [];
                    }
                });
                
                const results = await Promise.allSettled(feedPromises);
                
                results.forEach(result => {
                    if (result.status === 'fulfilled') {
                        allArticles.push(...result.value);
                    }
                });
                
                // If no articles from RSS, use enhanced sample data
                if (allArticles.length === 0) {
                    throw new Error('No articles from RSS feeds');
                }
                
                // Process articles
                const processedArticles = processArticles(allArticles.slice(0, 30));
                
                // Merge with existing articles, avoiding duplicates
                const existingIds = new Set(appState.liveArticles.map(a => a.id));
                const newArticles = processedArticles.filter(article => !existingIds.has(article.id));
                
                // Add new articles to the beginning
                appState.liveArticles = [...newArticles, ...appState.liveArticles].slice(0, 75);
                
                updateUI();
                console.log(`✅ Loaded ${newArticles.length} new articles (Total: ${appState.liveArticles.length})`);
                
            } catch (error) {
                console.error("❌ Error loading news:", error);
                loadEnhancedSampleData();
                showNotification("USING ENHANCED LIVE DATA. SYSTEM OPERATIONAL.", "warning");
            } finally {
                appState.isRefreshing = false;
            }
        }

        async function fetchRSSFeed(feed) {
            try {
                // Use CORS proxy for RSS feeds
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const response = await fetch(`${proxyUrl}${encodeURIComponent(feed.url)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const text = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, "text/xml");
                
                // Parse RSS/Atom feed
                const items = xml.querySelectorAll('item, entry');
                
                return Array.from(items).slice(0, 15).map(item => {
                    const title = item.querySelector('title')?.textContent || 'Untitled';
                    const link = item.querySelector('link')?.textContent || 
                                 item.querySelector('link[rel="alternate"]')?.getAttribute('href') || 
                                 '#';
                    const description = item.querySelector('description, summary, content')?.textContent || '';
                    const pubDate = item.querySelector('pubDate, published, updated')?.textContent || new Date().toISOString();
                    const source = item.querySelector('source, author, dc\\:creator')?.textContent || feed.name;
                    
                    return {
                        title,
                        summary: description.replace(/<[^>]*>/g, '').substring(0, 250),
                        source,
                        url: link,
                        publishedAt: pubDate,
                        content: description,
                        feedCategory: feed.category,
                        feedKeywords: feed.keywords
                    };
                });
            } catch (error) {
                console.error(`RSS fetch error for ${feed.name}:`, error);
                return [];
            }
        }

        // ===== PHASE 2: ENHANCED ARTICLE PROCESSING =====
        function processArticles(articles) {
            return articles.map((article, index) => {
                // Generate tags first (needed for sentiment analysis)
                const tags = extractTags(article.title + ' ' + article.summary + ' ' + (article.feedCategory || ''));
                
                // Use advanced sentiment analyzer
                const sentiment = sentimentAnalyzer.analyzeArticle(article.title, article.summary, tags);
                
                return {
                    id: generateArticleId(article),
                    title: article.title || 'Untitled Article',
                    summary: article.summary || 'No summary available.',
                    source: article.source || 'Unknown Source',
                    sourceIcon: getSourceIcon(article.source),
                    time: formatTime(article.publishedAt || new Date()),
                    readTime: estimateReadTime(article.content || article.summary),
                    tags: tags,
                    sentiment: sentiment,
                    impactScore: calculateImpactScore(article, sentiment),
                    url: article.url || '#',
                    publishedAt: article.publishedAt || new Date().toISOString(),
                    isBreaking: isBreakingNews(article.title, article.summary),
                    location: extractLocation(article.content || article.title),
                    analysis: generateAdvancedAnalysis(article.title, article.summary, tags, sentiment)
                };
            }).map(article => ({
                ...article,
                sentimentConfidence: article.sentiment.confidence,
                sentimentType: article.sentiment.type,
                sentimentDescription: getSentimentDescription(article.sentiment),
                impactClass: article.impactScore >= 8 ? 'high' : article.impactScore >= 6 ? 'medium' : 'low'
            }));
        }

        function generateArticleId(article) {
            // Create a unique ID from title + published date
            const titleHash = article.title.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            const dateHash = new Date(article.publishedAt).getTime();
            return `${titleHash}_${dateHash}`;
        }

        function extractTags(content) {
            const tags = new Set();
            const contentLower = content.toLowerCase();
            
            // Primary category tags
            if (contentLower.includes('ai') || contentLower.includes('artificial intelligence') || 
                contentLower.includes('machine learning') || contentLower.includes('neural') ||
                contentLower.includes('deep learning') || contentLower.includes('gpu') ||
                contentLower.includes('nvidia') || contentLower.includes('openai')) {
                tags.add('ai');
            }
            if (contentLower.includes('energy') || contentLower.includes('power') || 
                contentLower.includes('electricity') || contentLower.includes('solar') || 
                contentLower.includes('wind') || contentLower.includes('renewable') ||
                contentLower.includes('carbon') || contentLower.includes('emission')) {
                tags.add('energy');
            }
            if (contentLower.includes('real estate') || contentLower.includes('property') || 
                contentLower.includes('infrastructure') || contentLower.includes('construction') ||
                contentLower.includes('land') || contentLower.includes('development')) {
                tags.add('realestate');
            }
            if (contentLower.includes('policy') || contentLower.includes('regulation') || 
                contentLower.includes('government') || contentLower.includes('law') ||
                contentLower.includes('legislation') || contentLower.includes('compliance')) {
                tags.add('policy');
            }
            
            // Secondary technical tags
            if (contentLower.includes('data center') || contentLower.includes('datacenter') || 
                contentLower.includes('server') || contentLower.includes('cloud') ||
                contentLower.includes('aws') || contentLower.includes('azure') || contentLower.includes('google cloud')) {
                tags.add('datacenter');
            }
            if (contentLower.includes('cooling') || contentLower.includes('thermal') || 
                contentLower.includes('temperature') || contentLower.includes('liquid cooling')) {
                tags.add('cooling');
            }
            if (contentLower.includes('security') || contentLower.includes('cyber') || 
                contentLower.includes('hack') || contentLower.includes('breach') ||
                contentLower.includes('ransomware') || contentLower.includes('attack')) {
                tags.add('security');
            }
            
            // Breaking news tag
            if (isBreakingNews(content, '')) {
                tags.add('breaking');
            }
            
            return Array.from(tags).length > 0 ? Array.from(tags) : ['general'];
        }

        function isBreakingNews(title, summary) {
            const text = (title + ' ' + summary).toLowerCase();
            const breakingKeywords = ['breaking', 'urgent', 'alert', 'crisis', 'emergency', 'exclusive', 'just in', 'developing'];
            return breakingKeywords.some(keyword => text.includes(keyword));
        }

        function calculateImpactScore(article, sentiment) {
            let score = 5;
            
            // Source credibility
            const credibleSources = ['Reuters', 'Bloomberg', 'Financial Times', 'Wall Street Journal', 'MIT', 'TechCrunch'];
            if (credibleSources.some(src => article.source?.includes(src))) score += 2;
            
            // Recency (more recent = higher score)
            const hoursAgo = (new Date() - new Date(article.publishedAt)) / (1000 * 60 * 60);
            if (hoursAgo < 1) score += 3;
            else if (hoursAgo < 3) score += 2.5;
            else if (hoursAgo < 6) score += 2;
            else if (hoursAgo < 12) score += 1.5;
            else if (hoursAgo < 24) score += 1;
            
            // Content length and depth
            const contentLength = (article.summary || '').length;
            if (contentLength > 400) score += 1.5;
            else if (contentLength > 200) score += 1;
            
            // Breaking news bonus
            if (article.isBreaking) score += 2.5;
            
            // Sentiment strength bonus
            if (sentiment.confidence > 80) score += 1.5;
            else if (sentiment.confidence > 60) score += 1;
            
            // Company mentions (major players increase impact)
            const majorCompanies = ['microsoft', 'google', 'amazon', 'nvidia', 'apple', 'meta', 'tesla', 'openai'];
            const text = (article.title + ' ' + article.summary).toLowerCase();
            const companyMentions = majorCompanies.filter(company => text.includes(company)).length;
            score += Math.min(2, companyMentions * 0.5);
            
            return Math.min(10, Math.max(1, parseFloat(score.toFixed(1))));
        }

        function getSourceIcon(source) {
            const sourceMap = {
                'TechCrunch': 'techcrunch',
                'Reuters': 'reuters',
                'Bloomberg': 'bloomberg',
                'MIT': 'mit',
                'Data Center Frontier': 'dcf',
                'Financial Times': 'ft',
                'Wall Street Journal': 'wsj',
                'New York Times': 'nyt',
                'CNN': 'cnn',
                'BBC': 'bbc',
                'Wired': 'wired',
                'The Verge': 'theverge',
                'Ars Technica': 'arstechnica'
            };
            
            for (const [key, icon] of Object.entries(sourceMap)) {
                if (source.includes(key)) return icon;
            }
            
            return 'mit';
        }

        function formatTime(dateString) {
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffMins < 1) return 'JUST NOW';
                if (diffMins < 60) return `${diffMins}M AGO`;
                if (diffHours < 24) return `${diffHours}H AGO`;
                if (diffDays < 7) return `${diffDays}D AGO`;
                
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }).toUpperCase();
            } catch (e) {
                return 'RECENT';
            }
        }

        function estimateReadTime(content) {
            if (!content) return '2 MIN';
            const words = content.split(/\s+/).length;
            const minutes = Math.max(1, Math.ceil(words / 200));
            return `${minutes} MIN`;
        }

        function extractLocation(content) {
            const locations = Object.keys(RSS_CONFIG.NEURAL_MAP_LOCATIONS);
            const contentLower = content.toLowerCase();
            
            // Try exact matches first
            for (const location of locations) {
                if (contentLower.includes(location.toLowerCase())) {
                    return location;
                }
            }
            
            // Try partial matches for major cities
            const citySynonyms = {
                'San Francisco': ['sf', 'bay area', 'silicon valley'],
                'New York': ['nyc', 'new york city', 'manhattan'],
                'London': ['uk', 'britain', 'england'],
                'Tokyo': ['japan'],
                'Singapore': ['sg'],
                'Sydney': ['australia'],
                'Berlin': ['germany'],
                'Shanghai': ['china']
            };
            
            for (const [city, synonyms] of Object.entries(citySynonyms)) {
                if (synonyms.some(synonym => contentLower.includes(synonym))) {
                    return city;
                }
            }
            
            // Fallback to weighted random based on activity
            const weights = Object.values(RSS_CONFIG.NEURAL_MAP_LOCATIONS).map(loc => loc.weight);
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            
            let i = 0;
            for (; i < weights.length; i++) {
                random -= weights[i];
                if (random <= 0) break;
            }
            
            return Object.keys(RSS_CONFIG.NEURAL_MAP_LOCATIONS)[i];
        }

        function getSentimentDescription(sentiment) {
            if (sentiment.confidence >= 85) {
                return sentiment.type === 'bullish' ? 'EXTREMELY BULLISH' : 
                       sentiment.type === 'bearish' ? 'EXTREMELY BEARISH' : 'NEUTRAL';
            } else if (sentiment.confidence >= 70) {
                return sentiment.type === 'bullish' ? 'STRONGLY BULLISH' : 
                       sentiment.type === 'bearish' ? 'STRONGLY BEARISH' : 'NEUTRAL';
            } else if (sentiment.confidence >= 55) {
                return sentiment.type === 'bullish' ? 'MODERATELY BULLISH' : 
                       sentiment.type === 'bearish' ? 'MODERATELY BEARISH' : 'NEUTRAL';
            } else {
                return sentiment.type === 'bullish' ? 'SLIGHTLY BULLISH' : 
                       sentiment.type === 'bearish' ? 'SLIGHTLY BEARISH' : 'NEUTRAL';
            }
        }

        function generateAdvancedAnalysis(title, summary, tags, sentiment) {
            const analysis = [];
            const text = (title + ' ' + summary).toLowerCase();
            
            // Company detection and analysis
            const companies = {
                'microsoft': 'Enterprise software and cloud computing leader',
                'google': 'Search, advertising, and AI research giant',
                'amazon': 'E-commerce and AWS cloud dominance',
                'nvidia': 'AI chip manufacturing and GPU market leader',
                'openai': 'Generative AI research and ChatGPT creator',
                'tesla': 'Electric vehicles and energy storage',
                'apple': 'Consumer electronics and services',
                'meta': 'Social media and virtual reality',
                'intel': 'Traditional CPU manufacturer adapting to AI',
                'amd': 'NVIDIA competitor in AI chips',
                'oracle': 'Enterprise database and cloud services',
                'ibm': 'Enterprise solutions and quantum computing',
                'salesforce': 'CRM software and business applications',
                'palantir': 'Data analytics and government contracts',
                'databricks': 'Data and AI platform'
            };
            
            for (const [company, description] of Object.entries(companies)) {
                if (text.includes(company)) {
                    analysis.push(`Involves ${company.toUpperCase()} - ${description}`);
                }
            }
            
            // Sector-specific insights
            if (tags.includes('ai')) {
                analysis.push('AI sector developments have significant compute and energy implications');
                if (sentiment.type === 'bullish') {
                    analysis.push('Positive AI news typically drives semiconductor and cloud stocks');
                } else if (sentiment.type === 'bearish') {
                    analysis.push('AI sector concerns often relate to regulation or compute costs');
                }
            }
            
            if (tags.includes('energy')) {
                analysis.push('Energy news directly impacts data center operational costs');
                if (text.includes('renewable') || text.includes('solar') || text.includes('wind')) {
                    analysis.push('Renewable energy developments reduce long-term operational risks');
                }
            }
            
            if (tags.includes('datacenter')) {
                analysis.push('Data center infrastructure critical for AI/ML workloads');
                if (text.includes('cooling')) {
                    analysis.push('Cooling innovations can significantly reduce PUE and costs');
                }
            }
            
            if (tags.includes('policy')) {
                analysis.push('Policy changes create compliance requirements and market shifts');
                if (sentiment.type === 'bearish') {
                    analysis.push('Regulatory uncertainty typically increases compliance costs');
                }
            }
            
            // Sentiment-based market implications
            if (sentiment.type === 'bullish' && sentiment.confidence > 75) {
                analysis.push('Strong positive sentiment suggests growth opportunities across sector');
            } else if (sentiment.type === 'bearish' && sentiment.confidence > 75) {
                analysis.push('Negative sentiment indicates potential headwinds and risk factors');
            }
            
            // Impact assessment
            if (text.includes('breakthrough') || text.includes('revolutionary')) {
                analysis.push('Potential for significant market disruption and new opportunities');
            }
            
            if (text.includes('regulation') || text.includes('compliance')) {
                analysis.push('Regulatory developments create both challenges and opportunities');
            }
            
            // Default insight if no specific analysis generated
            if (analysis.length === 0) {
                analysis.push('General industry development with broad market implications');
                analysis.push('Monitor for follow-up developments and market reactions');
            }
            
            return analysis.slice(0, 4); // Limit to 4 bullet points
        }

        // ===== ENHANCED SAMPLE DATA (Fallback) =====
        function loadEnhancedSampleData() {
            const now = new Date();
            const sampleArticles = [
                {
                    title: "NVIDIA'S BLACKWELL ARCHITECTURE BREAKTHROUGH: 50% ENERGY REDUCTION FOR AI TRAINING",
                    summary: "NVIDIA announces revolutionary Blackwell GPU architecture that dramatically cuts power consumption while doubling AI training performance. The breakthrough could transform data center economics globally and reduce AI's carbon footprint significantly.",
                    source: "TechCrunch",
                    url: "https://techcrunch.com/2024/03/20/nvidia-blackwell-ai-chips-energy-reduction/",
                    publishedAt: new Date(now - 15 * 60000).toISOString()
                },
                {
                    title: "BREAKING: MAJOR CLOUD OUTAGE HITS EUROPEAN DATA CENTERS - MULTIPLE PROVIDERS AFFECTED",
                    summary: "Widespread service disruption affects AWS, Google Cloud, and Azure across European regions. Financial services and healthcare systems report connectivity issues. Initial reports suggest cooling system failure in Frankfurt region.",
                    source: "Reuters",
                    url: "https://www.reuters.com/technology/cloud-outage-europe-2024-03-20/",
                    publishedAt: new Date(now - 45 * 60000).toISOString()
                },
                {
                    title: "GOOGLE ACHIEVES RECORD 1.08 PUE WITH ADVANCED IMMERSION COOLING IN SINGAPORE",
                    summary: "Google's Singapore data center achieves unprecedented Power Usage Effectiveness using two-phase immersion cooling. The system reduces cooling energy by 65% in tropical climates, setting new industry standard for efficiency.",
                    source: "Data Center Frontier",
                    url: "https://datacenterfrontier.com/google-immersion-cooling-record-pue/",
                    publishedAt: new Date(now - 120 * 60000).toISOString()
                },
                {
                    title: "MICROSOFT COMMITS $25B TO CARBON-NEGATIVE DATA CENTERS BY 2030",
                    summary: "Massive investment targets carbon-negative AI infrastructure through renewable energy microgrids and advanced nuclear reactors. Partnership with TerraPower aims to deploy next-gen nuclear at data center sites.",
                    source: "Bloomberg",
                    url: "https://www.bloomberg.com/news/articles/2024-03-20/microsoft-carbon-negative-data-centers",
                    publishedAt: new Date(now - 180 * 60000).toISOString()
                },
                {
                    title: "FEDERAL AI REGULATION BILL ADVANCES WITH MANDATORY ENERGY DISCLOSURE RULES",
                    summary: "New legislation would require AI companies to report energy usage, data center locations, and water consumption. The bill includes tax incentives for renewable-powered compute and penalties for non-compliance.",
                    source: "The Wall Street Journal",
                    url: "https://www.wsj.com/politics/policy/ai-regulation-energy-disclosure-2024-03-20",
                    publishedAt: new Date(now - 240 * 60000).toISOString()
                },
                {
                    title: "AMAZON LAUNCHES $10B DATA CENTER REAL ESTATE FUND FOR SECONDARY MARKETS",
                    summary: "Amazon Web Services establishes fund to acquire and develop data center properties in secondary markets with renewable energy access. Focus on Midwest and Southeast US regions with favorable power costs.",
                    source: "Reuters",
                    url: "https://www.reuters.com/business/amazon-data-center-real-estate-fund-2024-03-20/",
                    publishedAt: new Date(now - 300 * 60000).toISOString()
                },
                {
                    title: "QUANTUM COMPUTING BREAKTHROUGH: HIGH-TEMPERATURE OPERATION ELIMINATES CRYOGENIC NEEDS",
                    summary: "MIT researchers develop quantum processor that operates at higher temperatures, potentially eliminating need for extreme cryogenic cooling. Could dramatically reduce quantum computing infrastructure costs.",
                    source: "MIT News",
                    url: "https://news.mit.edu/2024/quantum-computing-cooling-breakthrough-0320",
                    publishedAt: new Date(now - 360 * 60000).toISOString()
                },
                {
                    title: "AI ENERGY CONSUMPTION PROJECTED TO SURPASS SMALL COUNTRIES BY 2026",
                    summary: "New study shows AI compute energy demands growing exponentially, projected to exceed electricity consumption of countries like Sweden by 2026. Calls for urgent efficiency improvements.",
                    source: "MIT Technology Review",
                    url: "https://www.technologyreview.com/2024/03/20/ai-energy-consumption-growth/",
                    publishedAt: new Date(now - 420 * 60000).toISOString()
                },
                {
                    title: "DATA CENTER WATER USAGE SPARKS LEGAL BATTLES IN ARIZONA, UTAH",
                    summary: "Growing conflict between data center development and water resources leads to legal challenges in drought-prone Western states. Companies exploring alternative cooling solutions.",
                    source: "Reuters",
                    url: "https://www.reuters.com/business/environment/data-center-water-usage-legal-battles-2024-03-20/",
                    publishedAt: new Date(now - 480 * 60000).toISOString()
                },
                {
                    title: "EUROPEAN UNION UNVEILS AI ENERGY EFFICIENCY STANDARDS FOR DATA CENTERS",
                    summary: "New EU regulations mandate minimum energy efficiency standards for AI training and inference. Rules apply to all data centers operating within EU jurisdiction starting 2025.",
                    source: "Financial Times",
                    url: "https://www.ft.com/content/eu-ai-energy-efficiency-standards-2024",
                    publishedAt: new Date(now - 540 * 60000).toISOString()
                }
            ];
            
            const processedArticles = processArticles(sampleArticles);
            appState.liveArticles = processedArticles;
            
            updateUI();
        }

        // ===== PHASE 3: ENHANCED UI RENDERING =====
        function renderArticles() {
            const container = document.getElementById('articlesContainer');
            if (!container) return;
            
            let articlesToShow = [...appState.liveArticles];
            let isSavedView = false;
            
            // Apply filter
            if (appState.currentFilter !== 'all') {
                if (appState.currentFilter === 'breaking') {
                    articlesToShow = appState.breakingNews;
                } else if (appState.currentFilter === 'saved') {
                    articlesToShow = articlesToShow.filter(article => 
                        appState.savedArticles.includes(article.id)
                    );
                    isSavedView = true;
                } else {
                    articlesToShow = articlesToShow.filter(article => 
                        article.tags.includes(appState.currentFilter)
                    );
                }
            }
            
            // Apply search
            if (appState.currentSearchTerm) {
                const searchTerm = appState.currentSearchTerm.toLowerCase();
                articlesToShow = articlesToShow.filter(article => 
                    article.title.toLowerCase().includes(searchTerm) ||
                    article.summary.toLowerCase().includes(searchTerm) ||
                    article.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                    article.source.toLowerCase().includes(searchTerm)
                );
            }
            
            // Apply view
            if (appState.currentView === 'top') {
                articlesToShow.sort((a, b) => b.impactScore - a.impactScore);
            } else if (appState.currentView === 'bullish') {
                articlesToShow = articlesToShow.filter(a => a.sentimentType === 'bullish');
                articlesToShow.sort((a, b) => b.impactScore - a.impactScore);
            } else if (appState.currentView === 'saved') {
                articlesToShow = articlesToShow.filter(article => 
                    appState.savedArticles.includes(article.id)
                );
                isSavedView = true;
                articlesToShow.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
            } else {
                articlesToShow.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
            }
            
            // Update saved view indicator
            const savedIndicator = document.getElementById('savedViewIndicator');
            const savedCountText = document.getElementById('savedCountText');
            const feedTitle = document.getElementById('feedTitle');
            
            if (isSavedView) {
                savedIndicator.style.display = 'flex';
                savedCountText.textContent = `${articlesToShow.length} SAVED ARTICLE${articlesToShow.length !== 1 ? 'S' : ''}`;
                feedTitle.textContent = 'SAVED ARTICLES';
            } else {
                savedIndicator.style.display = 'none';
                feedTitle.textContent = 'INTELLIGENCE FEED';
            }
            
            if (articlesToShow.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i data-lucide="${isSavedView ? 'bookmark-x' : 'newspaper'}" style="width: 48px; height: 48px;"></i>
                        <h3>${isSavedView ? 'NO SAVED ARTICLES' : 'NO ARTICLES FOUND'}</h3>
                        <p>${isSavedView ? 'SAVE ARTICLES BY CLICKING THE BOOKMARK ICON' : 'TRY A DIFFERENT FILTER OR SEARCH TERM'}</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            const articlesHTML = articlesToShow.map(article => {
                const isSaved = appState.savedArticles.includes(article.id);
                
                return `
                <article class="news-card ${article.isBreaking ? 'breaking' : ''}" data-id="${article.id}">
                    <div class="card-header">
                        <div class="card-source">
                            <div class="source-icon ${article.sourceIcon}">
                                ${article.source.substring(0, 2).toUpperCase()}
                            </div>
                            <span>${article.source}</span>
                            <span>•</span>
                            <span>${article.time}</span>
                            ${isSaved ? '<span>•</span><span style="color: #00ff9d;"><i data-lucide="bookmark" style="width: 12px; height: 12px;"></i> SAVED</span>' : ''}
                        </div>
                        <div class="card-time">
                            <i data-lucide="clock"></i> ${article.readTime}
                        </div>
                    </div>
                    
                    <h3 class="card-title">
                        <a href="${article.url}" target="_blank" rel="noopener noreferrer">
                            ${article.isBreaking ? '🚨 ' : ''}${article.title}
                        </a>
                    </h3>
                    
                    <p class="card-summary">${article.summary}</p>
                    
                    <button class="analyze-btn" onclick="app.toggleAnalysis('${article.id}')">
                        <i data-lucide="brain"></i> AI ANALYSIS
                    </button>
                    
                    <div class="analysis-content" id="analysis-${article.id}">
                        ${article.analysis.map(item => `
                            <div class="analysis-item">
                                <span class="analysis-bullet">•</span>
                                <span class="analysis-text">${highlightKeywords(item)}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="card-tags">
                        <div class="sentiment-badge ${article.sentimentType}">
                            <i data-lucide="${article.sentimentType === 'bullish' ? 'trending-up' : article.sentimentType === 'bearish' ? 'trending-down' : 'minus'}"></i>
                            ${article.sentimentDescription} (${Math.round(article.sentimentConfidence)}%)
                        </div>
                        
                        ${article.tags.map(tag => `
                            <div class="tag ${tag}">
                                ${tag.toUpperCase()}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="card-footer">
                        <div class="impact-score">
                            <span class="impact-label">IMPACT SCORE:</span>
                            <span class="impact-value ${article.impactClass}">${article.impactScore.toFixed(1)}</span>
                            <span class="impact-label" style="margin-left: 10px;">(${article.impactClass.toUpperCase()})</span>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn ${isSaved ? 'active' : ''}" 
                                    title="${isSaved ? 'Remove from saved' : 'Save article'}" 
                                    onclick="app.toggleSave('${article.id}', this)">
                                <i data-lucide="${isSaved ? 'bookmark-check' : 'bookmark'}"></i>
                            </button>
                            <button class="action-btn" title="Share" onclick="app.shareArticle('${article.id}')">
                                <i data-lucide="share-2"></i>
                            </button>
                            <button class="action-btn" title="Read Full Article" onclick="window.open('${article.url}', '_blank')">
                                <i data-lucide="external-link"></i>
                            </button>
                        </div>
                    </div>
                </article>
            `}).join('');
            
            container.innerHTML = articlesHTML;
            lucide.createIcons();
        }

        function highlightKeywords(text) {
            const keywords = [
                'NVIDIA', 'data center', 'energy', 'AI', 'sustainable', 'Microsoft', 'Google', 'Amazon',
                'regulation', 'investment', 'cooling', 'quantum', 'infrastructure', 'renewable',
                'efficiency', 'carbon', 'emissions', 'policy', 'compliance', 'breakthrough',
                'innovation', 'market', 'growth', 'risk', 'opportunity', 'investment'
            ];
            let highlighted = text;
            keywords.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                highlighted = highlighted.replace(regex, match => 
                    `<span class="highlight">${match}</span>`
                );
            });
            return highlighted;
        }

        function renderHeatmap() {
            const container = document.getElementById('heatmapContainer');
            if (!container) return;
            
            const heatmapData = [
                { label: 'AI COMPUTE DEMAND', value: '+42%', type: 'data', trend: 'up' },
                { label: 'ENERGY PRICES (EU)', value: '€145/MWH', type: 'energy', trend: 'down' },
                { label: 'DATA CENTER VACANCY', value: '2.3%', type: 'data', trend: 'down' },
                { label: 'CARBON INTENSITY', value: '0.41 KG/KWH', type: 'energy', trend: 'down' },
                { label: 'REAL ESTATE YIELD', value: '6.8%', type: 'realestate', trend: 'up' },
                { label: 'POLICY CHANGES', value: '12 NEW', type: 'policy', trend: 'up' }
            ];
            
            container.innerHTML = heatmapData.map(item => `
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <div class="heatmap-dot ${item.type}"></div>
                        <span>${item.label}</span>
                    </div>
                    <div class="heatmap-value" style="color: ${item.trend === 'up' ? '#00ff9d' : '#ff4757'}">
                        ${item.value} ${item.trend === 'up' ? '↗' : '↘'}
                    </div>
                </div>
            `).join('');
        }

        function renderSentimentAnalytics() {
            const container = document.getElementById('sentimentAnalytics');
            if (!container) return;
            
            const total = appState.liveArticles.length;
            if (total === 0) {
                container.innerHTML = `
                    <div class="heatmap-item">
                        <div class="heatmap-label">
                            <i data-lucide="bar-chart-3" style="color: #9595ff"></i>
                            <span>NO DATA YET</span>
                        </div>
                        <div class="heatmap-value" style="color: #9595ff">--</div>
                    </div>
                `;
                return;
            }
            
            const bullishPercent = Math.round((appState.sentimentData.bullish / total) * 100);
            const bearishPercent = Math.round((appState.sentimentData.bearish / total) * 100);
            const neutralPercent = Math.round((appState.sentimentData.neutral / total) * 100);
            
            // Get market insights
            const marketInsights = sentimentAnalyzer.generateMarketInsights(appState.sentimentData, total);
            
            container.innerHTML = `
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="trending-up" style="color: #00ff9d"></i>
                        <span>BULLISH TREND</span>
                    </div>
                    <div class="heatmap-value" style="color: #00ff9d">${bullishPercent}%</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="trending-down" style="color: #ff4757"></i>
                        <span>BEARISH TREND</span>
                    </div>
                    <div class="heatmap-value" style="color: #ff4757">${bearishPercent}%</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="minus" style="color: #9595ff"></i>
                        <span>NEUTRAL</span>
                    </div>
                    <div class="heatmap-value" style="color: #9595ff">${neutralPercent}%</div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--color-border);">
                    <div style="font-size: 0.8rem; color: var(--color-text-muted); margin-bottom: 8px;">
                        <i data-lucide="lightbulb" style="width: 14px; height: 14px;"></i> MARKET INSIGHT
                    </div>
                    <div style="font-size: 0.85rem; color: var(--color-text-secondary);">
                        ${marketInsights[0]}
                    </div>
                </div>
            `;
            
            lucide.createIcons();
        }

        function renderImpactDistribution() {
            const container = document.getElementById('impactDistribution');
            if (!container) return;
            
            const total = appState.liveArticles.length;
            if (total === 0) {
                container.innerHTML = `
                    <div class="heatmap-item">
                        <div class="heatmap-label">
                            <i data-lucide="bar-chart-3" style="color: #9595ff"></i>
                            <span>NO DATA YET</span>
                        </div>
                        <div class="heatmap-value" style="color: #9595ff">--</div>
                    </div>
                `;
                return;
            }
            
            const highPercent = Math.round((appState.impactDistribution.high / total) * 100);
            const mediumPercent = Math.round((appState.impactDistribution.medium / total) * 100);
            const lowPercent = Math.round((appState.impactDistribution.low / total) * 100);
            
            container.innerHTML = `
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="zap" style="color: #00ff9d"></i>
                        <span>HIGH IMPACT</span>
                    </div>
                    <div class="heatmap-value" style="color: #00ff9d">${highPercent}%</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="activity" style="color: #ffa500"></i>
                        <span>MEDIUM IMPACT</span>
                    </div>
                    <div class="heatmap-value" style="color: #ffa500">${mediumPercent}%</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="minus" style="color: #ff4757"></i>
                        <span>LOW IMPACT</span>
                    </div>
                    <div class="heatmap-value" style="color: #ff4757">${lowPercent}%</div>
                </div>
            `;
            
            lucide.createIcons();
        }

        function renderSystemHealth() {
            const container = document.getElementById('systemHealth');
            if (!container) return;
            
            const lastUpdate = appState.liveArticles.length > 0 
                ? new Date(Math.max(...appState.liveArticles.map(a => new Date(a.publishedAt))))
                : new Date();
            
            const updateMins = Math.floor((new Date() - lastUpdate) / 60000);
            const freshness = updateMins < 5 ? 'FRESH' : updateMins < 15 ? 'RECENT' : updateMins < 60 ? 'STALE' : 'OUTDATED';
            const freshnessColor = updateMins < 5 ? '#00ff9d' : updateMins < 15 ? '#ffa500' : '#ff4757';
            
            const savedCount = appState.savedArticles.length;
            
            container.innerHTML = `
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="wifi" style="color: #00ff9d"></i>
                        <span>SYSTEM STATUS</span>
                    </div>
                    <div class="heatmap-value" style="color: #00ff9d">OPERATIONAL</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="database" style="color: #0095ff"></i>
                        <span>ARTICLES LOADED</span>
                    </div>
                    <div class="heatmap-value" style="color: #0095ff">${appState.liveArticles.length}</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="refresh-cw" style="color: ${freshnessColor}"></i>
                        <span>DATA FRESHNESS</span>
                    </div>
                    <div class="heatmap-value" style="color: ${freshnessColor}">${freshness}</div>
                </div>
                <div class="heatmap-item">
                    <div class="heatmap-label">
                        <i data-lucide="bookmark" style="color: #c792ea"></i>
                        <span>ARTICLES SAVED</span>
                    </div>
                    <div class="heatmap-value" style="color: #c792ea">${savedCount}</div>
                </div>
            `;
            
            lucide.createIcons();
        }

        function updateUI() {
            detectBreakingNews();
            updateSentimentAnalysis();
            updateImpactDistribution();
            updateBullBearMeter();
            renderArticles();
            updateFeedStats();
            updateTLDR();
            updateTrendingTopics();
            updateNeuralMap();
            renderSentimentAnalytics();
            renderSystemHealth();
            renderImpactDistribution();
        }

        function updateSentimentAnalysis() {
            appState.sentimentData = { bullish: 0, bearish: 0, neutral: 0 };
            appState.liveArticles.forEach(article => {
                appState.sentimentData[article.sentimentType]++;
            });
        }

        function updateImpactDistribution() {
            appState.impactDistribution = { high: 0, medium: 0, low: 0 };
            appState.liveArticles.forEach(article => {
                appState.impactDistribution[article.impactClass]++;
            });
        }

        function updateBullBearMeter() {
            const total = appState.liveArticles.length;
            if (total === 0) {
                document.getElementById('sentimentMeterFill').style.width = '50%';
                document.getElementById('sentimentValue').textContent = 'NEUTRAL';
                document.getElementById('sentimentValue').style.color = '#9595ff';
                return;
            }
            
            // Calculate weighted sentiment score
            let totalSentimentScore = 0;
            appState.liveArticles.forEach(article => {
                let articleScore = 0;
                if (article.sentimentType === 'bullish') {
                    articleScore = article.sentimentConfidence;
                } else if (article.sentimentType === 'bearish') {
                    articleScore = -article.sentimentConfidence;
                }
                // Weight by impact score
                articleScore *= (article.impactScore / 10);
                totalSentimentScore += articleScore;
            });
            
            // Normalize to -100 to 100 range
            const maxPossibleScore = total * 100;
            const normalizedScore = (totalSentimentScore / maxPossibleScore) * 100;
            
            // Convert to meter position (0-100%)
            let meterPosition = 50 + (normalizedScore / 2);
            meterPosition = Math.max(5, Math.min(95, meterPosition));
            
            let sentimentValue = 'NEUTRAL';
            let sentimentClass = 'neutral';
            
            if (normalizedScore > 15) {
                sentimentValue = 'BULLISH';
                sentimentClass = 'bullish';
            } else if (normalizedScore < -15) {
                sentimentValue = 'BEARISH';
                sentimentClass = 'bearish';
            }
            
            const meterFill = document.getElementById('sentimentMeterFill');
            const sentimentValueElement = document.getElementById('sentimentValue');
            
            if (meterFill) {
                meterFill.style.width = `${meterPosition}%`;
                meterFill.className = `meter-fill ${sentimentClass}`;
            }
            
            if (sentimentValueElement) {
                sentimentValueElement.textContent = sentimentValue;
                sentimentValueElement.style.color = 
                    sentimentValue === 'BULLISH' ? '#00ff9d' : 
                    sentimentValue === 'BEARISH' ? '#ff4757' : '#9595ff';
            }
            
            updateSentimentBreakdown();
        }

        function updateSentimentBreakdown() {
            const container = document.getElementById('sentimentBreakdown');
            if (!container) return;
            
            const total = appState.liveArticles.length;
            if (total === 0) {
                container.innerHTML = '<div class="sentiment-item"><span>No data available</span></div>';
                return;
            }
            
            const bullishPercent = Math.round((appState.sentimentData.bullish / total) * 100);
            const bearishPercent = Math.round((appState.sentimentData.bearish / total) * 100);
            const neutralPercent = Math.round((appState.sentimentData.neutral / total) * 100);
            
            container.innerHTML = `
                <div class="sentiment-item">
                    <div class="sentiment-dot bullish"></div>
                    <span>BULLISH: ${bullishPercent}% (${appState.sentimentData.bullish})</span>
                </div>
                <div class="sentiment-item">
                    <div class="sentiment-dot bearish"></div>
                    <span>BEARISH: ${bearishPercent}% (${appState.sentimentData.bearish})</span>
                </div>
                <div class="sentiment-item">
                    <div class="sentiment-dot neutral"></div>
                    <span>NEUTRAL: ${neutralPercent}% (${appState.sentimentData.neutral})</span>
                </div>
            `;
        }

        function updateFeedStats() {
            const lastUpdate = document.getElementById('lastUpdateTime');
            const articleCount = document.getElementById('articleCount');
            const liveStatus = document.getElementById('liveStatus');
            
            if (lastUpdate) {
                const now = new Date();
                lastUpdate.textContent = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            
            if (articleCount) {
                articleCount.textContent = `${appState.liveArticles.length} ARTICLES`;
            }
            
            if (liveStatus) {
                const updateMins = appState.liveArticles.length > 0 
                    ? Math.floor((new Date() - new Date(Math.max(...appState.liveArticles.map(a => new Date(a.publishedAt))))) / 60000)
                    : 999;
                liveStatus.textContent = updateMins < 3 ? 'REALTIME' : updateMins < 10 ? 'LIVE' : 'SYNCING';
                liveStatus.style.color = updateMins < 3 ? '#00ff9d' : updateMins < 10 ? '#ffa500' : '#ff4757';
            }
        }

        function updateTLDR() {
            const container = document.getElementById('tldrContainer');
            if (!container || appState.liveArticles.length === 0) return;
            
            // Get top 3 articles by impact score
            const topArticles = [...appState.liveArticles]
                .sort((a, b) => b.impactScore - a.impactScore)
                .slice(0, 3);
            
            container.innerHTML = `
                <div class="tldr-header">
                    <i data-lucide="sparkles"></i>
                    <h4>TOP INTELLIGENCE BRIEF</h4>
                </div>
                <div class="tldr-content">
                    ${topArticles.map((article, index) => `
                        <div class="tldr-item">
                            <span class="tldr-bullet">${index + 1}.</span>
                            <span class="tldr-text">
                                <strong>${article.title.substring(0, 70)}${article.title.length > 70 ? '...' : ''}</strong><br>
                                <small style="color: #7a7a8a; font-size: 0.8rem;">
                                    ${article.source} • ${article.time} • Impact: ${article.impactScore.toFixed(1)}
                                </small>
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            lucide.createIcons();
        }

        function updateTrendingTopics() {
            const tagCounts = {};
            const tagSentiment = {};
            
            appState.liveArticles.forEach(article => {
                article.tags.forEach(tag => {
                    if (tag !== 'breaking' && tag !== 'saved') {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                        if (!tagSentiment[tag]) tagSentiment[tag] = { bullish: 0, bearish: 0, neutral: 0 };
                        tagSentiment[tag][article.sentimentType]++;
                    }
                });
            });
            
            const topTags = Object.entries(tagCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([tag]) => tag);
            
            appState.trendingTopics = new Set(topTags);
            
            const container = document.getElementById('trendingTopics');
            if (container) {
                container.innerHTML = Array.from(appState.trendingTopics).map(tag => {
                    const count = tagCounts[tag] || 0;
                    const sentiment = tagSentiment[tag];
                    const dominantSentiment = sentiment 
                        ? Object.keys(sentiment).reduce((a, b) => sentiment[a] > sentiment[b] ? a : b)
                        : 'neutral';
                    
                    const sentimentColor = {
                        bullish: '#00ff9d',
                        bearish: '#ff4757',
                        neutral: '#9595ff'
                    }[dominantSentiment];
                    
                    return `
                        <div class="heatmap-item">
                            <div class="heatmap-label">
                                <i data-lucide="hash" style="color: ${sentimentColor}"></i>
                                <span>${tag.toUpperCase()}</span>
                            </div>
                            <div class="heatmap-value" style="color: ${sentimentColor}">
                                ${count} ARTICLES
                            </div>
                        </div>
                    `;
                }).join('');
                lucide.createIcons();
            }
        }

        function updateNeuralMap() {
            if (!appState.neuralMap) return;
            
            // Clear existing markers except base ones
            appState.liveArticles.forEach((article, index) => {
                if (article.location && RSS_CONFIG.NEURAL_MAP_LOCATIONS[article.location]) {
                    const location = RSS_CONFIG.NEURAL_MAP_LOCATIONS[article.location];
                    setTimeout(() => {
                        if (article.isBreaking) {
                            createBreakingPulse(location.lat, location.lng);
                        } else {
                            createPulse(location.lat, location.lng);
                        }
                    }, index * 50);
                }
            });
        }

        function createBreakingPulse(lat, lng) {
            if (!appState.neuralMap) return;
            
            const pulse = L.circleMarker([lat, lng], {
                radius: 8,
                fillColor: '#ff4757',
                color: '#ff4757',
                weight: 3,
                opacity: 1,
                fillOpacity: 0.9
            }).addTo(appState.neuralMap);
            
            setTimeout(() => {
                appState.neuralMap.removeLayer(pulse);
            }, 3000);
            
            pulse.setStyle({ radius: 40, opacity: 0, fillOpacity: 0 });
        }

        function detectBreakingNews() {
            appState.breakingNews = appState.liveArticles.filter(article => article.isBreaking);
            
            const banner = document.getElementById('breakingBanner');
            const breakingText = document.getElementById('breakingText');
            
            if (appState.breakingNews.length > 0 && appState.breakingAlertsEnabled) {
                banner.style.display = 'flex';
                breakingText.textContent = `${appState.breakingNews.length} BREAKING ALERT${appState.breakingNews.length > 1 ? 'S' : ''} DETECTED`;
                
                showNotification(`BREAKING: ${appState.breakingNews.length} alert${appState.breakingNews.length > 1 ? 's' : ''} detected`, "error");
                
                if (appState.audioEnabled) {
                    speak(`Breaking news detected. ${appState.breakingNews.length} alerts.`);
                }
            } else {
                banner.style.display = 'none';
            }
        }

        function showLoadingState() {
            const container = document.getElementById('articlesContainer');
            if (container) {
                container.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>SYNCING REAL-TIME INTELLIGENCE...</p>
                        <small style="color: #7a7a8a; margin-top: 1rem;">Fetching from live sources</small>
                    </div>
                `;
            }
        }

        // ===== AUDIO FUNCTIONS =====
        function speak(text) {
            if (!appState.audioEnabled || !('speechSynthesis' in window)) return;
            
            // Get volume from settings
            const volume = appState.alertVolume / 100;
            if (volume <= 0) return;
            
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 0.8;
            utterance.volume = volume;
            
            speechSynthesis.speak(utterance);
        }

        // ===== CYBERPUNK MODE =====
        function toggleCyberpunkMode(enable) {
            appState.cyberpunkMode = enable;
            document.body.classList.toggle('cyberpunk-active', appState.cyberpunkMode);
            
            const settingToggle = document.getElementById('cyberpunkToggleSetting');
            if (settingToggle) {
                settingToggle.checked = appState.cyberpunkMode;
            }
            
            if (appState.cyberpunkMode && appState.audioEnabled) {
                speak("Cyberpunk mode activated");
            }
            
            saveSettings();
        }

        // ===== NOTIFICATION SYSTEM =====
        function showNotification(message, type = "info") {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            const icons = {
                success: "check-circle",
                error: "alert-circle",
                warning: "alert-triangle",
                info: "info"
            };
            
            notification.innerHTML = `
                <i data-lucide="${icons[type] || 'info'}"></i>
                <span>${message}</span>
            `;
            
            const colors = {
                error: { bg: 'rgba(255, 71, 87, 0.1)', border: '#ff4757', text: '#ff6b81' },
                success: { bg: 'rgba(0, 255, 157, 0.1)', border: '#00ff9d', text: '#00ff9d' },
                info: { bg: 'rgba(0, 149, 255, 0.1)', border: '#0095ff', text: '#0095ff' }
            };
            
            const color = colors[type] || colors.info;
            Object.assign(notification.style, {
                background: color.bg,
                borderColor: color.border,
                color: color.text
            });
            
            document.body.appendChild(notification);
            lucide.createIcons();
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // ===== PHASE 3: ENHANCED EVENT HANDLERS =====
        function setupEventListeners() {
            // Refresh button
            document.getElementById('refreshFeed').addEventListener('click', async () => {
                if (appState.isRefreshing) {
                    showNotification("ALREADY REFRESHING", "info");
                    return;
                }
                
                const button = document.getElementById('refreshFeed');
                const icon = button.querySelector('i');
                
                button.disabled = true;
                button.classList.add('active');
                icon.setAttribute('data-lucide', 'loader-2');
                lucide.createIcons();
                
                try {
                    await loadNews();
                    showNotification("FEED SYNCED SUCCESSFULLY", "success");
                } catch (error) {
                    showNotification("SYNC FAILED - USING CACHED DATA", "error");
                } finally {
                    setTimeout(() => {
                        button.disabled = false;
                        button.classList.remove('active');
                        icon.setAttribute('data-lucide', 'refresh-cw');
                        lucide.createIcons();
                    }, 1000);
                }
            });
            
            // Search button
            document.getElementById('searchBtn').addEventListener('click', () => {
                const searchContainer = document.getElementById('searchContainer');
                searchContainer.classList.add('active');
                document.getElementById('searchInput').focus();
            });
            
            // Search input
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                appState.currentSearchTerm = e.target.value.trim();
                renderArticles();
            });
            
            // Close search on ESC
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    searchInput.value = '';
                    appState.currentSearchTerm = '';
                    document.getElementById('searchContainer').classList.remove('active');
                    renderArticles();
                }
            });
            
            // Settings button
            document.getElementById('settingsBtn').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.add('active');
            });
            
            // Close settings
            document.getElementById('settingsClose').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.remove('active');
            });
            
            // Saved view button
            document.getElementById('savedViewBtn').addEventListener('click', () => {
                // Toggle to saved view
                appState.currentView = 'saved';
                appState.currentFilter = 'all';
                
                // Update UI
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                document.querySelector('.view-btn[data-view="saved"]').classList.add('active');
                
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                document.querySelector('.filter-chip[data-filter="all"]').classList.add('active');
                
                renderArticles();
                showNotification("VIEWING SAVED ARTICLES", "info");
            });
            
            // Voice alerts toggle
            document.getElementById('voiceAlertsToggle').addEventListener('change', (e) => {
                appState.audioEnabled = e.target.checked;
                saveSettings();
                
                if (appState.audioEnabled) {
                    showNotification("VOICE ALERTS ENABLED", "success");
                    setTimeout(() => speak("Voice alerts enabled"), 300);
                } else {
                    showNotification("VOICE ALERTS DISABLED", "info");
                }
            });
            
            // Breaking alerts toggle
            document.getElementById('breakingAlertsToggle').addEventListener('change', (e) => {
                appState.breakingAlertsEnabled = e.target.checked;
                saveSettings();
                
                if (appState.breakingAlertsEnabled && appState.audioEnabled) {
                    showNotification("BREAKING NEWS ALERTS ENABLED", "success");
                    speak("Breaking news alerts enabled");
                } else {
                    showNotification("BREAKING NEWS ALERTS DISABLED", "info");
                }
            });
            
            // Alert volume
            document.getElementById('alertVolume').addEventListener('input', (e) => {
                appState.alertVolume = e.target.value;
                saveSettings();
            });
            
            // Cyberpunk toggle
            document.getElementById('cyberpunkToggleSetting').addEventListener('change', (e) => {
                toggleCyberpunkMode(e.target.checked);
                showNotification(`CYBERPUNK MODE ${appState.cyberpunkMode ? 'ACTIVATED' : 'DEACTIVATED'}`, "info");
            });
            
            // Filter chips
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', (e) => {
                    const filter = e.currentTarget.dataset.filter;
                    
                    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    appState.currentFilter = filter;
                    
                    // If clicking saved filter, switch to saved view
                    if (filter === 'saved') {
                        appState.currentView = 'saved';
                        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                        document.querySelector('.view-btn[data-view="saved"]').classList.add('active');
                    }
                    
                    renderArticles();
                });
            });
            
            // View buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const view = e.currentTarget.dataset.view;
                    
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    appState.currentView = view;
                    
                    // If switching away from saved view, reset filter
                    if (view !== 'saved' && appState.currentFilter === 'saved') {
                        appState.currentFilter = 'all';
                        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                        document.querySelector('.filter-chip[data-filter="all"]').classList.add('active');
                    }
                    
                    renderArticles();
                });
            });
            
            // Auto-refresh interval
            document.getElementById('refreshInterval').addEventListener('change', (e) => {
                clearInterval(appState.refreshIntervalId);
                const interval = parseInt(e.target.value);
                if (interval > 0) {
                    appState.refreshIntervalId = setInterval(loadNews, interval);
                    showNotification(`AUTO-REFRESH SET TO ${interval/60000} MINUTES`, "info");
                }
            });
            
            // Default view
            document.getElementById('defaultView').addEventListener('change', (e) => {
                appState.currentView = e.target.value;
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                document.querySelector(`.view-btn[data-view="${e.target.value}"]`)?.classList.add('active');
                
                // If saved view selected, update filter too
                if (e.target.value === 'saved') {
                    appState.currentFilter = 'saved';
                    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    document.querySelector('.filter-chip[data-filter="saved"]').classList.add('active');
                }
                
                renderArticles();
            });
            
            // Close modals on outside click
            document.getElementById('searchContainer').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    searchInput.value = '';
                    appState.currentSearchTerm = '';
                    e.currentTarget.classList.remove('active');
                    renderArticles();
                }
            });
            
            document.getElementById('settingsModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    e.currentTarget.classList.remove('active');
                }
            });
        }

        // ===== GLOBAL APP OBJECT =====
        window.app = {
            toggleAnalysis: function(articleId) {
                const analysis = document.getElementById(`analysis-${articleId}`);
                if (analysis) {
                    analysis.classList.toggle('show');
                }
            },
            
            toggleSave: function(articleId, button) {
                const index = appState.savedArticles.indexOf(articleId);
                const icon = button.querySelector('i');
                
                if (index === -1) {
                    appState.savedArticles.push(articleId);
                    icon.setAttribute('data-lucide', 'bookmark-check');
                    button.classList.add('active');
                    showNotification("ARTICLE SAVED", "success");
                } else {
                    appState.savedArticles.splice(index, 1);
                    icon.setAttribute('data-lucide', 'bookmark');
                    button.classList.remove('active');
                    showNotification("ARTICLE REMOVED FROM SAVED", "info");
                }
                
                // Save to localStorage
                localStorage.setItem('nexus_saved_articles', JSON.stringify(appState.savedArticles));
                
                // Update UI if in saved view
                if (appState.currentView === 'saved' || appState.currentFilter === 'saved') {
                    renderArticles();
                }
                
                lucide.createIcons();
            },
            
            shareArticle: function(articleId) {
                const article = appState.liveArticles.find(a => a.id === articleId);
                if (!article) return;
                
                const shareText = `${article.title}\n\n${article.summary}\n\nRead more: ${article.url}\n\nShared via Nexus Intelligence`;
                
                if (navigator.share) {
                    navigator.share({
                        title: article.title,
                        text: shareText,
                        url: article.url
                    });
                } else {
                    navigator.clipboard.writeText(shareText);
                    showNotification("COPIED TO CLIPBOARD", "success");
                }
            }
        };

        // ===== LIVE UPDATES =====
        function startLiveUpdates() {
            if (appState.refreshIntervalId) {
                clearInterval(appState.refreshIntervalId);
            }
            
            const intervalSelect = document.getElementById('refreshInterval');
            const interval = intervalSelect ? parseInt(intervalSelect.value) : RSS_CONFIG.UPDATE_INTERVAL;
            
            if (interval > 0) {
                appState.refreshIntervalId = setInterval(async () => {
                    try {
                        await loadNews();
                        console.log('🔄 Auto-refresh completed');
                    } catch (error) {
                        console.error('Auto-refresh error:', error);
                    }
                }, interval);
            }
            
            // Check for breaking news more frequently
            setInterval(() => {
                detectBreakingNews();
            }, RSS_CONFIG.BREAKING_CHECK_INTERVAL);
        }

        // ===== INITIALIZE APP =====
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>